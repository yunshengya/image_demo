import{i as qe,A as vi,u as bi,a as Et,k as vt,b as bt,c as Ct,e as pe,F as Ci,z as wi,n as Ce,E as Mi,m as Ii,t as ts,p as Ni,h as Ti}from"./index-af1dcbf1.js";import{_ as Oi}from"./_plugin-vue_export-helper-c27b6911.js";var Ai={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M931.4 498.9L94.9 79.5c-3.4-1.7-7.3-2.1-11-1.2a15.99 15.99 0 00-11.7 19.3l86.2 352.2c1.3 5.3 5.2 9.6 10.4 11.3l147.7 50.7-147.6 50.7c-5.2 1.8-9.1 6-10.3 11.3L72.2 926.5c-.9 3.7-.5 7.6 1.2 10.9 3.9 7.9 13.5 11.1 21.5 7.2l836.5-417c3.1-1.5 5.6-4.1 7.2-7.1 3.9-8 .7-17.6-7.2-21.6zM170.8 826.3l50.3-205.6 295.2-101.3c2.3-.8 4.2-2.6 5-5 1.4-4.2-.8-8.7-5-10.2L221.1 403 171 198.2l628 314.9-628.2 313.2z"}}]},name:"send",theme:"outlined"};const Ri=Ai;function ss(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?Object(arguments[e]):{},i=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(i=i.concat(Object.getOwnPropertySymbols(t).filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),i.forEach(function(n){ki(s,n,t[n])})}return s}function ki(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}var Bt=function(e,t){var i=ss({},e,t.attrs);return qe(vi,ss({},i,{icon:Ri}),null)};Bt.displayName="SendOutlined";Bt.inheritAttrs=!1;const Pi=Bt;var j,A;(function(s){s.UNIAPP="uniapp",s.REACT_NATIVE="rn",s.COCOS="cocos",s.TARO="taro",s.UNKNOWN="unknown"})(j||(j={}));class ve{constructor(){this.framework=null,this.methods={[j.UNIAPP]:this.isUniApp,[j.REACT_NATIVE]:this.isReactNative,[j.TARO]:this.isTaro,[j.COCOS]:this.isCocos};const e=this.methods,t=Object.keys(e);for(const i of t)if((0,e[i])()){this.framework=i;break}this.framework=this.framework||j.UNKNOWN,this.framework}static currentFramework(){return this.instance||(this.instance=new ve),this.instance.framework}isUniApp(){try{return typeof uni.getSystemInfoSync=="function"}catch{return!1}}isReactNative(){try{return typeof navigator=="object"&&navigator.product==="ReactNative"}catch{return!1}}isTaro(){try{return{}.TARO_ENV!==void 0}catch{return!1}}isCocos(){try{return cc.sys.localStorage!==void 0}catch{return!1}}}class Me{static init(e){ve.currentFramework()===j.REACT_NATIVE&&(this.validate(e),this.platform=e.platform,this.asyncStorage=e.asyncStorage)}static validate(e){if(!e)throw new Error("'reactNativeOptions' is missing when calling GoEasy.getInstance()");if(!e.platform)throw new Error("'platform' is missing in GoEasy 'reactNativeOptions'");if(!e.asyncStorage)throw new Error("'asyncStorage' is missing in GoEasy 'reactNativeOptions'")}}(function(s){s.DISCONNECTED="disconnected",s.DISCONNECTING="disconnecting",s.CONNECTING="connecting",s.CONNECTED="connected",s.RECONNECTING="reconnecting",s.RECONNECTED="reconnected",s.EXPIRED_RECONNECTED="reconnected",s.CONNECT_FAILED="connect_failed"})(A||(A={}));const qt="2.13.2";var y,q;(function(s){s.PRIVATE="private",s.GROUP="group",s.SYSTEM="system",s.CS="cs"})(y||(y={})),function(s){s.NEW="new",s.SENDING="sending",s.SUCCESS="success",s.FAIL="fail"}(q||(q={}));class jt{}class Os{constructor(e,t){this.id=e,this.data=t}}let d=new class{isDef(s){return!this.isUndef(s)}isUndef(s){return s==null}isPrimitive(s){return typeof s=="string"||typeof s=="number"||typeof s=="symbol"||typeof s=="boolean"}isObject(s){return s!==null&&typeof s=="object"}isPlainObject(s){return Object.prototype.toString.call(s)==="[object Object]"}isRegExp(s){return Object.prototype.toString.call(s)==="[object RegExp]"}isValidArrayIndex(s){let e=parseFloat(String(s));return e>=0&&Math.floor(e)===e&&isFinite(s)}isString(s){return typeof s=="string"}isNumber(s){return typeof s=="number"}isStringOrNumber(s){return this.isString(s)||this.isNumber(s)}isArray(s){return Object.prototype.toString.call(s)==="[object Array]"}isEmpty(s){return this.isArray(s)?s.length===0:this.isObject(s)?!this.isDef(s):!this.isNumber(s)&&(this.isString(s)?s.trim()==="":!this.isDef(s))}isNative(s){return typeof s=="function"&&/native code/.test(s.toString())}isFunction(s){return typeof s=="function"}isBoolean(s){return typeof s=="boolean"}isTrue(s){return s===!0}isFalse(s){return s===!1}isNull(s){return s===null}};var N;(function(s){s.MP_WX="mp-wx",s.MP_WGAME="mp-wgame",s.MP_BYTE="mp-byte",s.MP_BAIDU="mp-baidu",s.MP_ALI="mp-ali",s.BROWSER="browser",s.NODE="node",s.UNI_IOS="uni-ios",s.UNI_ANDROID="uni-android",s.COCOS_IOS="cocos-ios",s.COCOS_ANDROID="cocos-android",s.RN_IOS="rn-ios",s.RN_ANDROID="rn-android",s.UNKNOWN="unknown"})(N||(N={}));class H{constructor(){this.platform=null,this.methods={[N.BROWSER]:this.isBrowser,[N.MP_WX]:this.isMPWX,[N.MP_WGAME]:this.isMPWeGame,[N.MP_BYTE]:this.isMPByte,[N.MP_BAIDU]:this.isMPBaidu,[N.MP_ALI]:this.isMPAli,[N.NODE]:this.isNode,[N.UNI_IOS]:this.isUniAppIOS,[N.UNI_ANDROID]:this.isUniAppAndroid,[N.COCOS_IOS]:this.isCocosIOS,[N.COCOS_ANDROID]:this.isCocosAndroid,[N.RN_IOS]:this.isRNiOS,[N.RN_ANDROID]:this.isRNAndroid};const e=this.methods,t=Object.keys(e);for(const i of t)if((0,e[i])()){this.platform=i;break}this.platform=this.platform||N.UNKNOWN,this.platform}static currentPlatform(){return this.instance||(this.instance=new H),H.instance.platform}isBrowser(){return typeof navigator<"u"&&navigator.product!=="Taro"&&navigator.product!=="ReactNative"&&typeof GameGlobal>"u"&&(typeof cc>"u"||cc.sys.browserType!==null)&&typeof my>"u"&&typeof tt>"u"&&typeof swan>"u"}isMPWX(){return typeof wx=="object"&&typeof wx.getSystemInfoSync=="function"&&typeof WebSocket>"u"&&typeof XMLHttpRequest>"u"&&typeof plus>"u"&&typeof tt>"u"}isMPWeGame(){return typeof GameGlobal=="object"}isMPByte(){return typeof tt=="object"&&typeof tt.getSystemInfoSync=="function"}isMPBaidu(){return typeof swan=="object"&&typeof swan.getSystemInfoSync=="function"}isMPAli(){return typeof my=="object"&&typeof my.getSystemInfoSync=="function"}isNode(){try{return process.release.name==="node"}catch{return!1}}isUniAppIOS(){try{return uni.getSystemInfoSync().platform==="ios"&&uni.getSystemInfoSync().uniPlatform==="app"}catch{return!1}}isUniAppAndroid(){try{return uni.getSystemInfoSync().platform==="android"&&uni.getSystemInfoSync().uniPlatform==="app"}catch{return!1}}isCocosIOS(){try{return cc.sys.os==="iOS"}catch{return!1}}isCocosAndroid(){try{return cc.sys.os==="Android"}catch{return!1}}isRNiOS(){try{return Me.platform.OS==="ios"}catch{return!1}}isRNAndroid(){try{return Me.platform.OS==="android"}catch{return!1}}}class At{}At.type=N,At.current=H.currentPlatform();class As{}class _i extends As{constructor(){super(...arguments),this.runningBackend=!1}startCheck(){typeof plus=="object"&&(plus.globalEvent.addEventListener("resume",()=>{this.runningBackend=!1,this.runningBackend},!1),plus.globalEvent.addEventListener("pause",()=>{this.runningBackend=!0,this.runningBackend},!1))}isBackend(){return this.runningBackend}support(){const e=H.currentPlatform();return[N.UNI_IOS,N.UNI_ANDROID].includes(e)}}class Di extends As{constructor(){super(...arguments),this.runningBackend=!1}startCheck(){wx.onAppShow(()=>{this.runningBackend=!1}),wx.onAppHide(()=>{this.runningBackend=!0})}isBackend(){return this.runningBackend}support(){return H.currentPlatform()===N.MP_WX}}const Rs=new class{constructor(){[new _i,new Di].forEach(s=>{if(s.support())return this.checker=s,void this.checker.startCheck()})}isBackend(){return this.checker&&this.checker.isBackend()}};var I,g,xi=Object.freeze({__proto__:null,runStatus:Rs});(function(s){s.authorize="authorize",s.manualDisconnect="manualDisconnect",s.subscribe="subscribe",s.unsubscribe="unsubscribe",s.publish="publish",s.ack="ack",s.historyMessages="historyMessages",s.hereNow="hereNow",s.hereNowByUserIds="hereNowByUserIds",s.PUBSUB_PRESENCE_SUBSCRIBE="PUBSUB_PRESENCE_SUBSCRIBE",s.PUBSUB_PRESENCE_UNSUBSCRIBE="PUBSUB_PRESENCE_UNSUBSCRIBE",s.PUBSUB_PRESENCE_HERENOW="PUBSUB_PRESENCE_HERENOW",s.imLastConversations="imLastConversations",s.markPrivateMessageAsRead="markPrivateMessageAsRead",s.markGroupMessageAsRead="markGroupMessageAsRead",s.imGroupOnlineCount="imGroupOnlineCount",s.imHereNow="imHereNow",s.imGroupHereNow="imGroupHereNow",s.publishIM="publishIM",s.subscribeUserPresence="subscribeUserPresence",s.unsubscribeUserPresence="unsubscribeUserPresence",s.subscribeGroupPresence="subscribeGroupPresence",s.unsubscribeGroupPresence="unsubscribeGroupPresence",s.removeConversation="removeConversation",s.topConversation="topConversation",s.imData="imData",s.subscribeGroups="subscribeGroups",s.unsubscribeGroup="unsubscribeGroup",s.IM_DELETE_MESSAGE="IM_DELETE_MESSAGE",s.IM_HISTORY="IM_HISTORY",s.IM_HISTORY_CHANGE="IM_HISTORY_CHANGE",s.IM_RECALL_MESSAGE="IM_RECALL_MESSAGE",s.IM_MARK_AS_READ="IM_MARK_AS_READ",s.CS_PENDING_CONVERSATION="CS_PENDING_CONVERSATION",s.CS_ACCEPT="CS_ACCEPT",s.CS_END="CS_END",s.CS_TRANSFER="CS_TRANSFER",s.CS_AGENTS="CS_AGENTS",s.CS_CUSTOMER_STATUS="CS_CUSTOMER_STATUS",s.CS_MY_TEAMS="CS_MY_TEAMS",s.CS_ONLINE="CS_ONLINE",s.CS_OFFLINE="CS_OFFLINE",s.CS_LIVE_SESSION="CS_LIVE_SESSION",s.CS_QUIT_LIVE="CS_QUIT_LIVE",s.SET_IOS_BADGE="SET_IOS_BADGE",s.MD_CMD="MD_CMD"})(I||(I={})),function(s){s[s.connect=3e3]="connect",s[s.reconnectionDelayMax=3e3]="reconnectionDelayMax",s[s.commonQuerySingle=2500]="commonQuerySingle",s[s.commonQueryTotal=12e3]="commonQueryTotal",s[s.commonRequestSingle=1700]="commonRequestSingle",s[s.commonRequestTotal=12e3]="commonRequestTotal",s[s.commonInfiniteSingle=1700]="commonInfiniteSingle",s[s.commonInfiniteTotal=864e5]="commonInfiniteTotal"}(g||(g={}));class S{static onSuccess(e,t){d.isFunction(e.onSuccess)&&e.onSuccess(t)}static onFailed(e,t){if(!d.isObject(e)||!d.isFunction(e.onFailed))throw t;e.onFailed(t)}}function E(s,e,t,i){return new(t||(t=Promise))(function(n,o){function r(u){try{c(i.next(u))}catch(h){o(h)}}function a(u){try{c(i.throw(u))}catch(h){o(h)}}function c(u){var h;u.done?n(u.value):(h=u.value,h instanceof t?h:new t(function(p){p(h)})).then(r,a)}c((i=i.apply(s,e||[])).next())})}var is=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ks(s){if(s.__esModule)return s;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(s).forEach(function(t){var i=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:function(){return s[t]}})}),e}var Te={exports:{}};(function(s){function e(t){if(t)return function(i){for(var n in e.prototype)i[n]=e.prototype[n];return i}(t)}Te.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,i){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(i),this},e.prototype.once=function(t,i){function n(){this.off(t,n),i.apply(this,arguments)}return n.fn=i,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,i){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n,o=this._callbacks["$"+t];if(!o)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var r=0;r<o.length;r++)if((n=o[r])===i||n.fn===i){o.splice(r,1);break}return this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};var i=[].slice.call(arguments,1),n=this._callbacks["$"+t];if(n)for(var o=0,r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,i);return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}})();var Ps=Te.exports,ot={exports:{}},ns=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(ns){var os=new Uint8Array(16);ot.exports=function(){return ns(os),os}}else{var rs=new Array(16);ot.exports=function(){for(var s,e=0;e<16;e++)!(3&e)&&(s=4294967296*Math.random()),rs[e]=s>>>((3&e)<<3)&255;return rs}}for(var _s=[],Ze=0;Ze<256;++Ze)_s[Ze]=(Ze+256).toString(16).substr(1);var as,wt,Ds=function(s,e){var t=e||0,i=_s;return[i[s[t++]],i[s[t++]],i[s[t++]],i[s[t++]],"-",i[s[t++]],i[s[t++]],"-",i[s[t++]],i[s[t++]],"-",i[s[t++]],i[s[t++]],"-",i[s[t++]],i[s[t++]],i[s[t++]],i[s[t++]],i[s[t++]],i[s[t++]]].join("")},Ui=ot.exports,Fi=Ds,Mt=0,It=0,Gi=function(s,e,t){var i=e&&t||0,n=e||[],o=(s=s||{}).node||as,r=s.clockseq!==void 0?s.clockseq:wt;if(o==null||r==null){var a=Ui();o==null&&(o=as=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),r==null&&(r=wt=16383&(a[6]<<8|a[7]))}var c=s.msecs!==void 0?s.msecs:new Date().getTime(),u=s.nsecs!==void 0?s.nsecs:It+1,h=c-Mt+(u-It)/1e4;if(h<0&&s.clockseq===void 0&&(r=r+1&16383),(h<0||c>Mt)&&s.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Mt=c,It=u,wt=r;var p=(1e4*(268435455&(c+=122192928e5))+u)%4294967296;n[i++]=p>>>24&255,n[i++]=p>>>16&255,n[i++]=p>>>8&255,n[i++]=255&p;var l=c/4294967296*1e4&268435455;n[i++]=l>>>8&255,n[i++]=255&l,n[i++]=l>>>24&15|16,n[i++]=l>>>16&255,n[i++]=r>>>8|128,n[i++]=255&r;for(var f=0;f<6;++f)n[i+f]=o[f];return e||Fi(n)},Li=ot.exports,Bi=Ds,qi=function(s,e,t){var i=e&&t||0;typeof s=="string"&&(e=s==="binary"?new Array(16):null,s=null);var n=(s=s||{}).random||(s.rng||Li)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e)for(var o=0;o<16;++o)e[i+o]=n[o];return e||Bi(n)},ji=Gi,xs=qi,Rt=xs;Rt.v1=ji,Rt.v4=xs;var Vi=Rt;class mt{support(){return!0}getParams(){return this.params}setData(e){this.active=e.a,this.data=e.d}preConnect(e){}postConnect(){}}class Y{static initModule(e){e.support()&&this.modules.set(e.name,e)}static getParams(){return E(this,void 0,void 0,function*(){let e={};for(const[t,i]of this.modules)e[t]=(yield i.getParams())||null;return e})}static setDatas(e){Object.keys(e).forEach(t=>{this.modules.get(t).setData(e[t])})}static preConnect(e){this.modules.forEach((t,i)=>{t.preConnect(e)})}static postConnect(){this.modules.forEach((e,t)=>{e.postConnect()})}}Y.Module=mt,Y.modules=new Map;const Hi=Ps;class zi{constructor(){this.emitter=new Hi}on(e,t){return this.emitter.on(e,t),this}once(e,t){return this.emitter.once(e,t),this}off(e,t){return this.emitter.off(e,t),this}fire(e,t){return this.emitter.emit(e,t),this}}class Us{constructor(){this.eventDriver=new zi}on(e,t){this.eventDriver.on(e,t)}off(e,t){this.eventDriver.off(e,t)}fire(e,t){this.eventDriver.fire(e,t)}}let cs=new class{isDef(s){return!this.isUndef(s)}isUndef(s){return s==null}isPrimitive(s){return typeof s=="string"||typeof s=="number"||typeof s=="symbol"||typeof s=="boolean"}isObject(s){return s!==null&&typeof s=="object"}isPlainObject(s){return Object.prototype.toString.call(s)==="[object Object]"}isRegExp(s){return Object.prototype.toString.call(s)==="[object RegExp]"}isValidArrayIndex(s){let e=parseFloat(String(s));return e>=0&&Math.floor(e)===e&&isFinite(s)}isString(s){return typeof s=="string"}isNumber(s){return typeof s=="number"}isStringOrNumber(s){return this.isString(s)||this.isNumber(s)}isArray(s){return Object.prototype.toString.call(s)==="[object Array]"}isEmpty(s){return this.isArray(s)?s.length===0:this.isObject(s)?!this.isDef(s):!this.isNumber(s)&&(this.isString(s)?s.trim()==="":!this.isDef(s))}isNative(s){return typeof s=="function"&&/native code/.test(s.toString())}isFunction(s){return typeof s=="function"}isBoolean(s){return typeof s=="boolean"}isTrue(s){return s===!0}isFalse(s){return s===!1}isNull(s){return s===null}};const Wi=Ps;class Ji{constructor(){this.emitter=new Wi}on(e,t){if(!cs.isString(e))throw Error("event require a string.");if(!cs.isFunction(t))throw Error("callback must be a function");this.emitter.on(e,t)}fire(e,t){this.emitter.emit(e,t)}off(e,t){this.emitter.off(e,t)}}class m{static init(e,t,i,n,o,r){this.Socket=e,this.N=t,this.Member=i,this.v=n,this.Platform=o,this.GModules=r}}const Xi=Vi;class Vt{static get(){return Xi.v1().replace(/-/g,"")}}var M,Nt;(Nt=M||(M={})).WRITE="WRITE",Nt.READ="READ",Nt.NONE="NONE";class O{constructor(e){this.permission=M.NONE,this.singleTimeout=0,this.totalTimeout=0,this.startTime=0,this.complete=!1,this.retried=0,this.unique=!1,this.uuid=Vt.get(),this.name=e.name,this.params=e.params,this.permission=e.permission,this.totalTimeout=e.totalTimeout,this.singleTimeout=e.singleTimeout,e.unique&&(this.unique=e.unique),this.success=t=>{this.complete||(this.end(),e.success(t))},this.fail=t=>{this.complete||(this.end(),e.fail(t))}}start(){this.startTime=Date.now(),this.initAutoTimeout()}end(){this.complete=!0,clearTimeout(this.timeoutHandler)}initAutoTimeout(){this.timeoutHandler=setTimeout(()=>{this.complete||this.fail({resultCode:408,content:"Host unreachable or timeout"})},this.totalTimeout)}}class Xe extends mt{static init(){return this.module=new Xe,this.module.name=this.GN_MODULE_NAME,this.module}static setRegId(e,t){if(e){this.module.regIdPromise=e;let i=t;this.module.params={v:{npv:i}}}}preConnect(e){this.wxmpId=e.wxmpId}getParams(){return E(this,void 0,void 0,function*(){if(this.params=this.params||{},this.regIdPromise)try{this.params.regId=yield this.regIdPromise}catch(e){console.warn("Failed to register the Manufacturers Push service:"+JSON.stringify(e))}return this.params.wxmpId=this.wxmpId,this.params})}}Xe.GN_MODULE_NAME="GN";class V{static init(){let e=Xe.init();Y.initModule(e),this.supportAppNotification()&&(this.uniappPlugin=uni.requireNativePlugin("GoEasy-Uniapp"),this.uniappPlugin?(this.regIdPromise=this.askRegId(),this.v=this.uniappPlugin.v(),Xe.setRegId(this.regIdPromise,this.v)):console.warn("No GoEasy-Uniapp Native Plugin."),this.setClientBadge(0))}static addAssembler(e){this.payloadAssemblers.push(e)}static assemblePayload(e){let t=this.payloadAssemblers.find(i=>i.support(e));return t?t.assemble(e):e}static createLocalNotification(e,t,i,n,o){Rs.isBackend()&&(i.g=1,typeof plus<"u"&&(n?(this.uniappPlugin&&this.uniappPlugin.playSound(n),plus.push.createMessage(t,JSON.stringify(i),{title:e,sound:"none"})):plus.push.createMessage(t,JSON.stringify(i),{title:e}),o==="+1"&&this.setClientBadge(V.badge+1)))}static setBadge(e){if(!Number.isInteger(e.badge)||e.badge<0)S.onFailed(e,"badge must be an integer greater than or equal to 0.");else if(V.supportAppNotification())if(this.uniappPlugin&&H.currentPlatform()===N.UNI_IOS){let t=new O({name:I.SET_IOS_BADGE,params:{badge:e.badge},unique:!0,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,permission:M.WRITE,success:()=>{S.onSuccess(e),this.setClientBadge(e.badge)},fail:i=>{S.onFailed(e,i.content)}});m.Socket.e(t)}else S.onSuccess(e),this.setClientBadge(e.badge)}static setClientBadge(e){plus.device.vendor!=="vivo"&&(V.badge=e,plus.runtime.setBadgeNumber(e))}static askRegId(){let e=null,t=0;const i=()=>new Promise((n,o)=>{this.uniappPlugin.regId(r=>{n(r)},r=>{if(!(r.data.code===1e6&&t<=10))return clearTimeout(e),o(r);e=setTimeout(()=>{t++,this.regIdPromise=i()},3500)})});return i()}static getRegIdPromise(){return this.regIdPromise}static supportAppNotification(){const e=H.currentPlatform();return e===N.UNI_ANDROID||e===N.UNI_IOS}static listenPlusClickNotification(){plus.push.addEventListener("click",e=>{try{if(e){const t=typeof e.payload=="string"?JSON.parse(e.payload):e.payload;if(this.availableIntent(t)){let i=this.assemblePayload(t);plus.push.clear(),this.onClickNotificationCallback(i)}}}catch{}})}static availableIntent(e){return e&&Object.keys(e).length&&e.g&&parseInt(e.g)===1}static getIntentData(){this.uniappPlugin.getIntentData(e=>{if(!this.availableIntent(e))return;let t=this.assemblePayload(e);const i=H.currentPlatform();plus.push.clear(),i===N.UNI_ANDROID&&this.uniappPlugin.clearAll(),this.onClickNotificationCallback(t)})}static listenClick(){this.listenPlusClickNotification();const e=H.currentPlatform();this.uniappPlugin&&e===N.UNI_ANDROID&&this.getIntentData()}static onClickNotification(e){if(V.supportAppNotification()){if(!d.isFunction(e))throw new Error("The arguments must be a function.");this.onClickNotificationCallback===null?(this.onClickNotificationCallback=e,this.listenClick()):console.warn("The onClickNotification event has been listened on. Please do not listen to it more than once.")}else console.warn("The current environment doesn't support or allowNotification is false.")}}function rt(...s){}V.uniappPlugin=null,V.v=null,V.regIdPromise=null,V.onClickNotificationCallback=null,V.payloadAssemblers=new Array;const k=new class{validateId(s,e){if(d.isEmpty(s))throw{code:400,content:` ${e} is required.`};if(!d.isString(s))throw{code:400,content:`TypeError: ${e} require string.`}}validateIdArray(s,e){if(!Array.isArray(s)||s.length===0)throw{code:400,content:`TypeError: ${e} require array.`};if(s.length>300)throw{code:400,content:`${e} is over max length 300.`};for(let t=0;t<s.length;t++){if(!d.isStringOrNumber(s[t]))throw{code:400,content:`TypeError: ${e} item require string or number.`};if(d.isNumber(s[t])&&(s[t]=s[t].toString()),s[t].length==0)throw{code:400,content:`${e} has empty item.`}}if(Array.from(new Set(s)).length<s.length)throw{code:400,content:`Duplicate element in ${e}`}}validateChannel(s,e){if(d.isEmpty(s))throw{code:400,content:` ${e} is required.`};if(!d.isStringOrNumber(s))throw{code:400,content:`TypeError: ${e} require string or number.`}}validateChannelArray(s,e){this.validateIdArray(s,e)}validateChannelAndChannels(s,e){let t=!d.isEmpty(s),i=!d.isEmpty(e);if(!t&&!i)throw{code:400,content:"channel is required."};if(t&&i)throw{code:400,content:"subscribe to either channel or channels, not both."};t&&this.validateChannel(s,"channel"),i&&this.validateChannelArray(e,"channels")}validateCallbackOptions(s){if(!d.isObject(s))throw{code:400,content:"bad parameters"}}validateNotification(s){function e(i,n,o){if(!(d.isString(i[n])&&i[n].length<=o))throw{code:400,content:`notification.${n} must be a string of no more than ${o} characters`}}function t(i,n,o,r){let a=i[n];if(d.isObject(a)&&d.isDef(a[o])){let c={code:400,content:`notification.vendorOptions.${n}.${o} require a ${r}}`},u=a[o];if(r==="string"&&!d.isString(u)||r==="number"&&!d.isNumber(u))throw c}}if(!d.isObject(s))throw{code:400,content:"TypeError: notification requires an object."};{if(e(s,"title",32),e(s,"body",50),d.isDef(s.sound)&&!d.isString(s.sound))throw{code:400,content:"notification.sound must be a string"};if(d.isDef(s.badge)&&!d.isString(s.badge))throw{code:400,content:"notification.badge must be a string"};s.badge=s.badge||"0";let i=s.vendorOptions;d.isObject(i)&&(t(i,"huawei","category","string"),t(i,"xiaomi","channel_id","string"),t(i,"oppo","channel_id","string"),t(i,"vivo","classification","number"),t(i,"vivo","category","string"))}}validateValIsEmpty(s,e){if(d.isUndef(s)||d.isEmpty(s))throw{code:400,content:`${e} is empty`}}validateWXMPTemplateMsg(s){if(d.isObject(s)){if(!d.isString(s.template_id))throw{code:400,content:"template_id must be string."};if(!d.isEmpty(s.url)&&!d.isString(s.url))throw{code:400,content:"url must be string"};if(!(d.isEmpty(s.miniprogram)||d.isString(s.miniprogram.appid)&&d.isString(s.miniprogram.pagepath)))throw{code:400,content:"miniprogram.appid and miniprogram.pagepath must be strings."};if(!d.isObject(s.data))throw{code:400,content:"data requires an object."}}else if(d.isPrimitive(s))throw{code:400,content:"wxmpTemplateMsg must be an object."}}validateObject(s,e){if(d.isUndef(s)||!d.isObject(s))throw{code:400,content:e+" must be an object."}}validateString(s,e){if(d.isUndef(s)||!d.isString(s))throw{code:400,content:e+" must be a string."}}};function Ht(s){if(s===null||typeof s!="object"||"isActiveClone"in s)return s;let e=s instanceof Array?[]:{};for(let t in s)typeof s[t]=="object"?e[t]=Ht(s[t]):e[t]=s[t];return e}class $i{publish(e){d.isFunction(e.onFailed)||(e.onFailed=rt),d.isFunction(e.onSuccess)||(e.onSuccess=rt),this.validate(e),e.channel=e.channel.toString();let t={channel:e.channel,content:e.message,nt:e.notification,at:e.accessToken,guid:Vt.get(),q:e.qos};e.wxmpTemplateMsg&&(t.wxmpTemplateMsg=Ht(e.wxmpTemplateMsg),t.wxmpTemplateMsg.data=JSON.stringify(t.wxmpTemplateMsg.data));let i=new O({name:I.publish,params:t,unique:!0,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,permission:M.WRITE,success:function(n){e.onSuccess({code:200,content:"ok"})},fail:function(n){e.onFailed({code:n.resultCode,content:n.content})}});m.Socket.e(i)}validate(e){if(k.validateChannel(e.channel,"channel"),d.isEmpty(e.message))throw{code:400,content:"message is required."};if(!d.isString(e.message))throw{code:400,content:"TypeError: message requires string."};if(e.message.length>1e4)throw{code:400,content:"Message over max length 10000."};if(e.qos&&!(e.qos in[0,1]))throw{code:400,content:"Qos must be 0 or 1."};e.wxmpTemplateMsg&&k.validateWXMPTemplateMsg(e.wxmpTemplateMsg),d.isDef(e.notification)&&k.validateNotification(e.notification)}}class Yi{constructor(e){if(this.options=e,this.channels=e.channels||[e.channel],!d.isEmpty(e.channel)){let t=e.channel.toString();this.channels=[t]}d.isEmpty(e.channels)||(this.channels=e.channels.toString().split(","))}}var se,B;(function(s){s.message="message",s.imMessage="imMessage",s.userPresence="userPresence",s.groupPresence="groupPresence",s.PS_PRESENCE_EVENT="PS_PRESENCE_EVENT",s.IM_MSG_READ="IM_MSG_READ",s.IM_MSG_DELETED="IM_MSG_DELETED",s.IM_MSG_RECALLED="IM_MSG_RECALLED",s.CS_ONLINE_CHANGED="CS_ONLINE_CHANGED"})(se||(se={})),function(s){s.CONNECTED="CONNECTED",s.RECONNECTED="RECONNECTED",s.DISCONNECTED="DISCONNECTED",s.LOST="LOST",s.EXPIRED_RECONNECTED="EXPIRED_RECONNECTED",s.NEW_MESSAGE="NEW_MESSAGE",s.CONNECTING="CONNECTING"}(B||(B={}));class Qi{constructor(){this.subscriptions=[],m.Socket.onMessage(se.message,this.onNewMessage.bind(this)),m.Socket.on(B.EXPIRED_RECONNECTED,this.expiredResubscribe.bind(this)),m.Socket.on(B.CONNECTED,this.resubscribePresenceChannel.bind(this))}expiredResubscribe(){this.subscriptions.forEach(e=>{this.doSubscribe(e,!1)})}resubscribePresenceChannel(){this.subscriptions.forEach(e=>{let t=e.options;t.presence&&t.presence.enable&&this.doSubscribe(e,!0)})}onNewMessage(e){if(e.n.indexOf("_presence")>-1)return;e.a&&m.Socket.sendAck("ack",{i:e.i,c:e.n});let t={time:e.t,channel:e.n,content:e.c};this.createNotification(e),this.findSubscriptionByChannel(t.channel).options.onMessage(t)}createNotification(e){const t=m.N.supportAppNotification();if(!d.isObject(e.nt)||!t)return;const i={ch:e.n,ctt:e.c};m.N.createLocalNotification(e.nt.t,e.nt.c,i,e.nt.sound,e.nt.badge)}subscribe(e){if(k.validateChannelAndChannels(e.channel,e.channels),d.isDef(e.presence)){let i=e.presence.enable;if(!d.isBoolean(i))throw{code:400,content:"Subscription failed. presence.enable must be a boolean"};if(i&&!m.Socket.user().id)throw{code:400,content:"Subscription failed. If presence is enable, the id must be specified when calling the connect method"}}let t=new Yi(e);this.doSubscribe(t,!1).then(()=>{this.subscriptions.push(t),S.onSuccess(e,{code:200,content:"ok"})}).catch(i=>{S.onFailed(e,{code:i.resultCode,content:i.content})})}doSubscribe(e,t){let i=e.options;return new Promise((n,o)=>{let r=new O({name:I.subscribe,permission:M.READ,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,params:{channels:e.channels,accessToken:i.accessToken,presence:i.presence,resubscribe:t},success:()=>{n()},fail:a=>{o(a)}});m.Socket.e(r)})}unsubscribe(e){k.validateChannel(e.channel,"channel"),e.channel=e.channel.toString();const t=this.findSubscriptionByChannel(e.channel);if(!t)return void e.onFailed({code:400,content:"channel["+e.channel+"] is not subscribed"});let i=new O({name:I.unsubscribe,params:{channel:e.channel,presence:t.options.presence},permission:M.READ,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,success:()=>{e.onSuccess({code:200,content:"ok"}),this.removeChannel(e.channel)},fail:function(n){e.onFailed({code:n.resultCode,content:n.content})}});m.Socket.e(i)}removeChannel(e){for(let t=this.subscriptions.length-1;t>=0;t--){const i=this.subscriptions[t].channels,n=i.indexOf(e);if(n>-1){i.splice(n,1),i.length===0&&this.subscriptions.splice(t,1);break}}}findSubscriptionByChannel(e){let t=!1,i=null;for(let n=this.subscriptions.length-1;n>=0;n--){let o=this.subscriptions[n].channels;for(let r=0;r<o.length;r++)if(o[r]==e){t=!0,i=this.subscriptions[n];break}if(t)break}return i}}class Ki{get(e){d.isFunction(e.onSuccess)||(e.onSuccess=rt),d.isFunction(e.onFailed)||(e.onFailed=rt),k.validateChannel(e.channel,"channel"),e.channel=e.channel.toString();let t=new O({name:I.historyMessages,permission:M.READ,params:e,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,success:i=>{e.onSuccess({code:i.resultCode||i.code||200,content:i.content})},fail:i=>{e.onFailed({code:i.resultCode||i.code,content:i.content})}});m.Socket.e(t)}}class Zi{constructor(){this.channelPresenceMap=new Map,this.onPresenceEvent=e=>{this.channelPresenceMap.get(e.channel).onPresence(e)},this.expireAllChannelPresences=()=>{this.channelPresenceMap.forEach((e,t)=>{e.expire()})},this.resubscribe=()=>{this.channelPresenceMap.forEach((e,t)=>{e.subscribed()&&e.doSubscribe()})},m.Socket.on(B.LOST,this.expireAllChannelPresences),m.Socket.on(B.RECONNECTED,this.resubscribe),m.Socket.onMessage(se.PS_PRESENCE_EVENT,this.onPresenceEvent)}hereNow(e){k.validateChannel(e.channel,"channel");let t,i=this.channelPresenceMap.get(e.channel.toString());i&&i.queryPromise?(e.limit&&e.limit>i.membersLimit&&i.doQuery(e.limit),t=i.queryPromise):t=Fs(e.channel,e.limit),t.then(n=>{e.onSuccess(n)}).catch(n=>{e.onFailed(n)})}subscribe(e){if(k.validateChannel(e.channel,"channel"),d.isUndef(e.onPresence)||!d.isFunction(e.onPresence))throw{code:400,content:"Subscription Presence failed. onPresence callback function is required"};let t=e.channel.toString(),i=this.channelPresenceMap.get(t);i||(i=new en(t),this.channelPresenceMap.set(t,i)),i.subscribe(e)}unsubscribe(e){k.validateChannel(e.channel,"channel");let t=e.channel.toString();if(this.channelPresenceMap.get(t)){let i=new O({name:I.PUBSUB_PRESENCE_UNSUBSCRIBE,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,params:{channel:t},success:n=>{this.channelPresenceMap.delete(t),e.onSuccess()},fail:n=>{e.onFailed(n)}});m.Socket.e(i)}else e.onSuccess()}}class en{constructor(e){this.membersLimit=10,this.queried=!1,this.channel=e}onPresence(e){return E(this,void 0,void 0,function*(){this.queried?this.update(e):yield this.queryPromise,this.on({channel:this.channel,action:e.action,member:e.member,time:e.time,amount:this.amount,members:this.membersByLimit()})})}membersByLimit(){return this.members.slice(0,this.membersLimit)}subscribe(e){return E(this,void 0,void 0,function*(){if(e.membersLimit&&(this.membersLimit=Math.min(e.membersLimit,300)),!this.subscribed())try{yield this.doSubscribe()}catch(t){return void e.onFailed(t)}this.on=e.onPresence,e.onSuccess()})}doSubscribe(){return this.doQuery(this.membersLimit),new Promise((e,t)=>{let i=new O({name:I.PUBSUB_PRESENCE_SUBSCRIBE,permission:M.READ,params:{channel:this.channel},singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,success:n=>{e()},fail:n=>{t(n)}});m.Socket.e(i)})}doQuery(e){this.queryPromise=Fs(this.channel,e),this.queryPromise.then(t=>{this.members=t.content.members,this.amount=t.content.amount,this.queried=!0}).catch(t=>{throw t})}update(e){if(["join","back"].includes(e.action))this.members.unshift(e.member);else if(["leave","timeout"].includes(e.action)){let t=this.members.findIndex(i=>i.id===e.member.id);t>-1&&this.members.splice(t,1)}this.amount=e.amount}expire(){this.queried=!1,this.queryPromise=null}subscribed(){return this.on!==void 0}}function Fs(s,e){return e||(e=10),new Promise((t,i)=>{let n={channel:s,limit:e},o=new O({name:I.PUBSUB_PRESENCE_HERENOW,permission:M.READ,params:n,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,success:r=>{t(r)},fail:r=>{i(r)}});m.Socket.e(o)})}class oe{constructor(){this.publisher=new $i,this.subscriber=new Qi,this.presence2=new Zi,this.histories=new Ki}static init(){this.instance=new oe}publish(e){this.publisher.publish(e)}subscribe(e){this.subscriber.subscribe(e)}unsubscribe(e){this.subscriber.unsubscribe(e)}subscribePresence(e){this.presence2.subscribe(e)}unsubscribePresence(e){this.presence2.unsubscribe(e)}history(e){this.histories.get(e)}hereNow(e){this.presence2.hereNow(e)}}class $e extends mt{static init(){return this.module=new $e,this.module.name=this.GWS_MODULE_NAME,this.initGN(),this.module}static initGN(){V.addAssembler(new class{assemble(e){return{channel:e.ch,content:e.ctt}}support(e){return!!e.ch}})}postConnect(){oe.init()}static check(){if(!this.module)throw new Error("PubSub not initialized. Please include 'PUBSUB' in the 'modules' during GoEasy initialization.")}}$e.GWS_MODULE_NAME="GWS";class Ye{constructor(){}}let tn=new class extends Ye{constructor(){super()}upload(s,e){try{return delete s.parameters.fileRes,new Promise((t,i)=>{uni.uploadFile({url:s.host,filePath:this.getTempFilePath(s),name:"file",formData:s.parameters,success(n){n.statusCode===200?t():i({code:n.statusCode,content:n.errMsg})},fail(n){i({code:500,content:n.errMsg})}}).onProgressUpdate(n=>{e&&e(n)})})}catch(t){return new Promise((i,n)=>{n({code:500,content:t})})}}getTempFilePath(s){let e=s.file;return e.tempFilePath||e.fullPath||e.path}};const us=new class extends Ye{upload(s,e){try{return new Promise((t,i)=>{wx.uploadFile({url:s.host,filePath:this.getTempFilePath(s),name:"file",formData:s.parameters,success(n){n.statusCode===200?t():i({code:n.statusCode,content:n.errMsg})},fail(n){i({code:500,content:n.errMsg})}}).onProgressUpdate(n=>{e&&e(n)})})}catch(t){return new Promise((i,n)=>{n({code:500,content:t})})}}getTempFilePath(s){let e=s.file||s.fileRes;return e.path||e.tempFilePath}},ls=new class extends Ye{constructor(){super()}upload(s,e){try{return new Promise((t,i)=>{let n=new XMLHttpRequest;n.open("post",s.host,!0);for(let r in s.headers)n.setRequestHeader(r,s.headers[r]);n.upload.onprogress=function(r){e&&e(r)},n.upload.onloadstart=function(r){e&&e(r)},n.upload.onloadend=function(r){e&&e(r)};let o=new FormData;for(let r in s.parameters)r=="fileRes"?o.append("file",s.parameters[r]):o.append(r,s.parameters[r]);n.send(o),n.onreadystatechange=function(){n.readyState==4&&(n.status>=200&&n.status<300||n.status==304?t():i({code:n.status,content:n.responseText}))}})}catch(t){return new Promise((i,n)=>{n({code:500,content:t})})}}},sn=new class extends Ye{upload(s,e){try{return delete s.parameters.fileRes,new Promise((t,i)=>{my.uploadFile({url:s.host,filePath:this.getTempFilePath(s),fileType:"image",name:"file",formData:s.parameters,success(n){n.statusCode===200?t():i({code:n.statusCode,content:n.errMsg})},fail(n){i({code:500,content:n.errMsg})}}).onProgressUpdate(n=>{e&&e(n)})})}catch(t){return new Promise((i,n)=>{n({code:500,content:t})})}}getTempFilePath(s){let e=s.file;return e.path||e.tempFilePath}},nn=new class extends Ye{upload(s,e){try{return delete s.parameters.fileRes,new Promise((t,i)=>{swan.uploadFile({url:s.host,filePath:this.getTempFilePath(s),name:"file",formData:s.parameters,success(n){n.statusCode===200?t():i({code:n.statusCode,content:n.errMsg})},fail(n){i({code:500,content:n.errMsg})}}).onProgressUpdate(n=>{e&&e(n)})})}catch(t){return new Promise((i,n)=>{n({code:500,content:t})})}}getTempFilePath(s){let e=s.file;return e.path||e.tempFilePath}};class on{constructor(e,t,i){this.storageLocation=e,this.url=t,this.name=i}}const rn=new class{constructor(){this.uploader={[j.UNIAPP]:tn,[N.MP_WX]:us,[N.BROWSER]:ls,[N.MP_ALI]:sn,[N.MP_BAIDU]:nn,[j.REACT_NATIVE]:ls,[N.MP_BYTE]:us}}upload(s,e){return E(this,void 0,void 0,function*(){const t=ve.currentFramework(),i=H.currentPlatform(),n=t===j.UNKNOWN?i:t;return yield this.uploader[n].upload(s,e),new on(s.storageLocation,s.url,s.newFileName)})}};class an{resolve(e){return new Promise((t,i)=>{let n=new O({name:"uploadToken",params:{filename:e},permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail(o){i(o.content)},success(o){o.code===200?t(o.content):i(o.content)}});m.Socket.e(n)})}}var re;(function(s){s.aliYun="ALI",s.qiNiu="QN",s.tencent="TX"})(re||(re={}));class Gs{constructor(e,t,i,n,o,r,a){this.storageLocation=e,this.host=t,this.headers=i,this.parameters=n,this.file=o,this.newFileName=r,this.url=a}}class Ls{constructor(){}newFileName(e){return e&&e.newFilename||""}}let cn=new class extends Ls{constructor(){super()}url(s){return s.host+"/"+s.dir+"/"+this.newFileName(s)}build(s,e,t){let i,n=this.newFileName(s);return i={key:s.dir+"/"+n,OSSAccessKeyId:s.accessKeyId,policy:s.policy,signature:s.signature,success_action_status:"200",fileRes:e},t&&(i={key:s.dir+"/"+n,OSSAccessKeyId:s.accessKeyId,policy:s.policy,signature:s.signature,success_action_status:"200","Content-Disposition":"attachment;filename="+e.name,fileRes:e}),new Gs(re.aliYun,s.host,null,i,e,n,this.url(s))}},un=new class extends Ls{constructor(){super()}url(s){return s.host+"/"+s.key}build(s,e,t){let i={"q-sign-algorithm":s.qSignAlgorithm,"q-ak":s.qAk,"q-key-time":s.qKeyTime,"q-signature":s.qSignature,policy:s.policy,"x-cos-security-token":s.xCosSecurityToken,success_action_status:"200",key:s.key,fileRes:e};return t&&(i={"q-sign-algorithm":s.qSignAlgorithm,"q-ak":s.qAk,"q-key-time":s.qKeyTime,"q-signature":s.qSignature,policy:s.policy,"x-cos-security-token":s.xCosSecurityToken,success_action_status:"200",key:s.key,"Content-Disposition":`attachment;filename=${e.name}`,fileRes:e}),new Gs(re.tencent,s.host,null,i,e,s.key,this.url(s))}};class ln{constructor(){this.uploadTokenResolver=new an}builder(e){if(e===re.aliYun)return cn;if(e===re.tencent)return un;throw new Error("Only Ali OSS and Tencent COS are supported, unknown storage location:"+e)}build(e,t,i){return E(this,void 0,void 0,function*(){try{let n=yield this.uploadTokenResolver.resolve(t),o=this.builder(n.vendor).build(n,e,i);return Promise.resolve(o)}catch(n){return Promise.reject(n)}})}}class Bs{constructor(){this.requestBuilder=new ln,this.fileUploader=rn}upload(e,t,i,n){return E(this,void 0,void 0,function*(){try{let o=yield this.requestBuilder.build(e,t,n);return this.fileUploader.upload(o,i)}catch(o){return Promise.reject(o)}})}}var b,J,X,Q;(function(s){s.MESSAGE_SENDING="IM_INTERNAL_MESSAGE_SENDING",s.MESSAGE_SEND_SUCCESS="IM_INTERNAL_MESSAGE_SEND_SUCCESS",s.MESSAGE_SEND_FAILED="IM_INTERNAL_MESSAGE_SEND_FAILED",s.MESSAGE_RECEIVED="IM_INTERNAL_MESSAGE_RECEIVED",s.MESSAGE_RECALLED="IM_INTERNAL_MESSAGE_RECALLED",s.MAX_MESSAGE_CHANGED="IM_INTERNAL_MAX_MESSAGE_CHANGED",s.MAX_MESSAGE_DELETED="IM_INTERNAL_MAX_MESSAGE_DELETED",s.UNREAD_AMOUNT_CHANGED="IM_INTERNAL_UNREAD_MESSAGE_CHANGED",s.CS_ONLINE_SUCCESS="CS_ONLINE_SUCCESS",s.CS_OFFLINE_SUCCESS="CS_OFFLINE_SUCCESS",s.CS_ACCEPTED="CS_ACCEPTED",s.CS_ENDED="CS_ENDED",s.CS_TRANSFER="CS_TRANSFER",s.CS_AGENT_MESSAGE_RECEIVED="CS_AGENT_MESSAGE_RECEIVED"})(b||(b={}));class Qe{clearUseLessAttribute(){delete this.buildOptions}isOtherSent(){return this.senderId!==m.Socket.user().id}getToData(){return this.buildOptions.createOptions.to.data}}class dn{}(function(s){s.TEXT="text",s.IMAGE="image",s.FILE="file",s.VIDEO="video",s.AUDIO="audio"})(J||(J={}));class at extends dn{constructor(){super(...arguments),this.goEasyUploader=new Bs}improve(e){let t=e.message;return new Promise((i,n)=>{let o,r,a=t.buildOptions.createOptions;t.type===J.VIDEO?(r=t.payload,o=r.video.name):(r=t.payload,o=r.name),this.goEasyUploader.upload(a.file,o,a.onProgress,t.type===J.FILE).then(c=>{this.setPayload(c,t),i()}).catch(c=>{n(c)})})}setPayload(e,t){t.payload.url=e.url}}class hn extends at{setPayload(e,t){let i,n=t.payload;switch(n.video.url=e.url,n.video.name=e.name,n.thumbnail.height>200&&(n.thumbnail.height=200,n.thumbnail.width=200*n.video.width/n.video.height),e.storageLocation){case re.aliYun:i="?x-oss-process=video/snapshot,t_0000,f_jpg,h_"+n.thumbnail.height+",m_fast,ar_auto";break;case re.tencent:i="?ci-process=snapshot&time=1&format=jpg&height="+n.thumbnail.height;break;default:throw new Error("Only Ali OSS and Tencent COS are supported, unknown storage location:"+e.storageLocation)}n.thumbnail.url=e.url+i}}class pn extends at{setPayload(e,t){let i,n=t.payload;n.url=e.url;const o=n.height>200?200:n.height;switch(e.storageLocation){case re.aliYun:i="?x-oss-process=image/resize,m_lfit,h_"+o;break;case re.tencent:i=`?imageMogr2/thumbnail/x${o}`;break;default:throw new Error("Only Ali OSS and Tencent COS are supported, unknown storage location:"+e.storageLocation)}n.thumbnail=e.url+i}}class mn{constructor(){this.improvers={[J.FILE]:new at,[J.AUDIO]:new at,[J.IMAGE]:new pn,[J.VIDEO]:new hn}}improve(e){let t=this.improvers[e.message.type];if(t)try{return t.improve(e)}catch(i){return Promise.reject(i)}return Promise.resolve()}}class v extends Us{static init(){this.i=new v}}class fn{constructor(e,t,i,n,o){this.validate(e),this.mt=e.type,this.to=t.id.toString(),this.d=JSON.stringify(t.data),this.p=JSON.stringify(e.payload),i&&(this.nt=i),o&&(this.at=o),n&&(this.wxmpTemplateMsg=Ht(n),this.wxmpTemplateMsg.data=JSON.stringify(this.wxmpTemplateMsg.data));let r=t.type;if(this.t=r,r===y.CS){let a=e;this.tid=a.teamId}this.guid=e.messageId}validate(e){if(e.type===J.TEXT&&JSON.stringify(e.payload).length>3072)throw Error("message-length limit 3kb")}}class gn{constructor(){this.payloadImprover=new mn}send(e){this.validate(e);let t=e.message,i=e.accessToken,n=t.buildOptions,o=n.createOptions,r=o.notification,a=o.wxmpTemplateMsg,c=o.to;c.data||(c.data={}),t.status=q.SENDING;let u=n.complete,h=this.payloadImprover.improve(e);Promise.all([u,h]).then(()=>E(this,void 0,void 0,function*(){if(o.beforeSend){const p=JSON.parse(JSON.stringify(t));yield o.beforeSend(p)}this.doSend(t,c,r,a,i,e)})).catch(p=>{t.status=q.FAIL,S.onFailed(e,{code:p&&p.code||400,content:p&&p.content||p})})}doSend(e,t,i,n,o,r){let a=new fn(e,t,i,n,o);v.i.fire(b.MESSAGE_SENDING,e);let c=new O({name:I.publishIM,params:a,unique:!0,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:u=>{e.status=q.FAIL,v.i.fire(b.MESSAGE_SEND_FAILED,e),S.onFailed(r,{code:u.resultCode,content:u.content})},success:u=>{if(e.status=q.SUCCESS,e.timestamp=u.content.timestamp,e.messageId=JSON.stringify(u.content.id),e.scene()===y.CS){let h=e;h.customerId()!==m.Socket.user().id&&(h.sessionId=u.content.sessionId)}e.clearUseLessAttribute(),v.i.fire(b.MESSAGE_SEND_SUCCESS,e),S.onSuccess(r,e)}});m.Socket.e(c)}validate(e){let t=e.message;if(!(t instanceof Qe))throw new Error("it is invalid message");if(t.status!==q.NEW)throw new Error("Please create a new message, a message can only be sent once")}}class qs{insert(e,t){let i=this.binarySearch(e,t);if(i>=0)e.splice(i,1,t);else{let n=-i-1;e.splice(n,0,t)}}binarySearch(e,t){let i=0,n=e.length-1;for(;i<=n;){let o=n+i>>1,r=this.compare(t,e[o]);if(r>0)i=o+1;else{if(!(r<0))return o;n=o-1}}return-i-1}}class ue{constructor(e){this.messages=new Array,this.allLoaded=!1,this.target=e}all(){return this.messages}sliceOverLengthMessages(){this.messages.length>ue.CACHE_MAX_LENGTH&&(this.messages=this.messages.slice(-ue.CACHE_MAX_LENGTH),this.allLoaded===!0&&(this.allLoaded=!1))}getMaxMessage(){return this.messages[this.messages.length-1]}loadLocalMessages(e,t){let i=[],n=this.messages.length;if(t){if(n>0){let o=this.messages[0].timestamp,r=this.messages[n-1].timestamp;if(t>=o&&t<=r)for(let a=n-1;a>=0;a--){let c=this.messages[a];if(c.timestamp<t){if(!(i.length<e))break;i.unshift(c)}}}}else i=this.messages.slice(-e);return i}cacheServerMessages(e,t){let i=this.messages[0];this.messages.length<ue.CACHE_MAX_LENGTH&&(!e.lastTimestamp||this.messages.length>0&&i.timestamp===e.lastTimestamp)&&(t.forEach(n=>{ue.sortedInserter.insert(this.messages,n)}),t.length<e.limit&&(this.allLoaded=!0))}findMessageByTime(e){return this.messages.find(t=>e===t.timestamp)}findMessagesByTimes(e){let t=[];return e.forEach(i=>{let n=this.findMessageByTime(i);d.isDef(n)&&t.push(n)}),t}existsMessage(e){return this.findMessageIndexById(e)>-1}findMessageIndexById(e){return this.messages.findIndex(t=>e===t.messageId)}deleteMessage(e){let t=this.findMessageIndexById(e);t>=0&&this.messages.splice(t,1)}recallMessage(e){return e.times.map(t=>this.findMessageByTime(t)).filter(t=>d.isDef(t)).map(t=>(t.recalled=!0,t.recaller=e.recaller,t))}isEmpty(){return this.messages.length===0}deleteMessages(e){e.forEach(t=>{this.deleteMessage(t.messageId)})}saveMessage(e){ue.sortedInserter.insert(this.messages,e),this.sliceOverLengthMessages()}maxSuccessMessageTime(){for(let e=this.messages.length-1;e>=0;e--)if(this.messages[e].status===q.SUCCESS)return this.messages[e].timestamp;return 0}minTime(){return this.isEmpty()?0:this.messages[0].timestamp}correctPosition(e){this.deleteMessage(e.messageId),this.saveMessage(e)}}ue.CACHE_MAX_LENGTH=200,ue.sortedInserter=new class extends qs{compare(s,e){let t=s.timestamp-e.timestamp;return t>0?1:t===0?0:-1}};class T{constructor(e,t,i){this.scene=e,this.id=t,d.isDef(i)&&(this.teamId=i)}toString(){return y.PRIVATE===this.scene||y.GROUP===this.scene?this.scene+"#"+this.id:this.scene+"#"+this.id+"#"+this.teamId}customerId(){if(y.CS===this.scene)return this.id===this.teamId?m.Socket.user().id:this.id}static byScene(e,t,i){return new T(e,t,i)}static byIMMessage(e){let t,i,n=e.scene();if(n===y.PRIVATE){let o=e.senderId,r=e.targetId();i=m.Socket.user().id===o?r:o}else if(n===y.GROUP)i=e.targetId();else{if(n!==y.CS)throw{code:400,content:`scene ${n} not exists`};i=e.targetId(),t=e.teamId}return new T(n,i,t)}static byMessageReadRemoteEvent(e){let t,i=e.scene,n=e.targetId,o=e.markerId,r=e.teamId;return i===y.PRIVATE?t=m.Socket.user().id===o?n:o:i===y.GROUP?t=n:i===y.CS&&(t=n===r?o===m.Socket.user().id?r:o:o===m.Socket.user().id?n:r),new T(i,t,r)}static byIMMessageDeletedEvent(e){let t=e.scene,i=e.deleterId;if(t===y.PRIVATE){let n=m.Socket.user().id===i?e.targetId:i;return new T(t,n)}if(t===y.GROUP)return new T(t,e.targetId)}static byConversationDTO(e){let t=e.lastMessage;return this.byIMMessage(t)}static byConversationId(e,t){let i;if(e===y.PRIVATE){let n=t.split(":",2);i=n[0]===m.Socket.user().id?n[1]:n[0]}else i=t;return new T(e,i)}}class yn{constructor(e){this.times=new Array;let t=e[0],i=T.byIMMessage(t);this.scene=i.scene,this.targetId=i.id,e.forEach(n=>{n.status===q.SUCCESS&&this.times.push(n.timestamp)}),this.times.sort((n,o)=>n<o?-1:n==o?0:1)}}class js{static deleteServerMessages(e){let t=new yn(e);return t.times.length<0?Promise.resolve():new Promise((i,n)=>{let o=new O({name:I.IM_DELETE_MESSAGE,params:t,permission:M.WRITE,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,success:r=>{r.code===200?i(r):n(r)},fail:r=>{n(r)}});m.Socket.e(o)})}static validate(e){let t=e.messages;for(let i=0;i<t.length;i++){let n=t[i];if(n.status===q.SENDING)throw{code:400,content:"message["+i+"] is '"+n.status+"' and cannot be deleted"}}}}class Sn{constructor(e,t,i,n,o){this.scene=e,this.id=t,this.after=i,this.min=n,this.teamId=o}}class En{constructor(e,t,i,n){this.id=e,this.scene=t,this.lastTimestamp=i,this.teamId=n}}class Vs extends Qe{constructor(){super(...arguments),this.read=!1}scene(){return y.PRIVATE}targetId(){return this.receiverId}}class Hs extends Qe{scene(){return y.GROUP}targetId(){return this.groupId}}class zt extends Qe{constructor(){super(...arguments),this.accepted=!1}scene(){return y.CS}targetId(){return m.Socket.user().id===this.customerId()?this.teamId:this.customerId()}sendByCustomer(){return this.to===this.teamId}customerId(){return this.sendByCustomer()?this.senderId:this.to}isOtherSent(){return m.Socket.user().id===this.customerId()?this.senderId!==m.Socket.user().id:this.senderId===this.customerId()}}(function(s){s.ACCEPT="CS_ACCEPT",s.END="CS_END",s.TRANSFER="CS_TRANSFER"})(X||(X={}));class ft{build(e){let t,i=e.t;i===y.PRIVATE?(t=new Vs,t.read=!1,t.receiverId=e.r):i===y.GROUP?(t=new Hs,t.groupId=e.r,t.senderData=e.d?JSON.parse(e.d):{}):i===y.CS&&(t=new zt,t.to=e.r,t.teamId=e.tid,t.senderData=e.d?JSON.parse(e.d):{},t.accepted=e.accepted,t.customerId()!==m.Socket.user().id&&(t.sessionId=e.sessionId)),t.senderId=e.s,t.messageId=e.i,t.timestamp=e.ts,t.type=e.mt;let n=e.p;if(d.isDef(n))if(i===y.CS&&t.type===X.TRANSFER){let r=JSON.parse(n);r.transferTo.data=JSON.parse(r.transferTo.data),t.payload=r}else t.payload=JSON.parse(n);let o=e.rc;return d.isDef(o)&&o===!0?(t.recalled=o,t.recaller=e.recaller):t.recalled=!1,t.status=q.SUCCESS,t}}class kt{constructor(){this.builder=new ft}sync(e,t,i,n,o){let r=new Sn(e,t,i,n,o);return new Promise((a,c)=>{let u=new O({name:I.IM_HISTORY_CHANGE,params:r,permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:h=>{c(h)},success:h=>{let p=h.content;a(p)}});m.Socket.e(u)})}loadServerMessages(e,t){return new Promise((i,n)=>{let o=new O({name:I.IM_HISTORY,params:t,permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:r=>{n(r)},success:r=>{let a=r.content;a.messages=this.convertServerMessages(e,a.messages),i(a)}});m.Socket.e(o)})}convertServerMessages(e,t){let i=[],n=e.scene,o=e.id;return t.forEach(r=>{if(r.t=n,y.PRIVATE===n)r.r=r.s===m.Socket.user().id?o:m.Socket.user().id;else if(y.GROUP===n)r.r=o;else if(y.CS===n){let c=e.customerId(),u=e.teamId;c===m.Socket.user().id?r.r=u:r.r=c}let a=this.builder.build(r);i.push(a)}),i}updateServerOffsets(e,t){return E(this,void 0,void 0,function*(){let i=new En(t.id,t.scene,e,t.teamId);return new Promise((n,o)=>{let r=new O({name:I.IM_MARK_AS_READ,params:i,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,success:a=>{n(a)},fail:a=>{o(a)}});m.Socket.e(r)})})}}kt.instance=new kt;class vn{constructor(){this.offsetMap=new Map,this.markingTime=0,this.userId=m.Socket.user().id}updateOffset(e,t){let i=this.offsetMap.get(e);return d.isDef(i)?t>i&&(this.offsetMap.set(e,t),!0):(this.offsetMap.set(e,t),!0)}updateUserOffsets(e){e.forEach(t=>{let i=t.userId,n=t.offset;this.updateOffset(i,n)})}updateMyOffset(e){return this.updateOffset(this.userId,e)}myOffset(){return this.getOffset(this.userId)}getOffset(e){return this.offsetMap.get(e)||0}}class zs{constructor(e,t,i,n,o){this.id=e,this.scene=t,this.lastTimestamp=i,this.limit=n,this.teamId=o}}class bn{constructor(e){this.history=e}pre(){this.oldLastMessage=this.history.getMaxMessage(),this.oldUnreadAmount=this.history.unreadAmount(),this.oldLastMessage&&(this.oldLastMessageRecalled=this.oldLastMessage.recalled,this.oldLastMessageRead=this.oldLastMessage.read,this.oldLastMessageStatus=this.oldLastMessage.status)}post(){let e,t,i,n=this.history.unreadAmount(),o=this.history.getMaxMessage();o&&(i=o.status,e=o.read,t=o.recalled);let r=this.history.target;this.oldLastMessage!==o||this.oldLastMessageRead!==e||this.oldLastMessageRecalled!==t||this.oldLastMessageStatus!==i?o?v.i.fire(b.MAX_MESSAGE_CHANGED,o):v.i.fire(b.MAX_MESSAGE_DELETED,r):this.oldUnreadAmount!==n&&v.i.fire(b.UNREAD_AMOUNT_CHANGED,r)}}class Ws{constructor(e,t,i,n){this.scene=e,this.conversationId=t,this.recaller=i,this.times=n}}class ee{static init(){this.eventCenter=new Ji}static on(e,t){this.eventCenter.on(e,t)}static fire(e,t){this.eventCenter.fire(e,t)}static off(e,t){this.eventCenter.off(e,t)}}(function(s){s.PRIVATE_MESSAGE_RECEIVED="PRIVATE_MESSAGE_RECEIVED",s.GROUP_MESSAGE_RECEIVED="GROUP_MESSAGE_RECEIVED",s.SYSTEM_MESSAGE_RECEIVED="SYSTEM_MESSAGE_RECEIVED",s.CONVERSATIONS_UPDATED="CONVERSATIONS_UPDATED",s.USER_PRESENCE="USER_PRESENCE",s.GROUP_PRESENCE="GROUP_PRESENCE",s.MESSAGE_DELETED="MESSAGE_DELETED",s.MESSAGE_READ="MESSAGE_READ",s.MESSAGE_RECALLED="MESSAGE_RECALLED",s.CS_MESSAGE_RECEIVED="CS_MESSAGE_RECEIVED",s.PENDING_CONVERSATIONS_UPDATED="PENDING_CONVERSATIONS_UPDATED"})(Q||(Q={}));class Wt{constructor(e){this.expiredTime=0,this.remoteHistory=kt.instance,this.target=e,this.userOffsets=new vn,this.messageCache=new ue(e)}initMaxMessageAndOffsets(e,t){this.existsMessage(e)||(this.messageCache.saveMessage(e),t.forEach(i=>{this.markLocalMessagesRead(this.messageCache.all(),i.userId,i.offset,!1)}))}existsMessage(e){return this.messageCache.existsMessage(e.messageId)}loadHistory(e,t){return E(this,void 0,void 0,function*(){return this.expiredTime>0&&!this.messageCache.isEmpty()&&(yield this.updateByServerChange()),d.isUndef(t)?t=10:t>30&&(t=30),yield this.loadServerMessages(e,t)})}loadServerMessages(e,t){return E(this,void 0,void 0,function*(){let i=this.messageCache.loadLocalMessages(t,e);if(this.messageCache.allLoaded===!1&&i.length!==t){let n=t-i.length,o=i[0]?i[0].timestamp:e,r=new zs(this.target.id.toString(),this.target.scene,o,n,this.target.teamId),a=yield this.remoteHistory.loadServerMessages(this.target,r),c=a.messages;i=c.concat(i),this.messageCache.cacheServerMessages(r,c),a.userOffsets.forEach(u=>{this.userOffsets.updateOffset(u.userId,u.offset)}),this.userOffsets.offsetMap.forEach((u,h)=>{this.markLocalMessagesRead(c,h,u,!1)})}return i})}deleteMessages(e){return E(this,void 0,void 0,function*(){yield this.aopUnreadAmountMaxMessage(()=>E(this,void 0,void 0,function*(){let t=e.messages;yield js.deleteServerMessages(t),this.messageCache.deleteMessages(t),S.onSuccess(e)}))})}syncDeletedMessage(e,t){this.aopUnreadAmountMaxMessage(()=>{this.doSyncDeletedMessage(e,t)})}doSyncDeletedMessage(e,t){if(e===m.Socket.user().id){let i=this.messageCache.findMessagesByTimes(t);this.messageCache.deleteMessages(i),i.length>0&&ee.fire(Q.MESSAGE_DELETED,i)}}recallMessages(e){return E(this,void 0,void 0,function*(){yield this.aopUnreadAmountMaxMessage(()=>E(this,void 0,void 0,function*(){this.doRecall(e)}))})}doRecall(e){let t=this.messageCache.recallMessage(e);t.length>0&&ee.fire(Q.MESSAGE_RECALLED,t)}expire(){this.messageCache.isEmpty()||(this.expiredTime=this.messageCache.maxSuccessMessageTime())}updateByServerChange(){return E(this,void 0,void 0,function*(){yield this.aopUnreadAmountMaxMessage(()=>E(this,void 0,void 0,function*(){let e=yield this.remoteHistory.sync(this.target.scene,this.target.id,this.expiredTime,this.messageCache.minTime(),this.target.teamId);e.userOffsets.forEach(n=>{this.markLocalMessagesRead(this.messageCache.all(),n.userId,n.offset,!0)});let t=e.deletedMessageTimes;t.length>0&&this.doSyncDeletedMessage(m.Socket.user().id,t);let i=e.recalledMessages;i.length>0&&i.forEach(n=>{let o=new Ws(this.target.scene,this.target.id,n.recaller,n.times);this.doRecall(o)}),this.expiredTime=0}))})}markRead(){return E(this,void 0,void 0,function*(){yield this.aopUnreadAmountMaxMessage(()=>E(this,void 0,void 0,function*(){let e=this.messageCache.maxSuccessMessageTime();e>this.userOffsets.myOffset()&&(this.userOffsets.markingTime=e,yield this.remoteHistory.updateServerOffsets(e,this.target),e===this.userOffsets.markingTime&&this.markLocalMessagesRead(this.messageCache.all(),m.Socket.user().id,e,!0))}))})}syncMarkedMessage(e){this.aopUnreadAmountMaxMessage(()=>{this.markLocalMessagesRead(this.messageCache.all(),e.markerId,e.time,!0)})}onMessageSending(e){this.aopUnreadAmountMaxMessage(()=>{this.messageCache.saveMessage(e)})}onMessageSendSuccess(e){this.aopUnreadAmountMaxMessage(()=>{this.messageCache.correctPosition(e),this.markLocalMessagesRead(this.messageCache.all(),m.Socket.user().id,e.timestamp,!0)})}onMessageSendFailed(e){this.getMaxMessage()===e&&v.i.fire(b.MAX_MESSAGE_CHANGED,e)}onMessageReceived(e){this.aopUnreadAmountMaxMessage(()=>{this.messageCache.saveMessage(e),this.markLocalMessagesRead(this.messageCache.all(),e.senderId,e.timestamp,!0)})}aopUnreadAmountMaxMessage(e,t){return E(this,void 0,void 0,function*(){try{let i=new bn(this);i.pre(),yield e(),i.post()}catch(i){S.onFailed(t,i)}})}markLocalMessagesRead(e,t,i,n){if(this.userOffsets.updateOffset(t,i),this.isOtherUserId(t)){let o=this.markMySentRead(e,i);n&&o.length>0&&ee.fire(Q.MESSAGE_READ,o)}else t===m.Socket.user().id&&this.markOthersSentRead(e,i)}markOthersSentRead(e,t){if(this.target.scene===y.PRIVATE)for(let i=e.length-1;i>=0;i--){let n=e[i];if(n.isOtherSent()&&n.timestamp<=t){if(n.read)break;n.read=!0}}}markMySentRead(e,t){let i=new Array;if(this.target.scene===y.PRIVATE)for(let n=e.length-1;n>=0;n--){let o=e[n];if(!o.isOtherSent()&&o.timestamp<=t&&o.status===q.SUCCESS){if(o.read)break;o.read=!0,i.push(o)}}return i}isOtherUserId(e){if(this.target.scene===y.CS){let t=this.target.customerId();return m.Socket.user().id===t?e!==m.Socket.user().id:e===t}return e!==m.Socket.user().id}unreadAmount(e){let t=0,i=this.userOffsets.myOffset(),n=this.messageCache.all();for(const o of n)o.isOtherSent()&&o.recalled===!1&&o.timestamp>i&&(t+=1);return t}getMaxMessage(e){return this.messageCache.getMaxMessage()}maxTime(e){let t=this.getMaxMessage();return d.isDef(t)?t.timestamp:0}}class ds{constructor(e,t){this.teamId=e,this.customerId=t}}class et{}class Cn{constructor(e,t,i){this.teamId=e,this.teamData=JSON.stringify(t),this.agentData=JSON.stringify(i)}}class wn{constructor(e){this.teamId=e}}class Mn{constructor(e){this.teamId=e}}var Pt={exports:{}},In=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Nn=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],Js=function(s){var e=s,t=s.indexOf("["),i=s.indexOf("]");t!=-1&&i!=-1&&(s=s.substring(0,t)+s.substring(t,i).replace(/:/g,";")+s.substring(i,s.length));for(var n=In.exec(s||""),o={},r=14;r--;)o[Nn[r]]=n[r]||"";return t!=-1&&i!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o},ae={exports:{}},Tt={exports:{}},je=1e3,Ve=60*je,He=60*Ve,ze=24*He,Tn=365.25*ze,On=function(s,e){e=e||{};var t=typeof s;if(t==="string"&&s.length>0)return function(i){if(i=String(i),!(i.length>100)){var n=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(i);if(n){var o=parseFloat(n[1]);switch((n[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return o*Tn;case"days":case"day":case"d":return o*ze;case"hours":case"hour":case"hrs":case"hr":case"h":return o*He;case"minutes":case"minute":case"mins":case"min":case"m":return o*Ve;case"seconds":case"second":case"secs":case"sec":case"s":return o*je;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}}}(s);if(t==="number"&&isNaN(s)===!1)return e.long?function(i){return st(i,ze,"day")||st(i,He,"hour")||st(i,Ve,"minute")||st(i,je,"second")||i+" ms"}(s):function(i){return i>=ze?Math.round(i/ze)+"d":i>=He?Math.round(i/He)+"h":i>=Ve?Math.round(i/Ve)+"m":i>=je?Math.round(i/je)+"s":i+"ms"}(s);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))};function st(s,e,t){if(!(s<e))return s<1.5*e?Math.floor(s/e)+" "+t:Math.ceil(s/e)+" "+t+"s"}(function(s,e){function t(n){var o;function r(){if(r.enabled){var a=r,c=+new Date,u=c-(o||c);a.diff=u,a.prev=o,a.curr=c,o=c;for(var h=new Array(arguments.length),p=0;p<h.length;p++)h[p]=arguments[p];h[0]=e.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");var l=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,function(f,C){if(f==="%%")return f;l++;var D=e.formatters[C];if(typeof D=="function"){var L=h[l];f=D.call(a,L),h.splice(l,1),l--}return f}),e.formatArgs.call(a,h),(r.log||e.log||console.log.bind(console)).apply(a,h)}}return r.namespace=n,r.enabled=e.enabled(n),r.useColors=e.useColors(),r.color=function(a){var c,u=0;for(c in a)u=(u<<5)-u+a.charCodeAt(c),u|=0;return e.colors[Math.abs(u)%e.colors.length]}(n),r.destroy=i,typeof e.init=="function"&&e.init(r),e.instances.push(r),r}function i(){var n=e.instances.indexOf(this);return n!==-1&&(e.instances.splice(n,1),!0)}(e=Tt.exports=t.debug=t.default=t).coerce=function(n){return n instanceof Error?n.stack||n.message:n},e.disable=function(){e.enable("")},e.enable=function(n){var o;e.save(n),e.names=[],e.skips=[];var r=(typeof n=="string"?n:"").split(/[\s,]+/),a=r.length;for(o=0;o<a;o++)r[o]&&((n=r[o].replace(/\*/g,".*?"))[0]==="-"?e.skips.push(new RegExp("^"+n.substr(1)+"$")):e.names.push(new RegExp("^"+n+"$")));for(o=0;o<e.instances.length;o++){var c=e.instances[o];c.enabled=e.enabled(c.namespace)}},e.enabled=function(n){if(n[n.length-1]==="*")return!0;var o,r;for(o=0,r=e.skips.length;o<r;o++)if(e.skips[o].test(n))return!1;for(o=0,r=e.names.length;o<r;o++)if(e.names[o].test(n))return!0;return!1},e.humanize=On,e.instances=[],e.names=[],e.skips=[],e.formatters={}})(0,Tt.exports),function(s,e){function t(){var i;try{i=e.storage.debug}catch{}return!i&&typeof process<"u"&&"env"in process&&(i={}.DEBUG),i}(e=s.exports=Tt.exports).log=function(){return typeof console=="object"&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},e.formatArgs=function(i){var n=this.useColors;if(i[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+i[0]+(n?"%c ":" ")+"+"+e.humanize(this.diff),!!n){var o="color: "+this.color;i.splice(1,0,o,"color: inherit");var r=0,a=0;i[0].replace(/%[a-zA-Z%]/g,function(c){c!=="%%"&&(r++,c==="%c"&&(a=r))}),i.splice(a,0,o)}},e.save=function(i){try{i==null?e.storage.removeItem("debug"):e.storage.debug=i}catch{}},e.load=t,e.useColors=function(){return typeof window<"u"&&window.process&&window.process.type==="renderer"?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=typeof chrome<"u"&&chrome.storage!==void 0?chrome.storage.local:function(){try{return window.localStorage}catch{}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.formatters.j=function(i){try{return JSON.stringify(i)}catch(n){return"[UnexpectedJSONParseError]: "+n.message}},e.enable(t())}(ae,ae.exports);var An=Js,hs=ae.exports("socket.io-client:url"),Rn=function(s,e){var t=s;e=e||typeof location<"u"&&location,s==null&&(s=e.protocol+"//"+e.host),typeof s=="string"&&(s.charAt(0)==="/"&&(s=s.charAt(1)==="/"?e.protocol+s:e.host+s),/^(https?|wss?):\/\//.test(s)||(hs("protocol-less url %s",s),s=e!==void 0?e.protocol+"//"+s:"https://"+s),hs("parse %s",s),t=An(s)),t.port||(/^(http|ws)$/.test(t.protocol)?t.port="80":/^(http|ws)s$/.test(t.protocol)&&(t.port="443")),t.path=t.path||"/";var i=t.host.indexOf(":")!==-1?"["+t.host+"]":t.host;return t.id=t.protocol+"://"+i+":"+t.port,t.href=t.protocol+"://"+i+(e&&e.port===t.port?"":":"+t.port),t},gt={},kn={}.toString,Xs=Array.isArray||function(s){return kn.call(s)=="[object Array]"};(function(s){ae.exports("socket.io-parser");var e=Te.exports,t=Xs;function i(){}s.protocol=4,s.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],s.CONNECT=0,s.DISCONNECT=1,s.EVENT=2,s.ACK=3,s.ERROR=4,s.BINARY_EVENT=5,s.BINARY_ACK=6,s.Encoder=i,s.Decoder=o;var n=s.ERROR+'"encode error"';function o(){this.reconstructor=null}function r(a){return{type:s.ERROR,data:"parser error: "+a}}i.prototype.encode=function(a,c){var u=function(h){var p=""+h.type;if(s.BINARY_EVENT!==h.type&&s.BINARY_ACK!==h.type||(p+=h.attachments+"-"),h.nsp&&h.nsp!=="/"&&(p+=h.nsp+","),h.id!=null&&(p+=h.id),h.data!=null){var l=function(f){try{return JSON.stringify(f)}catch{return!1}}(h.data);if(l===!1)return n;p+=l}return p}(a);c([u])},e(o.prototype),o.prototype.add=function(a){var c;if(typeof a!="string")throw new Error("Unknown type: "+a);c=function(u){var h=0,p={type:Number(u.charAt(0))};if(s.types[p.type]==null)return r("unknown packet type "+p.type);if(s.BINARY_EVENT===p.type||s.BINARY_ACK===p.type){for(var l="";u.charAt(++h)!=="-"&&(l+=u.charAt(h),h!=u.length););if(l!=Number(l)||u.charAt(h)!=="-")throw new Error("Illegal attachments");p.attachments=Number(l)}if(u.charAt(h+1)==="/")for(p.nsp="";++h&&!((C=u.charAt(h))===","||(p.nsp+=C,h===u.length)););else p.nsp="/";var f=u.charAt(h+1);if(f!==""&&Number(f)==f){for(p.id="";++h;){var C;if((C=u.charAt(h))==null||Number(C)!=C){--h;break}if(p.id+=u.charAt(h),h===u.length)break}p.id=Number(p.id)}if(u.charAt(++h)){var D=function(L){try{return JSON.parse(L)}catch{return!1}}(u.substr(h));if(!(D!==!1&&(p.type===s.ERROR||t(D))))return r("invalid payload");p.data=D}return p}(a),this.emit("decoded",c)},o.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()}})(gt);var _t={exports:{}},ct={},Ie={},Pn=Object.keys||function(s){var e=[],t=Object.prototype.hasOwnProperty;for(var i in s)t.call(s,i)&&e.push(i);return e},_n=Xs,$s=Object.prototype.toString,Dn=typeof Blob=="function"||typeof Blob<"u"&&$s.call(Blob)==="[object BlobConstructor]",xn=typeof File=="function"||typeof File<"u"&&$s.call(File)==="[object FileConstructor]",Ys=function s(e){if(!e||typeof e!="object")return!1;if(_n(e)){for(var t=0,i=e.length;t<i;t++)if(s(e[t]))return!0;return!1}if(typeof Buffer=="function"&&Buffer.isBuffer&&Buffer.isBuffer(e)||typeof ArrayBuffer=="function"&&e instanceof ArrayBuffer||Dn&&e instanceof Blob||xn&&e instanceof File)return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return s(e.toJSON(),!0);for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&s(e[n]))return!0;return!1},Un=function(s,e,t){var i=!1;return t=t||Fn,n.count=s,s===0?e():n;function n(o,r){if(n.count<=0)throw new Error("after called too many times");--n.count,o?(i=!0,e(o),e=t):n.count!==0||i||e(null,r)}};function Fn(){}var ut,lt,ge,me=String.fromCharCode;function ps(s){for(var e,t,i=[],n=0,o=s.length;n<o;)(e=s.charCodeAt(n++))>=55296&&e<=56319&&n<o?(64512&(t=s.charCodeAt(n++)))==56320?i.push(((1023&e)<<10)+(1023&t)+65536):(i.push(e),n--):i.push(e);return i}function Qs(s,e){if(s>=55296&&s<=57343){if(e)throw Error("Lone surrogate U+"+s.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function Ot(s,e){return me(s>>e&63|128)}function Gn(s,e){if(!(4294967168&s))return me(s);var t="";return 4294965248&s?4294901760&s?!(4292870144&s)&&(t=me(s>>18&7|240),t+=Ot(s,12),t+=Ot(s,6)):(Qs(s,e)||(s=65533),t=me(s>>12&15|224),t+=Ot(s,6)):t=me(s>>6&31|192),t+=me(63&s|128)}function Ae(){if(ge>=lt)throw Error("Invalid byte index");var s=255&ut[ge];if(ge++,(192&s)==128)return 63&s;throw Error("Invalid continuation byte")}function Ln(s){var e,t;if(ge>lt)throw Error("Invalid byte index");if(ge==lt)return!1;if(e=255&ut[ge],ge++,(128&e)==0)return e;if((224&e)==192){if((t=(31&e)<<6|Ae())>=128)return t;throw Error("Invalid continuation byte")}if((240&e)==224){if((t=(15&e)<<12|Ae()<<6|Ae())>=2048)return Qs(t,s)?t:65533;throw Error("Invalid continuation byte")}if((248&e)==240&&(t=(7&e)<<18|Ae()<<12|Ae()<<6|Ae())>=65536&&t<=1114111)return t;throw Error("Invalid UTF-8 detected")}var Bn={version:"2.1.2",encode:function(s,e){for(var t=(e=e||{}).strict!==!1,i=ps(s),n=i.length,o=-1,r="";++o<n;)r+=Gn(i[o],t);return r},decode:function(s,e){var t=(e=e||{}).strict!==!1;ut=ps(s),lt=ut.length,ge=0;for(var i,n=[];(i=Ln(t))!==!1;)n.push(i);return function(o){for(var r,a=o.length,c=-1,u="";++c<a;)(r=o[c])>65535&&(u+=me((r-=65536)>>>10&1023|55296),r=56320|1023&r),u+=me(r);return u}(n)}},De=De!==void 0?De:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"&&MozBlobBuilder,Ks=function(){try{return new Blob(["hi"]).size===2}catch{return!1}}(),qn=Ks&&function(){try{return new Blob([new Uint8Array([1,2])]).size===2}catch{return!1}}(),jn=De&&De.prototype.append&&De.prototype.getBlob;function Zs(s){return s.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var i=new Uint8Array(e.byteLength);i.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=i.buffer}return t}return e})}function ei(s,e){e=e||{};var t=new De;return Zs(s).forEach(function(i){t.append(i)}),e.type?t.getBlob(e.type):t.getBlob()}function ti(s,e){return new Blob(Zs(s),e||{})}typeof Blob<"u"&&(ei.prototype=Blob.prototype,ti.prototype=Blob.prototype);var Vn=Ks?qn?Blob:ti:jn?ei:void 0;(function(s){var e=Pn,t=Ys,i=Un,n=Bn;s.protocol=3;var o=s.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},r=e(o),a={type:"error",data:"parser error"},c=Vn;s.encodePacket=function(u,h,p,l){typeof h=="function"&&(l=h,h=!1),typeof p=="function"&&(l=p,p=null),u.data===void 0||u.data.buffer||u.data;var f=o[u.type];return u.data!==void 0&&(f+=p?n.encode(String(u.data),{strict:!1}):String(u.data)),l(""+f)},s.decodePacket=function(u,h,p){if(u===void 0)return a;if(typeof u=="string"){if(p&&(u=function(C){try{C=n.decode(C,{strict:!1})}catch{return!1}return C}(u))===!1)return a;var l=u.charAt(0);return Number(l)==l&&r[l]?u.length>1?{type:r[l],data:u.substring(1)}:{type:r[l]}:a}l=new Uint8Array(u)[0];var f=sliceBuffer(u,1);return c&&h==="blob"&&(f=new c([f])),{type:r[l],data:f}},s.encodePayload=function(u,h,p){typeof h=="function"&&(p=h,h=null);var l=t(u);if(!u.length)return p("0:");(function(f,C,D){for(var L=new Array(f.length),K=i(f.length,D),Oe=function(fi,gi,yi){C(gi,function(Si,Ei){L[fi]=Ei,yi(Si,L)})},Ke=0;Ke<f.length;Ke++)Oe(Ke,f[Ke],K)})(u,function(f,C){s.encodePacket(f,!!l&&h,!0,function(D){C(null,function(L){return L.length+":"+L}(D))})},function(f,C){return p(C.join(""))})},s.decodePayload=function(u,h,p){var l;if(typeof h=="function"&&(p=h,h=null),u==="")return p(a,0,1);for(var f,C,D="",L=0,K=u.length;L<K;L++){var Oe=u.charAt(L);if(Oe===":"){if(D===""||D!=(f=Number(D))||D!=(C=u.substr(L+1,f)).length)return p(a,0,1);if(C.length){if(l=s.decodePacket(C,h,!0),a.type===l.type&&a.data===l.data)return p(a,0,1);if(p(l,L+f,K)===!1)return}L+=f,D=""}else D+=Oe}return D!==""?p(a,0,1):void 0}})(Ie);var Hn=Ie,Jt=ie;function ie(s){this.path=s.path,this.hostname=s.hostname,this.port=s.port,this.secure=s.secure,this.query=s.query,this.timestampParam=s.timestampParam,this.timestampRequests=s.timestampRequests,this.readyState="",this.agent=s.agent||!1,this.socket=s.socket,this.enablesXDR=s.enablesXDR,this.pfx=s.pfx,this.key=s.key,this.passphrase=s.passphrase,this.cert=s.cert,this.ca=s.ca,this.ciphers=s.ciphers,this.rejectUnauthorized=s.rejectUnauthorized,this.forceNode=s.forceNode,this.isReactNative=s.isReactNative,this.extraHeaders=s.extraHeaders,this.localAddress=s.localAddress}(0,Te.exports)(ie.prototype),ie.prototype.onError=function(s,e){var t=new Error(s);return t.type="TransportError",t.description=e,this.emit("error",t),this},ie.prototype.open=function(){return this.readyState!=="closed"&&this.readyState!==""||(this.readyState="opening",this.doOpen()),this},ie.prototype.close=function(){return this.readyState!=="opening"&&this.readyState!=="open"||(this.doClose(),this.onClose()),this},ie.prototype.send=function(s){if(this.readyState!=="open")throw new Error("Transport not open");this.write(s)},ie.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},ie.prototype.onData=function(s){var e=Hn.decodePacket(s,this.socket.binaryType);this.onPacket(e)},ie.prototype.onPacket=function(s){this.emit("packet",s)},ie.prototype.onClose=function(){this.readyState="closed",this.emit("close")};var ms,yt={encode:function(s){var e="";for(var t in s)s.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(s[t]));return e},decode:function(s){for(var e={},t=s.split("&"),i=0,n=t.length;i<n;i++){var o=t[i].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}},Xt=function(s,e){var t=function(){};t.prototype=e.prototype,s.prototype=new t,s.prototype.constructor=s},si="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),dt=64,ii={},fs=0,ye=0;function Dt(s){var e="";do e=si[s%dt]+e,s=Math.floor(s/dt);while(s>0);return e}function xt(){var s=Dt(+new Date);return s!==ms?(fs=0,ms=s):s+"."+Dt(fs++)}for(;ye<dt;ye++)ii[si[ye]]=ye;xt.encode=Dt,xt.decode=function(s){var e=0;for(ye=0;ye<s.length;ye++)e=e*dt+ii[s.charAt(ye)];return e};var ni=xt,Ut={exports:{}};try{Ut.exports=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{Ut.exports=!1}var zn=Ut.exports,Wn=function(s){var e=s.xdomain,t=s.xscheme,i=s.enablesXDR;try{if(typeof XMLHttpRequest<"u"&&(!e||zn))return new XMLHttpRequest}catch{}try{if(typeof XDomainRequest<"u"&&!t&&i)return new XDomainRequest}catch{}if(!e)try{return new self[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}},oi=Jt,Jn=yt,gs=Ie,Xn=Xt,$n=ni,te=ae.exports("engine.io-client:polling"),Yn=ne,Qn=new Wn({xdomain:!1}).responseType!=null;function ne(s){var e=s&&s.forceBase64;Qn&&!e||(this.supportsBinary=!1),oi.call(this,s)}Xn(ne,oi),ne.prototype.name="polling",ne.prototype.doOpen=function(){this.poll()},ne.prototype.pause=function(s){var e=this;function t(){te("paused"),e.readyState="paused",s()}if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(te("we are currently polling - waiting to pause"),i++,this.once("pollComplete",function(){te("pre-pause polling complete"),--i||t()})),this.writable||(te("we are currently writing - waiting to pause"),i++,this.once("drain",function(){te("pre-pause writing complete"),--i||t()}))}else t()},ne.prototype.poll=function(){te("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},ne.prototype.onData=function(s){var e=this;te("polling got data %s",s),gs.decodePayload(s,this.socket.binaryType,function(t,i,n){if(e.readyState==="opening"&&e.onOpen(),t.type==="close")return e.onClose(),!1;e.onPacket(t)}),this.readyState!=="closed"&&(this.polling=!1,this.emit("pollComplete"),this.readyState==="open"?this.poll():te('ignoring poll - transport state "%s"',this.readyState))},ne.prototype.doClose=function(){var s=this;function e(){te("writing close packet"),s.write([{type:"close"}])}this.readyState==="open"?(te("transport open - closing"),e()):(te("transport not open - deferring close"),this.once("open",e))},ne.prototype.write=function(s){var e=this;this.writable=!1;var t=function(){e.writable=!0,e.emit("drain")};gs.encodePayload(s,this.supportsBinary,function(i){e.doWrite(i,t)})},ne.prototype.uri=function(){var s=this.query||{},e=this.secure?"https":"http",t="";return this.timestampRequests!==!1&&(s[this.timestampParam]=$n()),this.supportsBinary||s.sid||(s.b64=1),s=Jn.encode(s),this.port&&(e==="https"&&Number(this.port)!==443||e==="http"&&Number(this.port)!==80)&&(t=":"+this.port),s.length&&(s="?"+s),e+"://"+(this.hostname.indexOf(":")!==-1?"["+this.hostname+"]":this.hostname)+t+this.path+s};var it,Ft=Yn,Kn=ke,Zn=/\n/g,eo=/\\n/g;function to(){}function so(){return typeof self<"u"?self:typeof window<"u"?window:is!==void 0?is:{}}function ke(s){if(Ft.call(this,s),this.query=this.query||{},!it){var e=so();it=e.___eio=e.___eio||[]}this.index=it.length;var t=this;it.push(function(i){t.onData(i)}),this.query.j=this.index,typeof addEventListener=="function"&&addEventListener("beforeunload",function(){t.script&&(t.script.onerror=to)},!1)}Xt(ke,Ft),ke.prototype.supportsBinary=!1,ke.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),Ft.prototype.doClose.call(this)},ke.prototype.doPoll=function(){var s=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(i){s.onError("jsonp poll error",i)};var t=document.getElementsByTagName("script")[0];t?t.parentNode.insertBefore(e,t):(document.head||document.body).appendChild(e),this.script=e,typeof navigator<"u"&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var i=document.createElement("iframe");document.body.appendChild(i),document.body.removeChild(i)},100)},ke.prototype.doWrite=function(s,e){var t=this;if(!this.form){var i,n=document.createElement("form"),o=document.createElement("textarea"),r=this.iframeId="eio_iframe_"+this.index;n.className="socketio",n.style.position="absolute",n.style.top="-1000px",n.style.left="-1000px",n.target=r,n.method="POST",n.setAttribute("accept-charset","utf-8"),o.name="d",n.appendChild(o),document.body.appendChild(n),this.form=n,this.area=o}function a(){c(),e()}function c(){if(t.iframe)try{t.form.removeChild(t.iframe)}catch(h){t.onError("jsonp polling iframe removal error",h)}try{var u='<iframe src="javascript:0" name="'+t.iframeId+'">';i=document.createElement(u)}catch{(i=document.createElement("iframe")).name=t.iframeId,i.src="javascript:0"}i.id=t.iframeId,t.form.appendChild(i),t.iframe=i}this.form.action=this.uri(),c(),s=s.replace(eo,`\\
`),this.area.value=s.replace(Zn,"\\n");try{this.form.submit()}catch{}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){t.iframe.readyState==="complete"&&a()}:this.iframe.onload=a};var ht,ri,Gt=Jt,io=Ie,no=yt,oo=Xt,ro=ni,ys=ae.exports("engine.io-client:websocket");(typeof uni>"u"&&typeof wx>"u"&&typeof my>"u"&&typeof swan>"u"||typeof WebSocket<"u")&&(typeof WebSocket<"u"?ht=WebSocket:typeof self<"u"&&(ht=self.WebSocket||self.MozWebSocket));var ce=ht||ri;(typeof uni>"u"&&typeof wx>"u"&&typeof my>"u"&&typeof swan>"u"||typeof WebSocket<"u")&&typeof GameGlobal>"u"||(ce=function(s){var e=this;if(e.onopen=function(){},e.onclose=function(){},e.onmessage=function(n){},e.onerror=function(n){},typeof tt=="object"&&tt.getSystemInfo){let n=tt.connectSocket({url:s});e.send=function(o){n.send({data:o})},e.close=function(){n.close()},n.onOpen(function(){e.onopen()}),n.onError(function(o){e.onerror(o)}),n.onMessage(function(o){e.onmessage(o)}),n.onClose(function(){e.onclose()})}else if(typeof my<"u")my.connectSocket({url:s}),e.send=function(n){my.sendSocketMessage({data:n})},e.close=function(n){my.closeSocket()},my.onSocketOpen(function(n){e.onopen()}),my.onSocketError(function(n){e.onerror(n)}),my.onSocketMessage(function(n){e.onmessage(n)}),my.onSocketClose(n=>{e.onclose(n)});else if(typeof swan<"u")swan.connectSocket({url:s}),e.send=function(n){swan.sendSocketMessage({data:n})},e.close=function(n){swan.closeSocket()},swan.onSocketOpen(function(n){e.onopen()}),swan.onSocketError(function(n){e.onerror(n)}),swan.onSocketMessage(function(n){e.onmessage(n)}),swan.onSocketClose(n=>{e.onclose(n)});else if(typeof uni<"u"){var t=uni.connectSocket({url:s,complete:()=>{}});e.send=function(n){t.send({data:n})},e.close=function(){t.close()},t.onOpen(function(n){e.onopen()}),t.onError(function(n){e.onerror(n)}),t.onMessage(function(n){e.onmessage(n)}),t.onClose(function(n){e.onclose()})}else{var i=wx.connectSocket({url:s});e.send=function(n){i.send({data:n})},e.close=function(n){i.close({code:1e3})},i.onOpen(function(){e.onopen()}),i.onError(function(n){e.onerror(n)}),i.onMessage(function(n){e.onmessage(n)}),i.onClose(function(n){e.onclose(n)})}});var ao=Z;function Z(s){s&&s.forceBase64&&(this.supportsBinary=!1),(typeof uni>"u"&&typeof wx>"u"&&typeof my>"u"&&typeof swan>"u"||typeof WebSocket<"u")&&(this.perMessageDeflate=s.perMessageDeflate,this.usingBrowserWebSocket=ht&&!s.forceNode,this.protocols=s.protocols,this.usingBrowserWebSocket||(ce=ri)),Gt.call(this,s)}oo(Z,Gt),Z.prototype.name="websocket",Z.prototype.supportsBinary=!1,Z.prototype.doOpen=function(){if(this.check()){var s,e,t=this.uri();if((typeof uni>"u"&&typeof wx>"u"&&typeof my>"u"&&typeof swan>"u"||typeof WebSocket<"u")&&(s=this.protocols),(e=typeof uni>"u"&&typeof wx>"u"&&typeof my>"u"&&typeof swan>"u"||typeof WebSocket<"u"?{agent:this.agent,perMessageDeflate:this.perMessageDeflate}:{agent:this.agent}).pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,typeof navigator=="object"&&navigator.product==="ReactNative"&&(e={}),this.extraHeaders&&(e.headers=this.extraHeaders),this.localAddress&&(e.localAddress=this.localAddress),typeof cc<"u"&&cc.sys.os==="Windows")cc.resources.load("cacert",(i,n)=>{const o=n.nativeUrl;this.ws=new ce(t,[],o),this.ws.binaryType="arraybuffer",this.addEventListeners()});else{try{typeof uni>"u"&&typeof wx>"u"&&typeof my>"u"&&typeof swan>"u"||typeof WebSocket<"u"?this.ws=this.usingBrowserWebSocket&&!this.isReactNative?s?new ce(t,s):new ce(t):new ce(t,s,e):this.ws=new ce(t)}catch(i){return this.emit("error",i)}this.ws.binaryType===void 0&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}}},Z.prototype.addEventListeners=function(){var s=this;this.ws.onopen=function(){s.onOpen()},this.ws.onclose=function(){s.onClose()},this.ws.onmessage=function(e){s.onData(e.data)},this.ws.onerror=function(e){s.onError("websocket error",e)}},Z.prototype.write=function(s){var e=this;this.writable=!1;for(var t=s.length,i=0,n=t;i<n;i++)(function(r){io.encodePacket(r,e.supportsBinary,function(a){if(typeof uni>"u"&&typeof wx>"u"&&typeof my>"u"&&typeof swan>"u"||typeof WebSocket<"u"){if(!e.usingBrowserWebSocket){var c={};r.options&&(c.compress=r.options.compress),e.perMessageDeflate&&(typeof a=="string"?Buffer.byteLength(a):a.length)<e.perMessageDeflate.threshold&&(c.compress=!1)}try{e.usingBrowserWebSocket?e.ws.send(a):e.ws.send(a,c)}catch{ys("websocket closed before onclose event")}}else try{e.ws.send(a)}catch{ys("websocket closed before onclose event")}--t||o()})})(s[i]);function o(){e.emit("flush"),setTimeout(function(){e.writable=!0,e.emit("drain")},0)}},Z.prototype.onClose=function(){Gt.prototype.onClose.call(this)},Z.prototype.doClose=function(){this.ws!==void 0&&this.ws.close()},Z.prototype.uri=function(){var s=this.query||{},e=this.secure?"wss":"ws",t="";return this.port&&(e==="wss"&&Number(this.port)!==443||e==="ws"&&Number(this.port)!==80)&&(t=":"+this.port),this.timestampRequests&&(s[this.timestampParam]=ro()),this.supportsBinary||(s.b64=1),(s=no.encode(s)).length&&(s="?"+s),e+"://"+(this.hostname.indexOf(":")!==-1?"["+this.hostname+"]":this.hostname)+t+this.path+s},Z.prototype.check=function(){return!(!ce||"__initialize"in ce&&this.name===Z.prototype.name)};var co=Kn,uo=ao;ct.polling=function(s){var e=!1,t=!1;if(s.jsonp,typeof location<"u"){var i=location.protocol==="https:",n=location.port;n||(n=i?443:80),e=s.hostname!==location.hostname||n!==s.port,t=s.secure!==i}return s.xdomain=e,s.xscheme=t,new co(s)},ct.websocket=uo;var lo=[].indexOf,ai=function(s,e){if(lo)return s.indexOf(e);for(var t=0;t<s.length;++t)if(s[t]===e)return t;return-1},ho=ct,po=Te.exports,F=ae.exports("engine.io-client:socket"),mo=ai,Ss=Ie,Es=Js,fo=yt,go=R;function R(s,e){if(!(this instanceof R))return new R(s,e);e=e||{},s&&typeof s=="object"&&(e=s,s=null),s?(s=Es(s),e.hostname=s.host,e.secure=s.protocol==="https"||s.protocol==="wss",e.port=s.port,s.query&&(e.query=s.query)):e.host&&(e.hostname=Es(e.host).host),this.secure=e.secure!=null?e.secure:typeof location<"u"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.agent=e.agent||!1,this.hostname=e.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=e.port||(typeof location<"u"&&location.port?location.port:this.secure?443:80),this.query=e.query||{},typeof this.query=="string"&&(this.query=fo.decode(this.query)),this.upgrade=e.upgrade!==!1,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.jsonp=e.jsonp!==!1,this.forceBase64=!!e.forceBase64,this.enablesXDR=!!e.enablesXDR,this.timestampParam=e.timestampParam||"t",this.timestampRequests=e.timestampRequests,this.transports=e.transports||["polling","websocket"],this.transportOptions=e.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=e.policyPort||843,this.rememberUpgrade=e.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=e.onlyBinaryUpgrades,this.perMessageDeflate=e.perMessageDeflate!==!1&&(e.perMessageDeflate||{}),this.perMessageDeflate===!0&&(this.perMessageDeflate={}),this.perMessageDeflate&&this.perMessageDeflate.threshold==null&&(this.perMessageDeflate.threshold=1024),this.pfx=e.pfx||null,this.key=e.key||null,this.passphrase=e.passphrase||null,this.cert=e.cert||null,this.ca=e.ca||null,this.ciphers=e.ciphers||null,this.rejectUnauthorized=e.rejectUnauthorized===void 0||e.rejectUnauthorized,this.forceNode=!!e.forceNode,this.isReactNative=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",(typeof self>"u"||this.isReactNative)&&(e.extraHeaders&&Object.keys(e.extraHeaders).length>0&&(this.extraHeaders=e.extraHeaders),e.localAddress&&(this.localAddress=e.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}R.priorWebsocketSuccess=!1,po(R.prototype),R.protocol=Ss.protocol,R.Socket=R,R.Transport=Jt,R.transports=ct,R.parser=Ie,R.prototype.createTransport=function(s){F('creating transport "%s"',s);var e=function(i){var n={};for(var o in i)i.hasOwnProperty(o)&&(n[o]=i[o]);return n}(this.query);e.EIO=Ss.protocol,e.transport=s;var t=this.transportOptions[s]||{};return this.id&&(e.sid=this.id),new ho[s]({query:e,socket:this,agent:t.agent||this.agent,hostname:t.hostname||this.hostname,port:t.port||this.port,secure:t.secure||this.secure,path:t.path||this.path,forceJSONP:t.forceJSONP||this.forceJSONP,jsonp:t.jsonp||this.jsonp,forceBase64:t.forceBase64||this.forceBase64,enablesXDR:t.enablesXDR||this.enablesXDR,timestampRequests:t.timestampRequests||this.timestampRequests,timestampParam:t.timestampParam||this.timestampParam,policyPort:t.policyPort||this.policyPort,pfx:t.pfx||this.pfx,key:t.key||this.key,passphrase:t.passphrase||this.passphrase,cert:t.cert||this.cert,ca:t.ca||this.ca,ciphers:t.ciphers||this.ciphers,rejectUnauthorized:t.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:t.perMessageDeflate||this.perMessageDeflate,extraHeaders:t.extraHeaders||this.extraHeaders,forceNode:t.forceNode||this.forceNode,localAddress:t.localAddress||this.localAddress,requestTimeout:t.requestTimeout||this.requestTimeout,protocols:t.protocols||void 0,isReactNative:this.isReactNative})},R.prototype.open=function(){var s;if(this.rememberUpgrade&&R.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)s="websocket";else{if(this.transports.length===0){var e=this;return void setTimeout(function(){e.emit("error","No transports available")},0)}s=this.transports[0]}this.readyState="opening";try{s=this.createTransport(s)}catch{return this.transports.shift(),void this.open()}s.open(),this.setTransport(s)},R.prototype.setTransport=function(s){F("setting transport %s",s.name);var e=this;this.transport&&(F("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=s,s.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},R.prototype.probe=function(s){F('probing transport "%s"',s);var e=this.createTransport(s,{probe:1}),t=!1,i=this;function n(){if(i.onlyBinaryUpgrades){var p=!this.supportsBinary&&i.transport.supportsBinary;t=t||p}t||(F('probe transport "%s" opened',s),e.send([{type:"ping",data:"probe"}]),e.once("packet",function(l){if(!t)if(l.type==="pong"&&l.data==="probe"){if(F('probe transport "%s" pong',s),i.upgrading=!0,i.emit("upgrading",e),!e)return;R.priorWebsocketSuccess=e.name==="websocket",F('pausing current transport "%s"',i.transport.name),i.transport.pause(function(){t||i.readyState!=="closed"&&(F("changing transport and sending upgrade packet"),h(),i.setTransport(e),e.send([{type:"upgrade"}]),i.emit("upgrade",e),e=null,i.upgrading=!1,i.flush())})}else{F('probe transport "%s" failed',s);var f=new Error("probe error");f.transport=e.name,i.emit("upgradeError",f)}}))}function o(){t||(t=!0,h(),e.close(),e=null)}function r(p){var l=new Error("probe error: "+p);l.transport=e.name,o(),F('probe transport "%s" failed because of error: %s',s,p),i.emit("upgradeError",l)}function a(){r("transport closed")}function c(){r("socket closed")}function u(p){e&&p.name!==e.name&&(F('"%s" works - aborting "%s"',p.name,e.name),o())}function h(){e.removeListener("open",n),e.removeListener("error",r),e.removeListener("close",a),i.removeListener("close",c),i.removeListener("upgrading",u)}R.priorWebsocketSuccess=!1,e.once("open",n),e.once("error",r),e.once("close",a),this.once("close",c),this.once("upgrading",u),e.open()},R.prototype.onOpen=function(){if(F("socket open"),this.readyState="open",R.priorWebsocketSuccess=this.transport.name==="websocket",this.emit("open"),this.flush(),this.readyState==="open"&&this.upgrade&&this.transport.pause){F("starting upgrade probes");for(var s=0,e=this.upgrades.length;s<e;s++)this.probe(this.upgrades[s])}},R.prototype.onPacket=function(s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(F('socket receive: type "%s", data "%s"',s.type,s.data),this.emit("packet",s),this.emit("heartbeat"),s.type){case"open":this.onHandshake(JSON.parse(s.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var e=new Error("server error");e.code=s.data,this.onError(e);break;case"message":this.emit("data",s.data),this.emit("message",s.data)}else F('packet received with socket readyState "%s"',this.readyState)},R.prototype.onHandshake=function(s){this.emit("handshake",s),this.id=s.sid,this.transport.query.sid=s.sid,this.upgrades=this.filterUpgrades(s.upgrades),this.pingInterval=s.pingInterval,this.pingTimeout=s.pingTimeout,this.onOpen(),this.readyState!=="closed"&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},R.prototype.onHeartbeat=function(s){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){e.readyState!=="closed"&&e.onClose("ping timeout")},s||e.pingInterval+e.pingTimeout)},R.prototype.setPing=function(){var s=this;clearTimeout(s.pingIntervalTimer),s.pingIntervalTimer=setTimeout(function(){F("writing ping packet - expecting pong within %sms",s.pingTimeout),s.ping(),s.onHeartbeat(s.pingTimeout)},s.pingInterval)},R.prototype.ping=function(){var s=this;this.sendPacket("ping",function(){s.emit("ping")})},R.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emit("drain"):this.flush()},R.prototype.flush=function(){this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(F("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},R.prototype.write=R.prototype.send=function(s,e,t){return this.sendPacket("message",s,e,t),this},R.prototype.sendPacket=function(s,e,t,i){if(typeof e=="function"&&(i=e,e=void 0),typeof t=="function"&&(i=t,t=null),this.readyState!=="closing"&&this.readyState!=="closed"){(t=t||{}).compress=t.compress!==!1;var n={type:s,data:e,options:t};this.emit("packetCreate",n),this.writeBuffer.push(n),i&&this.once("flush",i),this.flush()}},R.prototype.close=function(){if(this.readyState==="opening"||this.readyState==="open"){this.readyState="closing";var s=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?i():e()}):this.upgrading?i():e()}function e(){s.onClose("forced close"),F("socket closing - telling transport to close"),s.transport.close()}function t(){s.removeListener("upgrade",t),s.removeListener("upgradeError",t),e()}function i(){s.once("upgrade",t),s.once("upgradeError",t)}return this},R.prototype.onError=function(s){F("socket error %j",s),R.priorWebsocketSuccess=!1,this.emit("error",s),this.onClose("transport error",s)},R.prototype.onClose=function(s,e){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(F('socket close with reason: "%s"',s),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",s,e),this.writeBuffer=[],this.prevBufferLen=0)},R.prototype.filterUpgrades=function(s){for(var e=[],t=0,i=s.length;t<i;t++)~mo(this.transports,s[t])&&e.push(s[t]);return e},_t.exports=go,_t.exports.parser=Ie;var $t={exports:{}},yo=function(s,e){for(var t=[],i=(e=e||0)||0;i<s.length;i++)t[i-e]=s[i];return t},ci=function(s,e,t){return s.on(e,t),{destroy:function(){s.removeListener(e,t)}}},vs=[].slice,ui=function(s,e){if(typeof e=="string"&&(e=s[e]),typeof e!="function")throw new Error("bind() requires a function");var t=vs.call(arguments,2);return function(){return e.apply(s,t.concat(vs.call(arguments)))}};(function(s,e){var t=gt,i=Te.exports,n=yo,o=ci,r=ui,a=(ae.exports("socket.io-client:socket"),yt),c=Ys;s.exports=p;var u={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},h=i.prototype.emit;function p(l,f,C){this.io=l,this.nsp=f,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},C&&C.query&&(this.query=C.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var l=this.io;this.subs=[o(l,"open",r(this,"onopen")),o(l,"packet",r(this,"onpacket")),o(l,"close",r(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected||(this.subEvents(),this.io.open(),this.io.readyState==="open"&&this.onopen(),this.emit("connecting")),this},p.prototype.send=function(){var l=n(arguments);return l.unshift("message"),this.emit.apply(this,l),this},p.prototype.emit=function(l){if(u.hasOwnProperty(l))return h.apply(this,arguments),this;var f=n(arguments),C={type:(this.flags.binary!==void 0?this.flags.binary:c(f))?t.BINARY_EVENT:t.EVENT,data:f,options:{}};return C.options.compress=!this.flags||this.flags.compress!==!1,typeof f[f.length-1]=="function"&&(this.ids,this.acks[this.ids]=f.pop(),C.id=this.ids++),this.connected?this.packet(C):this.sendBuffer.push(C),this.flags={},this},p.prototype.packet=function(l){l.nsp=this.nsp,this.io.packet(l)},p.prototype.onopen=function(){if(this.nsp!=="/")if(this.query){var l=typeof this.query=="object"?a.encode(this.query):this.query;this.packet({type:t.CONNECT,query:l})}else this.packet({type:t.CONNECT})},p.prototype.onclose=function(l){this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",l)},p.prototype.onpacket=function(l){var f=l.nsp===this.nsp,C=l.type===t.ERROR&&l.nsp==="/";if(f||C)switch(l.type){case t.CONNECT:this.onconnect();break;case t.EVENT:case t.BINARY_EVENT:this.onevent(l);break;case t.ACK:case t.BINARY_ACK:this.onack(l);break;case t.DISCONNECT:this.ondisconnect();break;case t.ERROR:this.emit("error",l.data)}},p.prototype.onevent=function(l){var f=l.data||[];l.id!=null&&f.push(this.ack(l.id)),this.connected?h.apply(this,f):this.receiveBuffer.push(f)},p.prototype.ack=function(l){var f=this,C=!1;return function(){if(!C){C=!0;var D=n(arguments);f.packet({type:c(D)?t.BINARY_ACK:t.ACK,id:l,data:D})}}},p.prototype.onack=function(l){var f=this.acks[l.id];typeof f=="function"?(l.id,l.data,f.apply(this,l.data),delete this.acks[l.id]):l.id},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var l;for(l=0;l<this.receiveBuffer.length;l++)h.apply(this,this.receiveBuffer[l]);for(this.receiveBuffer=[],l=0;l<this.sendBuffer.length;l++)this.packet(this.sendBuffer[l]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){this.nsp,this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var l=0;l<this.subs.length;l++)this.subs[l].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(this.nsp,this.packet({type:t.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(l){return this.flags.compress=l,this},p.prototype.binary=function(l){return this.flags.binary=l,this}})($t);var So=Pe;function Pe(s){s=s||{},this.ms=s.min||100,this.max=s.max||1e4,this.factor=s.factor||2,this.jitter=s.jitter>0&&s.jitter<=1?s.jitter:0,this.attempts=0}Pe.prototype.duration=function(){var s=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*s);s=1&Math.floor(10*e)?s+t:s-t}return 0|Math.min(s,this.max)},Pe.prototype.reset=function(){this.attempts=0},Pe.prototype.setMin=function(s){this.ms=s},Pe.prototype.setMax=function(s){this.max=s},Pe.prototype.setJitter=function(s){this.jitter=s};class xe{static init(e,t,i){this.host=e,(t!==void 0&&t===!1||i===!0)&&(this.https=!1)}static isMP(){return[N.MP_WX,N.MP_ALI,N.MP_BYTE,N.MP_WGAME,N.MP_BAIDU].includes(H.currentPlatform())}static uri(){let e="http";return this.https&&(e+="s"),e+"://"+this.index()+this.host}static index(){return this.i==0?this.i=Math.floor(Math.random()*(this.max-1)+1):this.i=this.i%this.max+1,this.i}}xe.i=0,xe.max=5,xe.https=!0;var Eo=ks(Object.freeze({__proto__:null,URIResolver:xe})),vo=ks(xi),bo=_t.exports,Co=$t.exports,wo=Te.exports,Mo=gt,he=ci,Re=ui,bs=(ae.exports("socket.io-client:manager"),ai),Io=So;const{URIResolver:No}=Eo;var Cs=vo.runStatus,ws=Object.prototype.hasOwnProperty,Ms=P;function P(s,e){if(!(this instanceof P))return new P(s,e);s&&typeof s=="object"&&(e=s,s=void 0),(e=e||{}).path=e.path||"/socket.io",this.nsps={},this.subs=[],this.opts=e,this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(e.randomizationFactor||.5),this.backoff=new Io({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this.readyState="closed",this.uri=s,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var t=e.parser||Mo;this.encoder=new t.Encoder,this.decoder=new t.Decoder,this.autoConnect=e.autoConnect!==!1,this.autoConnect&&this.open()}P.prototype.emitAll=function(){for(var s in this.emit.apply(this,arguments),this.nsps)ws.call(this.nsps,s)&&this.nsps[s].emit.apply(this.nsps[s],arguments)},P.prototype.updateSocketIds=function(){for(var s in this.nsps)ws.call(this.nsps,s)&&(this.nsps[s].id=this.generateId(s))},P.prototype.generateId=function(s){return(s==="/"?"":s+"#")+this.engine.id},wo(P.prototype),P.prototype.reconnection=function(s){return arguments.length?(this._reconnection=!!s,this):this._reconnection},P.prototype.reconnectionAttempts=function(s){return arguments.length?(this._reconnectionAttempts=s,this):this._reconnectionAttempts},P.prototype.reconnectionDelay=function(s){return arguments.length?(this._reconnectionDelay=s,this.backoff&&this.backoff.setMin(s),this):this._reconnectionDelay},P.prototype.randomizationFactor=function(s){return arguments.length?(this._randomizationFactor=s,this.backoff&&this.backoff.setJitter(s),this):this._randomizationFactor},P.prototype.reconnectionDelayMax=function(s){return arguments.length?(this._reconnectionDelayMax=s,this.backoff&&this.backoff.setMax(s),this):this._reconnectionDelayMax},P.prototype.timeout=function(s){return arguments.length?(this._timeout=s,this):this._timeout},P.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()},P.prototype.open=P.prototype.connect=function(s,e){if(this.readyState,~this.readyState.indexOf("open"))return this;this.uri,this.engine=bo(this.uri,this.opts);var t=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var n=he(t,"open",function(){i.onopen(),s&&s()}),o=he(t,"error",async function(c){if(i.uri=No.uri(),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",c),s){var u=new Error("Connection error");u.data=c,s(u)}else i.maybeReconnectOnOpen()});if(this._timeout!==!1){var r=this._timeout,a=setTimeout(function(){n.destroy(),t.close(),t.emit("error","timeout"),i.emitAll("connect_timeout",r)},r);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(n),this.subs.push(o),this},P.prototype.onopen=function(){this.cleanup(),this.readyState="open",this.emit("open");var s=this.engine;this.subs.push(he(s,"data",Re(this,"ondata"))),this.subs.push(he(s,"ping",Re(this,"onping"))),this.subs.push(he(s,"pong",Re(this,"onpong"))),this.subs.push(he(s,"error",Re(this,"onerror"))),this.subs.push(he(s,"close",Re(this,"onclose"))),this.subs.push(he(this.decoder,"decoded",Re(this,"ondecoded")))},P.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},P.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},P.prototype.ondata=function(s){this.decoder.add(s)},P.prototype.ondecoded=function(s){this.emit("packet",s)},P.prototype.onerror=function(s){this.emitAll("error",s)},P.prototype.socket=function(s,e){var t=this.nsps[s];if(!t){t=new Co(this,s,e),this.nsps[s]=t;var i=this;t.on("connecting",n),t.on("connect",function(){t.id=i.generateId(s)}),this.autoConnect&&n()}function n(){~bs(i.connecting,t)||i.connecting.push(t)}return t},P.prototype.destroy=function(s){var e=bs(this.connecting,s);~e&&this.connecting.splice(e,1),this.connecting.length||this.close()},P.prototype.packet=function(s){var e=this;s.query&&s.type===0&&(s.nsp+="?"+s.query),e.encoding?e.packetBuffer.push(s):(e.encoding=!0,this.encoder.encode(s,function(t){for(var i=0;i<t.length;i++)e.engine.write(t[i],s.options);e.encoding=!1,e.processPacketQueue()}))},P.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var s=this.packetBuffer.shift();this.packet(s)}},P.prototype.cleanup=function(){for(var s=this.subs.length,e=0;e<s;e++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},P.prototype.close=P.prototype.disconnect=function(){this.skipReconnect=!0,this.reconnecting=!1,this.readyState==="opening"&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},P.prototype.onclose=function(s){this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",s),this._reconnection&&!this.skipReconnect&&this.reconnect()},P.prototype.reconnect=function(){if(Cs.isBackend(),this.reconnecting||this.skipReconnect)return this;var s=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var e=this.backoff.duration();this.reconnecting=!0;var t=setTimeout(function(){if(Cs.isBackend())return s.reconnecting=!1,s.reconnect(),void s.emitAll("reconnect_error","Uniapp running backend, skipped reconnect...");s.skipReconnect||(s.emitAll("reconnect_attempt",s.backoff.attempts),s.emitAll("reconnecting",s.backoff.attempts),s.skipReconnect||s.open(function(i){i?(s.reconnecting=!1,s.reconnect(),s.emitAll("reconnect_error",i.data)):s.onreconnect()}))},e);this.subs.push({destroy:function(){clearTimeout(t)}})}},P.prototype.onreconnect=function(){var s=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",s)},function(s,e){var t=Rn,i=gt,n=Ms;ae.exports("socket.io-client"),s.exports=e=r;var o=e.managers={};function r(a,c){typeof a=="object"&&(c=a,a=void 0),c=c||{};var u,h=t(a),p=h.source,l=h.id,f=h.path,C=o[l]&&f in o[l].nsps;return c.forceNew||c["force new connection"]||c.multiplex===!1||C?u=n(p,c):(o[l]||(o[l]=n(p,c)),u=o[l]),h.query&&!c.query&&(c.query=h.query),u.socket(h.path,c)}e.protocol=i.protocol,e.connect=r,e.Manager=Ms,e.Socket=$t.exports}(Pt,Pt.exports);const To=Pt.exports;class li{constructor(){this.io=To,this.status=A.DISCONNECTED,this.permissions=[M.NONE],this.connectedObservers=[],this.disconnectedObservers=[]}connect(){this.status=A.CONNECTING}socketio(){return this.io}on(e,t){this.io.on(e,t)}disconnect(){this.io.disconnect()}getStatus(){return this.status}addConnectedObserver(e){d.isFunction(e)&&this.connectedObservers.push(e)}addDisconnectedObserver(e){d.isFunction(e)&&this.disconnectedObservers.push(e)}notify(e,t){for(let i=0;i<e.length;i++)e[i](t)}}class Oo extends li{constructor(e){super(),this.reconnectingObservers=[],this.addReconnectingObserver(e.onReconnecting),this.addDisconnectedObserver(e.onDisconnected)}connect(e){super.connect(),this.io=this.io.connect(e.uri,e.opts),this.initListener()}initListener(){this.io.on("connect",()=>{this.status=A.CONNECTED,this.notify(this.connectedObservers)}),this.io.on("reconnecting",e=>{this.status=A.CONNECTING,this.notify(this.reconnectingObservers,e)}),this.io.on("disconnect",()=>{this.status=A.DISCONNECTED,this.notify(this.disconnectedObservers)}),this.io.on("connect_error",function(e){})}addReconnectingObserver(e){this.reconnectingObservers.push(e)}}class Je{static get(e){const t=encodeURIComponent(e)+"=",i=document.cookie.split("; ");for(const n of i)if(n.startsWith(t))return decodeURIComponent(n.substring(t.length));return null}static set(e,t,i,n,o="/",r=!1){let a=encodeURIComponent(e)+"="+encodeURIComponent(t);i instanceof Date&&(a+="; expires="+i.toGMTString()),o&&(a+="; path="+o),n&&(a+="; domain="+n),r&&(a+="; secure"),document.cookie=a}static remove(e,t,i="/",n=!1){Je.set(e,"",new Date(0),t,i,n)}}class de{asyncGet(e){let t=this.get(e);return Promise.resolve(t)}asyncPut(e,t){return this.put(e,t),Promise.resolve()}get(e){let t=this.doGet(e);return t=JSON.parse(t),t}put(e,t){this.doPut(e,JSON.stringify(t))}}class Ao extends de{constructor(){super(),this.domain=null,this.domain=typeof location<"u"&&/^(?:[A-za-z0-9-]+\.)+[A-za-z]{2,4}(?:[\/\?#][\/=\?%\-&~`@[\]\':+!\.#\w]*)?$/.test(location.host)?location.host.split(".").slice(-2).join("."):null}doGet(e){return Je.get(e)||null}doPut(e,t){const i=new Date(2030,12,31,0,0,0,0),n=this.domain;Je.set(e,t,i,n)}remove(e){const t=this.domain;Je.remove(e,t)}support(){return typeof navigator<"u"&&navigator.cookieEnabled===!0}}class Ro extends de{doGet(e){return localStorage.getItem(e)||null}doPut(e,t){localStorage.setItem(e,t)}remove(e){localStorage.removeItem(e)}support(){return!(typeof GameGlobal<"u"||typeof localStorage>"u"||!localStorage.setItem)}}class ko extends de{doGet(e){return uni.getStorageSync(e)||null}doPut(e,t){uni.setStorageSync(e,t)}remove(e){uni.removeStorageSync(e)}support(){return!(typeof uni!="object"||!uni.getStorageSync)}}class Po extends de{doGet(e){return cc.sys.localStorage.getItem(e)||null}doPut(e,t){cc.sys.localStorage.setItem(e,t)}remove(e){cc.sys.localStorage.removeItem(e)}support(){return typeof cc<"u"&&cc.sys.localStorage!==void 0}}class _o extends de{doGet(e){return wx.getStorageSync(e)||null}doPut(e,t){wx.setStorageSync(e,t)}remove(e){wx.removeStorageSync(e)}support(){return!(typeof wx!="object"||!wx.getStorageSync||typeof tt<"u")}}class Do extends de{asyncGet(e){return E(this,void 0,void 0,function*(){const t=yield Me.asyncStorage.getItem(e);return JSON.parse(t)})}asyncPut(e,t){return Me.asyncStorage.setItem(e,JSON.stringify(t))}doPut(e,t){throw new Error("Method not implemented.")}remove(e){Me.asyncStorage.removeItem(e)}support(){return ve.currentFramework()===j.REACT_NATIVE}doGet(e){throw new Error("Method not implemented.")}}class xo extends de{doGet(e){const t=my.getStorageSync({key:e}).data||null;return typeof JSON.parse(t)=="string"?JSON.parse(t):t}doPut(e,t){my.setStorageSync({key:e,data:JSON.stringify(t)})}remove(e){my.removeStorageSync({key:e})}support(){return!(typeof my>"u"||!my.getStorageSync)}}class Uo extends de{doGet(e){return tt.getStorageSync(e)||null}doPut(e,t){tt.setStorageSync(e,t)}remove(e){tt.removeStorageSync(e)}support(){return!(typeof tt!="object"||!tt.getStorageSync)}}class Fo extends de{doGet(e){return swan.getStorageSync(e)||null}doPut(e,t){swan.setStorageSync(e,t)}remove(e){swan.removeStorageSync(e)}support(){return!(typeof swan>"u"||!swan.getStorageSync)}}class Se{constructor(){this.supportedStorage=null;const e=Se.storages;e.push(new ko),e.push(new Po),e.push(new Ro),e.push(new _o),e.push(new Do),e.push(new xo),e.push(new Fo),e.push(new Uo),e.push(new Ao),this.dispatch(),this.supportedStorage}static localStorage(){return this.instance.supportedStorage}dispatch(){for(let e of Se.storages)if(e.support()){this.supportedStorage=e;break}}}Se.storages=new Array,Se.instance=new Se;class Ue{static get(){return E(this,void 0,void 0,function*(){let e,t=Se.localStorage();return t!==null&&(e=yield t.asyncGet(Ue.SM_KEY)),e})}static put(e){return E(this,void 0,void 0,function*(){var t=Se.localStorage();let i=e.sm;t!==null&&i&&t.asyncPut(Ue.SM_KEY,i)})}}Ue.SM_KEY="GE-SM";class Go{static e(e,t){function i(o){return function(r){return r>=32&&r<=126}(o)?String.fromCharCode(function(r){let a=r+t;return a>126?a-126+32:a}(o)):String.fromCharCode(o)}let n="";for(let o=0;o<e.length;o++)n+=i(e.charCodeAt(o));return n}}class Lo{static initRNUniqueId(){if(ve.currentFramework()===j.REACT_NATIVE){let e=Me.platform,t=e.constants,i={os:e.OS};return i.os==="android"?i.f=t.Fingerprint:i.v=e.Version,JSON.stringify(i)}return null}static initPlusDeviceId(){return new Promise((e,t)=>{typeof plus<"u"?plus.device.getInfo({success:i=>{e(i.uuid)},fail:i=>{t(i)}}):e(null)})}static getVideoCard(){var e;if(H.currentPlatform()===N.BROWSER&&typeof document<"u"){const t=document.createElement("canvas"),i=(e=t.getContext("webgl"))!==null&&e!==void 0?e:t.getContext("experimental-webgl");if(i&&"getExtension"in i){let n=0,o=0;if(navigator.userAgent.indexOf("Firefox")>-1)o=i.VENDOR,n=i.RENDERER;else{let a=i.getExtension("WEBGL_debug_renderer_info");if(!a)return null;o=a.UNMASKED_VENDOR_WEBGL,n=a.UNMASKED_RENDERER_WEBGL}const r={vendor:(i.getParameter(o)||"").toString(),renderer:(i.getParameter(n)||"").toString()};return JSON.stringify(r)}}return null}static z(){return E(this,void 0,void 0,function*(){const e={p:H.currentPlatform(),f:ve.currentFramework(),vc:this.getVideoCard(),rfp:this.initRNUniqueId()};return Go.e(JSON.stringify(e),5)})}}class di{constructor(e){this.rocketsBuffer=new Set,this.socket=e,this.socket.addConnectedObserver(this.onSocketConnected.bind(this))}emit(e){this.socket.status!==A.DISCONNECTED?(e.start(),this.doEmit(e)):e.fail({resultCode:"409",content:"Please connect first"})}doEmit(e){if(!e.complete)if(this.socket.status!==A.CONNECT_FAILED)if(this.isConnected())if(this.hasPermission(e)){let t=setTimeout(()=>{this.doEmit(e)},e.singleTimeout);e.unique&&(e.params.retried=e.retried),this.socket.socketio().emit(e.name,e.params,i=>{clearTimeout(t),i.resultCode===200||i.code==200?e.success(i):e.fail(i)}),e.retried++}else e.fail({resultCode:401,content:"No permission"});else this.isConnecting()&&this.rocketsBuffer.add(e);else e.fail({resultCode:408,content:"Failed to connect GoEasy."})}hasPermission(e){return!!this.socket.permissions.find(t=>t===e.permission)}isConnected(){return[A.CONNECTED,A.RECONNECTED,A.EXPIRED_RECONNECTED,A.DISCONNECTING].includes(this.socket.status)}isConnecting(){return[A.CONNECTING,A.RECONNECTING].includes(this.socket.status)}onSocketConnected(){this.emitBuffer()}emitBuffer(){Array.from(this.rocketsBuffer).forEach(e=>{this.rocketsBuffer.delete(e),this.doEmit(e)})}}class W extends Us{static init(){W.i=new W}static fire(e,t){this.i.fire(e,t)}static on(e,t){this.i.on(e,t)}static off(e,t){this.i.off(e,t)}}class Bo extends li{constructor(e,t){super(),this.ioSocket=null,this.sid=null,this.anonymous=!1,this.userId=null,this.artifactVersion=qt,this.vname=null,this.uri=null,this.ioOpts=null,this.reconnectingTimes=0,this.messageObservers=new Map,this.connectFailedObservers=[],this.connectingObservers=[],this.expiredReconnectedObservers=[],this.options=e,this.ioSocket=new Oo({onDisconnected:this.onIoDisconnected.bind(this),onReconnecting:this.onIoReconnecting.bind(this)}),this.ioSocketEmitter=new di(this.ioSocket),this.ioSocket.addConnectedObserver(this.onIoReconnected.bind(this)),this.initOptions(t),this.connect()}initUserId(){let e=this.connectOptions.id;d.isEmpty(e)?this.anonymous=!0:this.userId=e.toString()}socketio(){return this.ioSocket.socketio()}extendOptions(){let e=this.connectOptions;if(d.isNull(e.data)||d.isDef(e.data)&&!d.isObject(e.data))throw{code:400,content:"TypeError: data requires an object."};if((d.isDef(e.data)?String(e.data).length:0)>300&&d.isObject(e)&&d.isFunction(e.onFailed))throw{code:400,content:"user.data-length limit 300 byte."};if(d.isObject(e.wxmpId)){if(d.isEmpty(e.wxmpId.appid))throw{code:400,content:"wxmpId.appid is required."};if(d.isEmpty(e.wxmpId.openid))throw{code:400,content:"wxmpId.openid is required. requires string."}}else if(d.isPrimitive(e.wxmpId))throw{code:400,content:"TypeError: wxmpId requires an object."}}initUriAndOpts(){let e=this.options;xe.init(e.host,e.forceTLS,e.supportOldBrowser),this.uri=xe.uri();let t=["websocket"];e.supportOldBrowser===!0&&t.push("polling"),this.ioOpts={transports:t,timeout:g.connect,reconnectionDelayMax:g.reconnectionDelayMax}}onIoReconnected(){this.status===A.RECONNECTING&&this.authorize()}sendAck(e,t){this.ioSocket.io.emit(e,t)}initOptions(e){this.connectOptions=e,this.addConnectedObserver(e.onSuccess),this.addConnectFailedObserver(e.onFailed),this.addConnectingObserver(e.onProgress),this.initUserId()}connect(){this.initUriAndOpts(),this.extendOptions(),super.connect(),this.onConnecting(),this.ioSocket.connect({uri:this.uri,opts:this.ioOpts}),this.authorize()}disconnect(){return new Promise((e,t)=>{this.status=A.DISCONNECTING;let i=()=>{this.ioSocket.disconnect(),this.status=A.DISCONNECTED,W.fire(B.DISCONNECTED),e()};const n=Y.modules.get("GN");if(n&&(n.params.regId||this.connectOptions.wxmpId)){let o=a=>{t(a)},r=new O({name:I.manualDisconnect,params:{},permission:M.READ,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:o,success:i});m.Socket.e(r)}else i()})}authorize(){return E(this,void 0,void 0,function*(){let e=this.connectOptions,t={appkey:this.options.appkey,userId:this.userId,userData:JSON.stringify(e.data),otp:e.otp,artifactVersion:this.artifactVersion,sid:this.sid,mP:yield Y.getParams(),a:this.anonymous,z:yield Lo.z(),sm:yield Ue.get(),c:{n:this.vname,v:this.artifactVersion}};JSON.stringify(t);let i=new O({name:I.authorize,params:t,permission:M.NONE,singleTimeout:g.commonInfiniteSingle,totalTimeout:g.commonInfiniteTotal,success:n=>{this.onAuthorizeSuccess(n)},fail:n=>{this.onAuthorizeFailed(n)}});this.ioSocketEmitter.emit(i)})}onConnecting(){W.fire(B.CONNECTING,this.reconnectingTimes),this.notify(this.connectingObservers,this.reconnectingTimes)}onIoReconnecting(){this.reconnectingTimes++,this.status==A.CONNECTED||this.status==A.EXPIRED_RECONNECTED||this.status==A.RECONNECTING?this.status=A.RECONNECTING:this.status=A.CONNECTING,this.onConnecting()}onIoDisconnected(){this.status!==A.DISCONNECTING&&(this.status=A.RECONNECTING,W.fire(B.LOST),this.notify(this.disconnectedObservers))}onAuthorizeSuccess(e){Ue.put(e),Y.setDatas(e.mD),this.status===A.RECONNECTING?this.sid!==e.sid?(this.status=A.EXPIRED_RECONNECTED,this.sid=e.sid,W.fire(B.EXPIRED_RECONNECTED),this.notify(this.expiredReconnectedObservers)):(this.status=A.RECONNECTED,W.fire(B.RECONNECTED)):(this.status=A.CONNECTED,this.sid=e.sid),e.enablePublish&&(this.permissions.find(t=>t==M.WRITE)||this.permissions.push(M.WRITE)),e.enableSubscribe&&(this.permissions.find(t=>t==M.READ)||this.permissions.push(M.READ)),this.reconnectingTimes=0,W.fire(B.CONNECTED),this.notify(this.connectedObservers)}onAuthorizeFailed(e){this.ioSocket.disconnect(),this.status=A.CONNECT_FAILED;let t={code:e.resultCode||408,content:e.content||"Host unreachable or timeout"};this.notify(this.connectFailedObservers,t)}addConnectingObserver(e){d.isFunction(e)&&this.connectingObservers.push(e)}addConnectFailedObserver(e){d.isFunction(e)&&this.connectFailedObservers.push(e)}addExpiredReconnectedObserver(e){d.isFunction(e)&&this.expiredReconnectedObservers.push(e)}onMessage(e,t){this.ioSocket.io._callbacks.hasOwnProperty("$"+e)||this.ioSocket.io.on(e,t)}user(){let e=this.connectOptions;return e?{id:e.id,data:e.data}:null}}class qo{constructor(e){this.guidList=[],this.socket=e}offMessage(e,t){W.off(B.NEW_MESSAGE+"_"+e,t)}onMessage(e,t){W.on(B.NEW_MESSAGE+"_"+e,t),this.socket.onMessage(e,i=>{this.fire(e,i)})}fire(e,t){let i=this.filter(t);i&&W.fire(B.NEW_MESSAGE+"_"+e,i)}filter(e){if(typeof e=="string"&&(e=JSON.parse(e)),e.i){if(this.guidList.findIndex(t=>t===e.i)>-1)return;this.guidList.unshift(e.i),this.guidList.length>300&&this.guidList.pop()}return e}}class _{static init(e){this.i=new _(e)}constructor(e){this.goeasyOptions=e}static connect(e,t){if(this.status()!==A.DISCONNECTED&&d.isObject(e)&&d.isFunction(e.onFailed))return void e.onFailed({code:408,content:"It is already connected, don't try again until disconnect() is called. "});this.confirmUserIdAndData(e),W.init();let i=this.i;Y.preConnect(e),i.socket=new Bo(i.goeasyOptions,e),i.socket.vname=t,i.emitter=new di(i.socket),i.messageListener=new qo(i.socket),Y.postConnect()}static confirmUserIdAndData(e){if(Y.modules.get("GIM"))k.validateId(e.id,"id"),k.validateObject(e.data,"data");else if(typeof e.id=="string"&&e.id.length>60)throw{code:400,content:"id over max length 60"}}static e(e){this.i.emitter.emit(e)}static sendAck(e,t){this.i.socket.sendAck(e,t)}static status(){return this.i&&this.i.socket?this.i.socket.getStatus():A.DISCONNECTED}static on(e,t){W.on(e,t)}static off(e,t){W.off(e,t)}static offMessage(e,t){this.i.messageListener.offMessage(e,t)}static onMessage(e,t){this.i.messageListener.onMessage(e,t)}static disconnect(e){this.i.socket.disconnect().then(()=>{S.onSuccess(e)}).catch(t=>{S.onFailed(e,t)})}static user(){return this.i.socket.user()}}_.EVENT=B;class le{static getInstance(){return le.instance||(le.instance=new le),le.instance}constructor(){this.synchronized=!0,this.onlineChanged=e=>{e.online?this.teamIds.add(e.teamId):this.teamIds.delete(e.teamId)},this.onDisconnected=()=>{this.queryMyTeamPromise=null,this.teamIds=null},this.onConnected=()=>{this.synchronized&&(this.queryMyTeamPromise=this.queryTeams())},_.on(_.EVENT.LOST,this.onDisconnected),_.on(_.EVENT.RECONNECTED,this.onConnected),_.onMessage(se.CS_ONLINE_CHANGED,this.onlineChanged)}queryTeams(){return this.queryMyTeamPromise||(this.queryMyTeamPromise=new Promise((e,t)=>{let i=new O({name:I.CS_MY_TEAMS,params:{},permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:n=>{t(n)},success:n=>{this.teamIds=new Set(n.content),this.synchronized=!0,e(this.teamIds)}});m.Socket.e(i)})),this.queryMyTeamPromise}myTeams(){if(this.synchronized&&this.queryMyTeamPromise)return this.teamIds;throw"please query team first."}isOnline(e,t){return E(this,void 0,void 0,function*(){yield this.queryTeams(),S.onSuccess(t,this.teamIds.has(e))})}online(e,t){if(!d.isObject(t.agentData)||!d.isObject(t.teamData))throw{code:400,content:"agentData and teamData require an object"};let i=new Cn(e,t.teamData,t.agentData),n=new O({name:I.CS_ONLINE,params:i,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:o=>{S.onFailed(t,o)},success:o=>{this.teamIds.add(e),S.onSuccess(t),v.i.fire(b.CS_ONLINE_SUCCESS)}});m.Socket.e(n)}offline(e,t){let i=new wn(e),n=new O({name:I.CS_OFFLINE,params:i,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:o=>{S.onFailed(t,o)},success:o=>{this.teamIds.delete(e),S.onSuccess(t),v.i.fire(b.CS_OFFLINE_SUCCESS)}});m.Socket.e(n)}agents(e,t){let i=new Mn(e),n=new O({name:I.CS_AGENTS,params:i,permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:o=>{S.onFailed(t,o)},success:o=>{o.content.forEach(r=>{r.data=JSON.parse(r.data)}),S.onSuccess(t,o)}});m.Socket.e(n)}}class G{constructor(e){this.onMessageReceived=t=>{let i=G.session;if(t.scene()===y.CS&&i.liveOptions){let n=t,o=i.liveOptions.customerId;i.teamId===n.teamId&&n.customerId()===o&&(i.tryUpdateStatus(n),i.liveOptions.onNewMessage(n))}},this.teamId=e,v.i.on(b.CS_AGENT_MESSAGE_RECEIVED,this.onMessageReceived),v.i.on(b.CS_ACCEPTED,this.onMessageReceived),v.i.on(b.CS_ENDED,this.onMessageReceived),v.i.on(b.CS_TRANSFER,this.onMessageReceived),_.on(B.DISCONNECTED,G.destroy)}static live(e,t){return E(this,void 0,void 0,function*(){let i=t.customerId;k.validateId(i,"customerId");let n=new ds(e,i);yield le.getInstance().queryTeams();let o=new O({name:I.CS_LIVE_SESSION,params:n,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:r=>{S.onFailed(t,r)},success:r=>{G.destroy(),this.session=new G(e),this.session.liveOptions=t;let a=r.content.customerStatus;a.status==="ACCEPTED"&&(a.agent.data=JSON.parse(a.agent.data)),this.session.status=a,this.session.liveOptions.onStatusUpdated(this.session.status),S.onSuccess(t)}});m.Socket.e(o)})}customerId(){return this.liveOptions.customerId}static isMyCustomer(e){let t=G.session;if(t&&t.teamId===e.teamId&&t.customerId()===e.customerId()){let i=le.getInstance().myTeams(),n=t.status.agent;return i.has(e.teamId)&&(!n||n.id===m.Socket.user().id)}return!0}static isMyMessage(e){let t=T.byIMMessage(e);return e.type===X.TRANSFER&&e.payload.transferTo.id===m.Socket.user().id||this.isMyCustomer(t)}static quit(e){let t=G.session;if(t){let i=t.liveOptions.customerId;k.validateId(i,"customerId");let n=new ds(t.teamId,i),o=new O({name:I.CS_QUIT_LIVE,params:n,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:r=>{S.onFailed(e,r)},success:r=>{G.destroy(),S.onSuccess(e)}});m.Socket.e(o)}}tryUpdateStatus(e){if(this.status.status!=="FREE"&&this.status.sessionId>e.sessionId)return;let t;switch(e.type){case X.ACCEPT:t=new et,t.status="ACCEPTED",t.start=e.payload.sessionStart,t.sessionId=e.sessionId,t.agent=new Os(e.senderId,e.senderData);break;case X.END:t=new et,t.status="FREE";break;case X.TRANSFER:t=new et,t.status="ACCEPTED",t.start=e.payload.sessionStart,t.sessionId=e.sessionId,t.agent=e.payload.transferTo;break;default:this.status.status==="FREE"&&(t=new et,t.status="PENDING",t.start=e.timestamp,t.sessionId=e.sessionId)}t&&(this.status=t,this.liveOptions.onStatusUpdated(t))}}G.destroy=()=>{let s=G.session;s&&(v.i.off(b.CS_AGENT_MESSAGE_RECEIVED,s.onMessageReceived),v.i.off(b.CS_ACCEPTED,s.onMessageReceived),v.i.off(b.CS_ENDED,s.onMessageReceived),v.i.off(b.CS_TRANSFER,s.onMessageReceived),_.off(B.DISCONNECTED,G.destroy),G.session=null)};class jo extends Wt{constructor(e){super(e),this.unread=0,this.markingAmount=0}loadHistory(e,t){return E(this,void 0,void 0,function*(){return d.isUndef(t)?t=10:t>30&&(t=30),yield this.loadServerMessages(e,t)})}loadServerMessages(e,t){return E(this,void 0,void 0,function*(){let i=new zs(this.target.id.toString(),this.target.scene,e,t,this.target.teamId),n=yield this.remoteHistory.loadServerMessages(this.target,i);return n.userOffsets.forEach(o=>{this.userOffsets.updateOffset(o.userId,o.offset)}),n.messages})}deleteMessages(e){return E(this,void 0,void 0,function*(){S.onFailed(e,"Delete CS message is not supported yet")})}initMaxMessageAndOffsets(e,t){t.forEach(i=>{this.userOffsets.updateOffset(i.userId,i.offset)}),(d.isUndef(this.acceptedMaxMessage)||this.acceptedMaxMessage.timestamp<e.timestamp)&&this.increaseUnreadAmount(e),this.saveAcceptedMessage(e)}initPendingMaxMessageAndOffsets(e,t){t.forEach(i=>{this.userOffsets.updateOffset(i.userId,i.offset)}),this.savePendingMessage(e)}savePendingMessage(e){this.pendingMaxMessage?this.pendingMaxMessage.timestamp<e.timestamp&&(this.pendingMaxMessage=e):this.pendingMaxMessage=e}saveAcceptedMessage(e){this.acceptedMaxMessage?this.acceptedMaxMessage.timestamp<e.timestamp&&(this.acceptedMaxMessage=e):this.acceptedMaxMessage=e}onMessageSending(e){this.saveAcceptedMessage(e),v.i.fire(b.MAX_MESSAGE_CHANGED,e)}onMessageSendSuccess(e){this.saveAcceptedMessage(e),this.userOffsets.updateOffset(e.senderId,e.timestamp),this.acceptedMaxMessage===e&&v.i.fire(b.MAX_MESSAGE_CHANGED,e)}onMessageSendFailed(e){this.acceptedMaxMessage===e&&v.i.fire(b.MAX_MESSAGE_CHANGED,e)}onMessageReceived(e){G.isMyMessage(e)&&(!e.accepted||e.senderId!==m.Socket.user().id&&e.type===X.ACCEPT?this.savePendingMessage(e):this.saveAcceptedMessage(e),this.userOffsets.updateOffset(e.senderId,e.timestamp),this.increaseUnreadAmount(e),v.i.fire(b.MAX_MESSAGE_CHANGED,e))}increaseUnreadAmount(e){(e.sendByCustomer()||e.type===X.TRANSFER&&e.senderId!==m.Socket.user().id)&&this.userOffsets.myOffset()<e.timestamp&&e.accepted&&(this.unread+=1)}markRead(){return E(this,void 0,void 0,function*(){let e=this.maxAcceptedMessageTime();G.isMyCustomer(this.target)&&this.preMark(e)&&(yield this.remoteHistory.updateServerOffsets(e,this.target),this.postMark(e))})}preMark(e){let t=this.userOffsets.myOffset();return e>this.userOffsets.markingTime&&e>t&&(this.userOffsets.markingTime=e,this.markingAmount=this.unread,!0)}postMark(e){e===this.userOffsets.markingTime&&(this.unread-=this.markingAmount,this.markingAmount=0,this.userOffsets.updateOffset(m.Socket.user().id,e),v.i.fire(b.UNREAD_AMOUNT_CHANGED,this.target))}syncMarkedMessage(e){}getMaxMessage(e){return e?this.acceptedMaxMessage:this.pendingMaxMessage}unreadAmount(e){return e?this.unread:0}existsMessage(e){return this.acceptedMaxMessage&&this.acceptedMaxMessage.messageId===e.messageId||this.pendingMaxMessage&&this.pendingMaxMessage.messageId===e.messageId}maxAcceptedMessageTime(){return this.acceptedMaxMessage?this.acceptedMaxMessage.timestamp:0}maxTime(e){let t=this.getMaxMessage(e);return t?t.timestamp:0}}class Vo extends Wt{constructor(e){super(e)}deleteMessages(e){return E(this,void 0,void 0,function*(){S.onFailed(e,"Delete CS message is not supported yet")})}}class hi{static validateMessageArray(e){if(!d.isArray(e)||d.isEmpty(e))throw{code:400,content:"messages requires non empty array"};if(e.length>20)throw{code:400,content:"The maximum number of messages is 20"};let t=T.byIMMessage(e[0]);for(let i=0;i<e.length;i++){let n=e[i];if(!(n instanceof Qe))throw{code:400,content:"message["+i+"] is not a correct message"};if(i>0){let o=T.byIMMessage(n);if(o.scene!==t.scene||o.id!==t.id)throw{code:400,content:"each message must be from the same friend or group"}}}}}class z{static init(){return z.instance=new z,z.instance}constructor(){this.map=new Map,this.onMessageSending=e=>{let t=T.byIMMessage(e);this.findOrCreateHistory(t).onMessageSending(e)},this.onMessageSendSuccess=e=>{let t=T.byIMMessage(e);this.findHistory(t).onMessageSendSuccess(e)},this.onMessageSendFailed=e=>{let t=T.byIMMessage(e);this.findHistory(t).onMessageSendFailed(e)},this.onMessageReceived=e=>{let t=T.byIMMessage(e);this.findOrCreateHistory(t).onMessageReceived(e)},this.onRemoteMarkRead=e=>{let t=T.byMessageReadRemoteEvent(e),i=this.findHistory(t);i&&i.syncMarkedMessage(e)},this.onRemoteMessageDeleted=e=>{let t=T.byIMMessageDeletedEvent(e),i=this.findHistory(t);i&&i.syncDeletedMessage(e.deleterId,e.times)},this.onMessageRecalled=e=>{let t=T.byConversationId(e.scene,e.conversationId),i=this.findHistory(t);i&&i.recallMessages(e)},this.onDisconnected=()=>{this.map.forEach((e,t)=>{e.expire()})},this.destroy=()=>{},this.initialListeners()}initialListeners(){v.i.on(b.MESSAGE_SENDING,this.onMessageSending),v.i.on(b.MESSAGE_SEND_SUCCESS,this.onMessageSendSuccess),v.i.on(b.MESSAGE_SEND_FAILED,this.onMessageSendFailed),v.i.on(b.MESSAGE_RECEIVED,this.onMessageReceived),v.i.on(b.CS_AGENT_MESSAGE_RECEIVED,this.onMessageReceived),v.i.on(b.CS_ACCEPTED,this.onMessageReceived),v.i.on(b.CS_ENDED,this.onMessageReceived),v.i.on(b.CS_TRANSFER,this.onMessageReceived),v.i.on(b.MESSAGE_RECALLED,this.onMessageRecalled),_.onMessage(se.IM_MSG_READ,this.onRemoteMarkRead),_.onMessage(se.IM_MSG_DELETED,this.onRemoteMessageDeleted),_.on(_.EVENT.LOST,this.onDisconnected)}loadHistory(e,t){return E(this,void 0,void 0,function*(){let i=this.queryToTarget(e,t),n=this.findOrCreateHistory(i),o=yield n.loadHistory(e.lastTimestamp,e.limit);S.onSuccess(e,{code:200,content:o})})}queryToTarget(e,t){if(d.isDef(e.userId))return new T(y.PRIVATE,e.userId);if(d.isDef(e.groupId))return new T(y.GROUP,e.groupId);if(d.isDef(e.type)){if(!Object.values(y).includes(e.type))throw new Error("incorrect type, must be: "+Object.values(y));if(d.isUndef(e.id))throw new Error("If type is not empty, id is required.");return y.CS==e.type&&d.isUndef(t)&&(t=e.id),new T(e.type,e.id,t)}throw new Error("incorrect query options.")}privateMarkAsRead(e){return E(this,void 0,void 0,function*(){if(d.isUndef(e.userId))throw new Error("userId could not be empty.");let t=T.byScene(y.PRIVATE,e.userId);yield this.markAsRead(t,e)})}groupMarkAsRead(e){return E(this,void 0,void 0,function*(){if(d.isUndef(e.groupId))throw new Error("groupId could not be empty.");let t=T.byScene(y.GROUP,e.groupId);yield this.markAsRead(t,e)})}markMessageAsRead(e,t){return E(this,void 0,void 0,function*(){if(d.isUndef(e.id))throw new Error("id could not be empty.");if(!Object.values(y).includes(e.type))throw new Error("incorrect type, must be: "+Object.values(y));y.CS==e.type&&d.isUndef(t)&&(t=e.id);let i=T.byScene(e.type,e.id,t);yield this.markAsRead(i,e)})}markAsRead(e,t){return E(this,void 0,void 0,function*(){let i=this.findHistory(e);i&&(yield i.markRead()),S.onSuccess(t)})}deleteMessage(e){return E(this,void 0,void 0,function*(){this.validateMessageArray(e.messages),js.validate(e);let t=e.messages[0],i=T.byIMMessage(t),n=this.findHistory(i);if(!n)throw{code:400,content:"No message that could be deleted"};yield n.deleteMessages(e)})}findOrCreateHistory(e){let t=this.findHistory(e);return t||(t=e.scene===y.CS?m.Socket.user().id===e.customerId()?new Vo(e):new jo(e):new Wt(e),this.map.set(e.toString(),t),t)}static get(e){return z.instance.findOrCreateHistory(e)}findHistory(e){return this.map.get(e.toString())}validateMessageArray(e){hi.validateMessageArray(e)}}class We{constructor(e){this.top=!1,this.data=null,this.dataLoaded=!1,this.target=e}toDto(){let e=this.target.scene,t=this.target.id,i=new jt;return e===y.PRIVATE?i.userId=t:e===y.GROUP?i.groupId=t:e===y.CS&&(i.id=this.target.teamId),i.type=e,i.lastMessage=this.getMaxMessage(),i.unread=this.getUnreadAmount(),i.top=this.top,i.data=this.data,i}getMaxMessage(){return z.get(this.target).getMaxMessage()}getUnreadAmount(){return z.get(this.target).unreadAmount()}maxMessageTime(){return z.get(this.target).maxTime()}}class nt extends We{constructor(e){super(e),this.accepted=!1}toDto(){let e=new jt,t=this.target.scene,i=this.target.id,n=this.target.teamId;return e.id=i,e.teamId=n,e.type=t,e.lastMessage=this.getMaxMessage(),e.unread=this.getUnreadAmount(),e.top=this.top,e.data=this.data,e.ended=this.isEnded(),e}isEnded(){let e=this.getMaxMessage(),t=e.type,i=e.payload;return t===X.END||t===X.TRANSFER&&i.transferTo.id!==m.Socket.user().id}getMaxMessage(){return z.get(this.target).getMaxMessage(this.accepted)}getUnreadAmount(){return z.get(this.target).unreadAmount(this.accepted)}maxMessageTime(){return z.get(this.target).maxTime(this.accepted)}}class Ho{constructor(e,t,i,n){this.type=e,this.top=t,this.targetId=i,this.teamId=n}}class zo{constructor(e,t,i){this.type=e,this.targetId=t,this.teamId=i}}class Wo{constructor(e,t,i){this.type=e,this.targetId=t,this.teamId=i}}class Lt{top(e,t){let i=new Ho(e.scene,t,e.id,e.teamId);return new Promise((n,o)=>{let r=new O({name:I.topConversation,params:i,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,success:a=>{a.code===200?n(a):o(a)},fail:a=>{o(a)}});m.Socket.e(r)})}remove(e){let t=new zo(e.scene,e.id,e.teamId);return new Promise((i,n)=>{let o=new O({name:I.removeConversation,params:t,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,success:r=>{r.code==200?i(r):n(r)},fail:r=>{n(r)}});m.Socket.e(o)})}query(e){return new Promise((t,i)=>{let n=new O({name:e,params:{},permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:o=>{i(o)},success:o=>E(this,void 0,void 0,function*(){t(o)})});m.Socket.e(n)})}loadData(e){let t=new Wo(e.scene,e.id,e.teamId);return new Promise((i,n)=>{let o=new O({name:I.imData,params:t,permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,success:r=>{let a=JSON.parse(r.content);i(a)},fail:r=>{n(r)}});m.Socket.e(o)})}}Lt.instance=new Lt;class Ee{constructor(){this.list=new Array,this.builder=new ft,this.remoteConversations=Lt.instance,this.synchronized=!1,v.i.on(b.MAX_MESSAGE_CHANGED,this.onMaxMessageChanged.bind(this)),v.i.on(b.UNREAD_AMOUNT_CHANGED,this.onUnreadMessageChanged.bind(this)),v.i.on(b.MAX_MESSAGE_DELETED,this.onMaxMessageDeleted.bind(this))}onUnreadMessageChanged(e){this.findConversation(e)&&this.fireUpdated()}fireUpdated(){let e=this.loadLocalConversations(),t=this.getUpdatedEventName();ee.fire(t,{unreadTotal:e.content.unreadTotal,conversations:e.content.conversations})}getUpdatedEventName(){return Q.CONVERSATIONS_UPDATED}latestConversations(e){return E(this,void 0,void 0,function*(){this.synchronized||(yield this.loadServerConversations());let t=this.loadLocalConversations();S.onSuccess(e,t)})}loadServerConversations(){return E(this,void 0,void 0,function*(){let e=this.rocketName(),t=yield this.remoteConversations.query(e);this.convertAbbrConversation(t.content),this.synchronized=!0})}rocketName(){return I.imLastConversations}convertAbbrConversation(e){let t=e;for(const i of t){let n=i.t,o=i.top,r=i.d?JSON.parse(i.d):{},a=i.userOffsets;i.lmsg.t=n;let c=i.lmsg,u=this.builder.build(c),h=T.byIMMessage(u),p=this.findConversation(h);d.isUndef(p)?(p=this.buildByAbbr(i,u),this.insertOne(p)):(p.top=o,p.data=r),z.get(h).initMaxMessageAndOffsets(u,a),this.correctPosition(p)}}onMaxMessageDeleted(e){this.removeConversation(e)}onMaxMessageChanged(e){return E(this,void 0,void 0,function*(){if(e.scene()===y.CS){let t=e;if(m.Socket.user().id!=t.customerId()&&(t.accepted===!1||t.type===X.ACCEPT&&t.senderId!=m.Socket.user().id))return}yield this.saveOrUpdateConversation(e)})}saveOrUpdateConversation(e){return E(this,void 0,void 0,function*(){let t=e.status,i=T.byIMMessage(e),n=this.findConversation(i);d.isUndef(n)&&t!==q.FAIL&&(n=this.buildByMessage(e),this.insertOne(n),t===q.SUCCESS&&(n.data=yield this.remoteConversations.loadData(i),n.dataLoaded=!0)),t===q.SENDING&&(n.data=e.getToData(),n.dataLoaded=!0),n&&n.dataLoaded&&(this.correctPosition(n),this.fireUpdated())})}loadLocalConversations(){let e=0,t=new Array;for(const i of this.list)if(i.dataLoaded&&i.getMaxMessage()){e+=i.getUnreadAmount();let n=i.toDto();t.push(n)}return{code:200,content:{unreadTotal:e,conversations:t}}}findConversationIndex(e){return this.list.findIndex(t=>e.toString()===t.target.toString())}findConversation(e){let t=this.findConversationIndex(e);return this.list[t]}removeLocalConversation(e){let t=this.findConversationIndex(e.target);this.list.splice(t,1)}insertOne(e){Ee.sortedInserter.insert(this.list,e),this.list.length>Ee.CONVERSATIONS_MAX_LENGTH&&(this.list=this.list.slice(0,Ee.CONVERSATIONS_MAX_LENGTH))}correctPosition(e){this.removeLocalConversation(e),this.insertOne(e)}removeConversation(e){let t=this.findConversation(e);t&&(this.removeLocalConversation(t),this.fireUpdated())}top(e,t,i){return E(this,void 0,void 0,function*(){if(!d.isBoolean(t))throw new Error("top must be boolean.");let n=this.findConversation(e);if(!n)throw new Error("conversation does not exist.");n.top!=t&&(yield this.remoteConversations.top(e,t),n.top=t,this.correctPosition(n)),this.fireUpdated(),S.onSuccess(i)})}remove(e,t){return E(this,void 0,void 0,function*(){let i=this.findConversation(e);if(!i)throw new Error("conversation does not exist.");if(i instanceof nt&&!i.isEnded())throw new Error("CS conversation can only be deleted after it ends");yield this.remoteConversations.remove(e),this.removeLocalConversation(i),this.fireUpdated(),S.onSuccess(t)})}buildByAbbr(e,t){let i,n=T.byIMMessage(t);if(e.t===y.CS){let o=t;m.Socket.user().id===o.customerId()?i=new We(n):(i=new nt(n),i.accepted=o.accepted)}else i=new We(n);return i.dataLoaded=!0,i.top=e.top,i.data=e.d?JSON.parse(e.d):{},i}buildByMessage(e){let t,i=T.byIMMessage(e);if(e.scene()===y.CS){let n=e;m.Socket.user().id===n.customerId()?t=new We(i):(t=new nt(i),t.accepted=n.accepted)}else t=new We(i);return t}}Ee.CONVERSATIONS_MAX_LENGTH=200,Ee.sortedInserter=new class extends qs{compare(s,e){let t;if(s.top==e.top){let i=s.maxMessageTime();t=e.maxMessageTime()-i}else t=s.top?-1:1;return t===0?0:t>0?1:-1}};class Ne extends mt{static init(){return this.module=new Ne,this.module.name=this.GIM_MODULE_NAME,this.initGN(),this.module}static initGN(){V.addAssembler(new class{assemble(e){let t={messageId:e.id,timestamp:e.tm,type:e.t,senderId:e.sid,toType:e.tt};return e.tt===y.GROUP&&(t.groupId=e.gid),t}support(e){return!!e.sid}})}postConnect(){w.init()}static check(){if(!this.module)throw new Error("IM not initialized. Please include 'IM' in the 'modules' during GoEasy initialization.")}}Ne.GIM_MODULE_NAME="GIM";class Jo extends Ee{constructor(){super(),this.expired=!1,v.i.on(b.CS_ONLINE_SUCCESS,this.onCSOnlineSuccess.bind(this)),v.i.on(b.CS_OFFLINE_SUCCESS,this.onCSOfflineSuccess.bind(this)),_.on(_.EVENT.LOST,this.onDisconnected.bind(this)),_.on(_.EVENT.RECONNECTED,this.onConnected.bind(this))}onMaxMessageChanged(e){return E(this,void 0,void 0,function*(){if(e.scene()===y.CS){let t=e;if(t.customerId()!=m.Socket.user().id&&(t.accepted===!1||t.type===X.ACCEPT))if(X.ACCEPT===e.type){let i=T.byIMMessage(e);this.removeConversation(i)}else yield this.saveOrUpdateConversation(e)}})}latestConversations(e){const t=Object.create(null,{latestConversations:{get:()=>super.latestConversations}});return E(this,void 0,void 0,function*(){let i=this.synchronized;yield t.latestConversations.call(this,e),this.list.length>0&&!i&&this.fireUpdated()})}onUnreadMessageChanged(e){}onCSOnlineSuccess(){return E(this,void 0,void 0,function*(){yield this.loadServerConversations(),this.fireUpdated()})}onCSOfflineSuccess(){this.list=[],this.fireUpdated()}getUpdatedEventName(){return Q.PENDING_CONVERSATIONS_UPDATED}rocketName(){return I.CS_PENDING_CONVERSATION}convertAbbrConversation(e){return E(this,void 0,void 0,function*(){let t=e;for(const i of t){i.lastMessage.t=y.CS;let n=i.customerData,o=i.lastMessage,r=i.userOffsets,a=n?JSON.parse(n):{},c=this.builder.build(o),u=T.byIMMessage(c),h=this.findConversation(u);d.isUndef(h)&&(h=new nt(u),h.accepted=c.accepted,h.dataLoaded=!0,this.insertOne(h)),h.top=!1,h.data=a,z.get(u).initPendingMaxMessageAndOffsets(c,r),this.correctPosition(h)}})}onDisconnected(){this.expired=!0}onConnected(){return E(this,void 0,void 0,function*(){this.expired&&Ne.module&&Ne.module.active&&(this.expired=!1,this.list=[],yield this.loadServerConversations(),this.fireUpdated())})}}class Xo{constructor(){this.conversations=new Ee,this.pendingConversations=new Jo}latestConversations(e){this.conversations.latestConversations(e)}latestPendingConversations(e){this.pendingConversations.latestConversations(e)}topPrivateConversation(e){let t=T.byScene(y.PRIVATE,e.userId);this.conversations.top(t,e.top,e)}topGroupConversation(e){let t=T.byScene(y.GROUP,e.groupId);this.conversations.top(t,e.top,e)}topConversation(e){let t=e.conversation;this.validateConversationDTO(t);let i=T.byConversationDTO(t);this.conversations.top(i,e.top,e)}removePrivateConversation(e){let t=T.byScene(y.PRIVATE,e.userId);this.conversations.remove(t,e)}removeGroupConversation(e){let t=T.byScene(y.GROUP,e.groupId);this.conversations.remove(t,e)}removeConversation(e){let t=e.conversation;this.validateConversationDTO(t);let i=T.byConversationDTO(t);this.conversations.remove(i,e)}validateConversationDTO(e){if(!(e instanceof jt))throw new Error("Incorrect conversation object.");{let t=e.lastMessage;if(t instanceof zt&&t.customerId()!==m.Socket.user().id&&t.accepted===!1)throw new Error("pending conversation cannot be topped or removed.")}}}class pi{constructor(){this.builder=new ft,m.Socket.onMessage(se.imMessage,this.onMessageReceived.bind(this))}onMessageReceived(e){if(e.t!==y.CS){let t=this.builder.build(e);this.sendAck(t);let i=T.byIMMessage(t),n=i.scene;z.get(i).existsMessage(t)||(this.createNotification(e),v.i.fire(b.MESSAGE_RECEIVED,t),n===y.PRIVATE?ee.fire(Q.PRIVATE_MESSAGE_RECEIVED,t):n===y.GROUP&&ee.fire(Q.GROUP_MESSAGE_RECEIVED,t))}}sendAck(e){m.Socket.sendAck("imAck",{publishGuid:e.messageId})}createNotification(e){const t=m.N.supportAppNotification();if(!d.isObject(e.nt)||e.s===m.Socket.user().id||!t)return;let i={id:e.i,tm:e.ts,t:e.mt,sid:e.s,tt:e.t};i.tt===y.GROUP&&(i.gid=e.r),m.N.createLocalNotification(e.nt.t,e.nt.c,i,e.nt.sound,e.nt.badge)}}class $o{subscribe(e){k.validateIdArray(e.groupIds,"groupIds"),e.groupIds=e.groupIds.toString().split(",");let t=new O({name:I.subscribeGroups,params:{groupIds:e.groupIds,at:e.accessToken},permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,success:function(){S.onSuccess(e,{code:200,content:"ok"})},fail:function(i){S.onFailed(e,{code:i.resultCode||408,content:i.content||"Failed to subscribe group message"})}});m.Socket.e(t)}unsubscribe(e){k.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();let t=new O({name:I.unsubscribeGroup,params:{groupId:e.groupId},permission:M.READ,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,success:()=>{S.onSuccess(e,{code:200,content:"ok"})},fail:i=>{S.onFailed(e,{code:i.resultCode||408,content:i.content||"Failed to unsubscribe group message"})}});m.Socket.e(t)}}class Yo{constructor(){this.newMessageReceived=e=>{let t=null;e.c&&(t=JSON.parse(e.c)),t&&t.events&&t.events.map(i=>{let n=i.userData?JSON.parse(i.userData):{},o={time:i.time,action:i.action,groupOnlineCount:t.userAmount,groupId:t.groupId,id:i.userId,data:n};ee.fire(Q.GROUP_PRESENCE,o)})},_.onMessage(se.groupPresence,this.newMessageReceived)}presence(e){k.validateIdArray(e.groupIds,"groupIds"),e.groupIds.toString().split(",");let t={groupIds:e.groupIds};this.emitRocket(I.subscribeGroupPresence,t,()=>{S.onSuccess(e,{code:200,content:"ok"})},i=>{S.onFailed(e,{code:i.code||408,content:i.content||"Failed to subscribe group message"})},g.commonRequestSingle,g.commonRequestTotal)}unPresence(e){k.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();let t={groupId:e.groupId};this.emitRocket(I.unsubscribeGroupPresence,t,()=>{S.onSuccess(e,{code:200,content:"ok"})},i=>{S.onFailed(e,{code:i.code||408,content:i.content||"Failed to unsubscribe presence"})},g.commonRequestSingle,g.commonRequestTotal)}emitRocket(e,t,i,n,o,r){let a=new O({name:e,params:t,singleTimeout:o,totalTimeout:r,permission:M.WRITE,success:i,fail:n});m.Socket.e(a)}}class Qo{get(e){k.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();let t=new O({name:I.imGroupOnlineCount,params:{groupId:e.groupId},permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:function(i){S.onFailed(e,i||{code:408,content:"Failed to query online group users"})},success:function(i){i.code==200?S.onSuccess(e,i):S.onFailed(e,i)}});m.Socket.e(t)}}class mi{doHereNow(e,t,i){let n=new O({name:e,params:t,permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:o=>{S.onFailed(i,o)},success:o=>{let r=o.content;o.content=r.map(a=>{let c=a.userData?JSON.parse(a.userData):{};return{id:a.userId,data:c}}),S.onSuccess(i,o)}});m.Socket.e(n)}}class Ko extends mi{hereNow(e){k.validateId(e.groupId,"groupId"),e.groupId=e.groupId.toString();let t={groupId:e.groupId};this.doHereNow(I.imGroupHereNow,t,e)}}class Zo{constructor(){this.newMessageReceived=e=>{let t=[];e.c&&(t=JSON.parse(e.c).events||[]),t.map(i=>{let n=i.userData?JSON.parse(i.userData):{},o={time:i.time,action:i.action,id:i.userId,data:n};ee.fire(Q.USER_PRESENCE,o)})},_.onMessage(se.userPresence,this.newMessageReceived)}presence(e){k.validateIdArray(e.userIds,"userIds"),e.userIds.toString().split(",");let t={userIds:e.userIds};this.emitRocket(I.subscribeUserPresence,t,()=>{S.onSuccess(e,{code:200,content:"ok"})},i=>{S.onFailed(e,{code:i.code||408,content:i.content||"Failed to subscribe group message"})},g.commonRequestSingle,g.commonRequestTotal)}unPresence(e){k.validateId(e.userId,"userId"),e.userId=e.userId.toString();let t={userId:e.userId};this.emitRocket(I.unsubscribeUserPresence,t,()=>{S.onSuccess(e,{code:200,content:"ok"})},i=>{S.onFailed(e,{code:i.code||408,content:i.content||"Failed to unsubscribe presence"})},g.commonRequestSingle,g.commonRequestTotal)}emitRocket(e,t,i,n,o,r){let a=new O({name:e,params:t,singleTimeout:o,totalTimeout:r,permission:M.WRITE,success:i,fail:n});m.Socket.e(a)}}class er extends mi{hereNow(e){let t=e.userIds;k.validateIdArray(t,"userIds"),t.toString().split(","),this.doHereNow(I.imHereNow,e,e)}}const x=new class{fileExtension(s,e){if(d.isString(s))try{let t=s.split(e);return t[t.length-1]}catch(t){throw Error(t)}}};class St{}class be extends St{constructor(){super(...arguments),this.contentType="",this.name="",this.size=0,this.url=""}}class Ge extends be{constructor(){super(...arguments),this.width=0,this.height=0}}class ${build(e){this.validate(e.createOptions);let t=this.create();return this.setPayload(e,t),t}}class pt extends ${create(){return new be}setPayload(e,t){let i=t,n=e.createOptions.file;i.url=n.path,i.name=n.name,i.size=n.size,i.contentType=n.type,e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class Is extends pt{create(){return new Ge}setPayload(e,t){super.setPayload(e,t);let i=e.createOptions.file,n=t,o=i.path||i.tempFilePath,r=d.isEmpty(i.name)||i.name===void 0?o:i.name;n.name="wx-image."+x.fileExtension(r,"."),n.contentType="image/"+x.fileExtension(r,"."),n.url=o,n.size=i.size,e.complete=new Promise((a,c)=>{wx.getImageInfo({src:n.url,success(u){n.width=u.width,n.height=u.height,a()},fail(u){c(u)}})})}validate(e){super.validate(e)}}class Le extends be{constructor(){super(...arguments),this.duration=0}}class Ns extends pt{create(){return new Le}setPayload(e,t){super.setPayload(e,t);let i=e.createOptions.file,n=t,o=i.tempFilePath,r=d.isEmpty(i.name)||i.name==null?o:i.name,a=i.duration,c=i.fileSize;n.url=o,n.size=c,n.duration=a/1e3,n.name="wx-audio."+x.fileExtension(r,"."),n.contentType="audio/"+x.fileExtension(r,"."),e.complete=Promise.resolve()}validate(e){super.validate(e)}}class tr extends St{constructor(){super(...arguments),this.text=""}}class we extends ${create(){return new tr}setPayload(e,t){let i=t,n=e.createOptions;i.text=n.text,e.complete=Promise.resolve()}validate(e){if(d.isEmpty(e.text))throw{code:400,content:"text is empty"};if(!d.isString(e.text))throw{code:400,content:"TypeError: text requires string."};if(e.text.trim()==="")throw{code:400,content:"text is empty"};if(e.text.length>2500)throw{code:400,content:"Message text over max length 2500"}}}class Be extends St{constructor(){super(...arguments),this.video=new ir,this.thumbnail=new sr}}class sr{constructor(){this.name="",this.url="",this.width=0,this.height=0,this.contentType=""}initURL(e){H.currentPlatform()===N.BROWSER&&this.htmlUrl(e)}htmlUrl(e){let t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),this.url=t.toDataURL("image/png")}}class ir{constructor(){this.name="",this.url="",this.width=0,this.height=0,this.contentType="",this.size=0,this.duration=0}}class Ts extends ${create(){return new Be}setPayload(e,t){let i=e.createOptions.file,n=t,o=n.video,r=n.thumbnail,{duration:a,height:c,size:u,tempFilePath:h,thumbTempFilePath:p,width:l,name:f=""}=i,C=d.isEmpty(f)?h:f;o.contentType="video/"+x.fileExtension(C,"."),o.name="wx-video."+x.fileExtension(C,"."),o.url=h,o.width=r.width=l,o.height=r.height=c,o.size=u,o.duration=a,r.url=p,r.contentType="image/jpg",r.name="wx-thumbnail.jpg",e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class Yt extends ${create(){return new be}setPayload(e,t){let i=t,n=e.createOptions.file;i.url=n.fullPath||n.path,i.name=n.name,i.size=n.size,i.contentType=n.type,n.type,e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class nr extends Yt{create(){return new Ge}setPayload(e,t){let i=t,n=e.createOptions.file;i.url=n.path,i.size=n.size;let o=d.isEmpty(n.name)||n.name===void 0?n.path:n.name;i.contentType="image/"+x.fileExtension(o,"."),i.name="uni-image."+x.fileExtension(o,"."),e.complete=new Promise((r,a)=>{uni.getImageInfo({src:n.path,success(c){i.width=c.width,i.height=c.height,r()},fail(c){a(c)}})})}validate(e){super.validate(e)}}class or extends Yt{create(){return new Le}setPayload(e,t){let i=e.createOptions,n=t,o=i.file,r=o.tempFilePath,a=d.isEmpty(o.name)||o.name==null?r:o.name;n.url=r,n.name="uni-audio."+x.fileExtension(a,"."),n.contentType="audio/"+x.fileExtension(a,"."),e.complete=new Promise((c,u)=>{uni.getFileInfo({filePath:r,success:h=>{let p=h.size;if(n.size=p,p===0)c();else if(d.isDef(i.file.duration))n.duration=i.file.duration/1e3,c();else{const l=uni.createInnerAudioContext();l.src=r,l.onCanplay(function(f){f.errCode?(l.destroy(),u(f)):(n.duration=l.duration,l.destroy(),c())}),l.onError(f=>{l.destroy(),f.errCode===-99?c():u(f)})}},fail(h){u(h)}})})}validate(e){super.validate(e)}}class rr extends ${create(){return new Be}setPayload(e,t){let i=e.createOptions.file,n=t,o=n.video,r=n.thumbnail,{duration:a,height:c,size:u,tempFilePath:h,width:p,name:l=""}=i,f=d.isEmpty(l)?h:l;o.size=u,o.width=p,o.height=c,o.url=h,o.duration=a,o.contentType="video/"+x.fileExtension(f,"."),o.name="uni-video."+x.fileExtension(f,"."),r.url=h,r.height=200,r.width=Number((o.width*r.height/o.height).toFixed(0)),r.contentType="image/jpg",r.name="uni-thumbnail.jpg",e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class Qt extends ${create(){return new be}setPayload(e,t){let i=t,n=e.createOptions.file,o=window.URL||window.webkitURL;i.url=o.createObjectURL(n),i.name=n.name,i.size=n.size,i.contentType=n.type,e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(e.file.size==0)throw Error("File size is 0.");if(e.file.size>524288e3)throw Error("message-length limit 30mib")}}class ar extends Qt{create(){return new Ge}setPayload(e,t){super.setPayload(e,t);let i=e.createOptions.file,n=t,o=window.URL||window.webkitURL,r=new Image;r.src=o.createObjectURL(i),e.complete=new Promise((a,c)=>{r.onload=function(){n.width=r.width,n.height=r.height,o.revokeObjectURL(r.src),a()},r.onerror=function(u){o.revokeObjectURL(r.src),c(u)}})}validate(e){super.validate(e);let t=["gif","jpg","png","jpeg"];if(!t.find(i=>i===e.file.type.split("/")[1].toLowerCase()))throw Error("Only "+t.join(",")+" is supported image.")}}class cr extends Qt{create(){return new Le}setPayload(e,t){super.setPayload(e,t);let i=e.createOptions.file,n=t,o=window.URL||window.webkitURL,r=document.createElement("audio");r.src=o.createObjectURL(i),e.complete=new Promise((a,c)=>{r.onloadedmetadata=()=>{n.duration=r.duration,o.revokeObjectURL(r.src),a()},r.onerror=u=>{o.revokeObjectURL(r.src),c(u)}})}validate(e){super.validate(e);let t=["mp3","ogg","wav","wma","ape","acc","mpeg"];if(!t.find(i=>i===e.file.type.split("/")[1].toLowerCase()))throw Error("Only "+t.join(",")+" is supported audio.")}}class ur extends ${create(){return new Be}setPayload(e,t){let i=e.createOptions.file,n=t,o=n.video,r=n.thumbnail,a=window.URL||window.webkitURL,c=document.createElement("video");c.src=a.createObjectURL(i),o.size=i.size,o.name=i.name,o.contentType=i.type,o.url=c.src,r.name=i.name,r.contentType="image/jpg",e.complete=new Promise((u,h)=>{c.onloadedmetadata=()=>{o.duration=c.duration,o.width=c.videoWidth,o.height=c.videoHeight,r.width=c.videoWidth,r.height=c.videoHeight,r.url=this.getThumbnailUrl(c),a.revokeObjectURL(c.src),u()},c.onerror=function(p){a.revokeObjectURL(c.src),h(p)}})}getThumbnailUrl(e){let t=document.createElement("canvas");return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/png")}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(e.file.size==0)throw Error("File size is 0.");if(e.file.size>31457280)throw Error("message-length limit 30mib");let t=["avi","mov","rmvb","rm","flv","mp4","3gp","quicktime"];if(!t.find(i=>i===e.file.type.split("/")[1].toLowerCase()))throw Error("Only "+t.join(",")+" is supported video.")}}class lr extends ${create(){return new Be}setPayload(e,t){let i=e.createOptions.file,n=t,o=n.video,r=n.thumbnail,{duration:a,height:c,size:u,tempFilePath:h,tempVideoThumbPath:p,width:l}=i;o.size=u,o.width=l,o.height=c,o.url=h,o.duration=a,o.contentType="video/mp4",o.name="ali-video.mp4",r.url=p,r.height=200,r.width=Number((o.width*r.height/o.height).toFixed(0)),r.contentType="image/jpg",r.name="ali-thumbnail.jpg",e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class Kt extends ${create(){return new be}setPayload(e,t){e.complete=Promise.reject("Alipay not support file message.")}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class dr extends Kt{create(){return new Ge}setPayload(e,t){let i=t,n=e.createOptions.file;i.url=n.path,i.size=n.size,e.complete=new Promise((o,r)=>{my.getImageInfo({src:n.path,success(a){i.width=a.width,i.height=a.height,i.contentType="image/"+a.type,i.name="ali-image."+a.type,o()},fail(a){r(a)}})})}validate(e){super.validate(e)}}class hr extends Kt{create(){return new Le}setPayload(e,t){let i=t,n=e.createOptions.file,o=n.tempFilePath;i.url=o,i.name="ali-audio."+x.fileExtension(o,"."),i.contentType="audio/"+x.fileExtension(o,"."),i.duration=n.duration,i.size=n.fileSize,e.complete=Promise.resolve()}validate(e){super.validate(e)}}class pr extends ${create(){return new Be}setPayload(e,t){let i=e.createOptions.file,n=t,o=n.video,r=n.thumbnail,{duration:a,height:c,size:u,tempFilePath:h,thumbTempFilePath:p,width:l}=i;o.size=u,o.width=l,o.height=c,o.url=h,o.duration=a,o.contentType="video/"+x.fileExtension(h,"."),o.name="baidu-video."+x.fileExtension(h,"."),r.url=p,r.height=200,r.width=Number((o.width*r.height/o.height).toFixed(0)),r.contentType="image/"+x.fileExtension(p,"."),r.name="baidu-thumbnail."+x.fileExtension(h,"."),e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class Zt extends ${create(){return new be}setPayload(e,t){e.complete=Promise.reject("Baidu app not support file message.")}validate(e){}}class mr extends Zt{create(){return new Le}setPayload(e,t){let i=t,n=e.createOptions.file,o=n.tempFilePath;i.url=o,i.name="baidu-audio."+x.fileExtension(o,"."),i.contentType="audio/"+x.fileExtension(o,"."),i.duration=n.duration/1e3,i.size=n.fileSize,e.complete=Promise.resolve()}validate(e){super.validate(e)}}class fr extends Zt{create(){return new Ge}setPayload(e,t){let i=t,n=e.createOptions.file;i.url=n.path,i.size=n.size,e.complete=new Promise((o,r)=>{swan.getImageInfo({src:n.path,success(a){i.width=a.width,i.height=a.height,i.contentType="image/"+a.type,i.name="baidu-image."+a.type,o()},fail(a){r(a)}})})}validate(e){super.validate(e)}}class es extends ${create(){return new be}setPayload(e,t){let i=t,n=e.createOptions.file;const{uri:o,type:r,size:a,name:c}=n;i.url=decodeURIComponent(o),i.name=c,i.size=a,i.contentType=r,e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class gr extends es{create(){return new Ge}setPayload(e,t){let i=t,n=e.createOptions.file;const{uri:o,fileSize:r,type:a,fileName:c,width:u,height:h}=n;i.url=o,i.size=r,i.contentType=a,i.name=c,i.width=u,i.height=h,e.complete=Promise.resolve()}validate(e){super.validate(e)}}class yr extends ${create(){return new Be}setPayload(e,t){let i=e.createOptions.file;const n=t,{video:o,thumbnail:r}=n,{uri:a,type:c,fileSize:u,fileName:h,duration:p,height:l,width:f}=i;o.size=u,o.width=f,o.height=l,o.url=a,o.duration=p,o.contentType=c,o.name=h,r.url=a,r.name="rn-thumbnail.jpg",r.height=200,r.width=Number((o.width*r.height/o.height).toFixed(0)),r.contentType="image/jpg",e.complete=Promise.resolve()}validate(e){if(!d.isObject(e))throw Error("it is an empty message.");if(!d.isDef(e.file))throw Error("file is empty.")}}class Sr extends es{create(){return new Le}setPayload(e,t){let i=e.createOptions,n=t,o=i.file;const{uri:r,name:a,duration:c,size:u}=o;n.url=r,n.duration=Number((c/1e3).toFixed(2)),n.size=u,n.name=a||"rn-audio."+x.fileExtension(r,"."),n.contentType="audio/"+x.fileExtension(r,"."),i.file={uri:r,type:n.contentType,name:n.name},e.complete=Promise.resolve()}validate(e){super.validate(e)}}class Er extends St{}class vr extends ${create(){return new Er}setPayload(e,t){let i=e.createOptions;t.payload=i.payload,e.complete=Promise.resolve()}validate(e){let t=e.type,i=e.payload;if(d.isEmpty(t))throw Error("type is empty.");if(!d.isString(t))throw Error("type require a string");if(d.isEmpty(i))throw Error("payload is empty.");if(!d.isPlainObject(i)&&!d.isStringOrNumber(i))throw Error("payload require object | string | number.")}}class br{constructor(e,t){this.type=e,this.createOptions=t}}class Cr{constructor(){this.framework=ve.currentFramework(),this.platform=H.currentPlatform(),this.payloadBuilders={[j.UNIAPP]:{image:new nr,file:new Yt,audio:new or,video:new rr,text:new we},[N.MP_WX]:{image:new Is,file:new pt,audio:new Ns,video:new Ts,text:new we},[N.BROWSER]:{image:new ar,file:new Qt,audio:new cr,video:new ur,text:new we},[N.MP_ALI]:{image:new dr,file:new Kt,audio:new hr,video:new lr,text:new we},[N.MP_BAIDU]:{image:new fr,file:new Zt,audio:new mr,video:new pr,text:new we},[j.REACT_NATIVE]:{image:new gr,file:new es,audio:new Sr,video:new yr,text:new we},[N.MP_BYTE]:{image:new Is,file:new pt,audio:new Ns,video:new Ts,text:new we}}}buildMessage(e,t){const i=this.framework===j.UNKNOWN?this.platform:this.framework;let n=this.payloadBuilders[i][e],o=new br(e,t);if(n){let a=n.build(o);o.payload=a}else{let a=new vr().build(o);o.payload=a.payload}let r=this.build(o);return o.complete.then(()=>{S.onSuccess(t,r)}).catch(a=>{S.onFailed(t,a)}),r}build(e){let t,i=e.type,n=e.payload,o=e.createOptions,r=o.to,a=r.type;return this.validate(o),a===y.GROUP?(t=new Hs,t.groupId=r.id.toString(),t.senderData=m.Socket.user().data):a===y.PRIVATE?(t=new Vs,t.read=!1,t.receiverId=r.id.toString()):a===y.CS&&(t=new zt,t.to=r.id.toString(),t.teamId=r.id.toString(),t.senderData=m.Socket.user().data),t.senderId=m.Socket.user().id,t.messageId=Vt.get(),t.payload=n,t.timestamp=Date.now(),t.type=i,t.recalled=!1,t.status=q.NEW,t.buildOptions=e,t}validate(e){const t=e.to;if(!t)throw new Error("message require property to.");if(!d.isObject(t))throw new Error("TypeError: to requires an object.");if(!d.isObject(t.data))throw new Error("TypeError: to.data requires an object.");if(!t.type||t.type!==y.GROUP&&t.type!==y.PRIVATE&&t.type!==y.CS)throw new Error("message require property to.type");if(k.validateId(t.id,"to.id"),m.Socket.user().id===t.id)throw new Error("to.id can not be the same as your id.");d.isDef(e.notification)&&k.validateNotification(e.notification),e.wxmpTemplateMsg&&k.validateWXMPTemplateMsg(e.wxmpTemplateMsg)}}class wr extends pi{onMessageReceived(e){if(e.t===y.CS){let t=this.builder.build(e);this.sendAck(t);let i=T.byIMMessage(t);z.get(i).existsMessage(t)||(t.customerId()===m.Socket.user().id?(this.createNotification(e),v.i.fire(b.MESSAGE_RECEIVED,t),ee.fire(Q.CS_MESSAGE_RECEIVED,t)):le.getInstance().queryTeams().then(()=>{G.isMyMessage(t)&&this.createNotification(e),v.i.fire(b.CS_AGENT_MESSAGE_RECEIVED,t)}))}}}class Mr{constructor(e){this.times=new Array;let t=e[0],i=T.byIMMessage(t);this.scene=i.scene,this.targetId=i.id,e.forEach(n=>{this.times.push(n.timestamp)}),this.times.sort((n,o)=>n<o?-1:n==o?0:1)}}class Ir{constructor(){this.onRemoteRecalled=e=>{v.i.fire(b.MESSAGE_RECALLED,e)},_.onMessage(se.IM_MSG_RECALLED,this.onRemoteRecalled)}recallMessage(e){return E(this,void 0,void 0,function*(){hi.validateMessageArray(e.messages),this.validate(e);let t=e.messages;yield this.recallServerMessages(t);let i=t[0],n=i.scene(),o=this.toConversationId(n,i.senderId,i.targetId()),r={id:m.Socket.user().id,data:m.Socket.user().data},a=t.map(u=>u.timestamp),c=new Ws(n,o,r,a);v.i.fire(b.MESSAGE_RECALLED,c),S.onSuccess(e)})}toConversationId(e,t,i){if(y.PRIVATE===e)return function(n,o){return n.localeCompare(o)>0?`${n}:${o}`:`${o}:${n}`}(t,i);if(y.GROUP===e)return i;throw{code:400,content:`scene: ${e} not support`}}recallServerMessages(e){let t=new Mr(e);return t.times.length===0?Promise.resolve():new Promise((i,n)=>{let o=new O({name:I.IM_RECALL_MESSAGE,params:t,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:r=>{n(r)},success:r=>{r.code===200?i(r):n(r)}});m.Socket.e(o)})}validate(e){let t=e.messages;for(let i=0;i<t.length;i++){let n=t[i];if(n.scene()===y.CS)throw{code:400,content:"Recall CS message is not supported yet."};if(n.status!==q.SUCCESS)throw{code:400,content:"message["+i+"] is '"+n.status+"' and cannot be recalled"};if(n.recalled)throw{code:400,content:"message["+i+"] has been recalled"};if(n.senderId!==m.Socket.user().id)throw{code:400,content:"it is not allowed to recall messages sent by others"}}}}class Nr{constructor(){this.map=new Map}getData(e){return this.map.get(e)}setData(e,t){this.map.set(e,t)}}class Fe{constructor(){this.dataCache=new Nr}static init(){this.i=new Fe}getData(...e){return E(this,void 0,void 0,function*(){let t=[],i=new Map;return e.forEach(n=>{let o=this.dataCache.getData(n);o?i.set(n,o):t.push(n)}),t.length===0||(yield this.fetchData(...t)).forEach((n,o)=>{this.dataCache.setData(o,n),i.set(o,n)}),Promise.resolve(i)})}fetchData(...e){return new Promise((t,i)=>{let n=new O({name:I.MD_CMD,permission:M.READ,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,params:{name:"GET",data:{ids:e}},success:o=>{if(o.code===200){const r=new Map;o.content.forEach(a=>{r.set(a.id,a.data)}),t(r)}else i(o)},fail:o=>{i(o)}});m.Socket.e(n)})}setData(e,t){this.dataCache.setData(e,t)}}class Tr{constructor(){v.i.on(b.MESSAGE_RECEIVED,this.onMessageReceived),v.i.on(b.MESSAGE_SENDING,this.onMessageSending)}onMessageSending(e){let t=T.byIMMessage(e);t.scene===y.PRIVATE&&Fe.i.setData(t.id,e.getToData())}onMessageReceived(e){if(T.byIMMessage(e).scene===y.GROUP){let t=e;Fe.i.setData(t.senderId,t.senderData)}}}class w{constructor(){this._iMReceiver=new pi,this.csMessageReceiver=new wr,this.memberDataUpdator=new Tr,this._userHereNow=new er,this.goEasyUploader=new Bs,this._groupHereNow=new Ko,this._groupOnlineCount=new Qo,this.groupMessageSubscriber=new $o,this.messageBuilder=new Cr,this.messageSender=new gn,this.recaller=new Ir,this._groupPresenceSubscriber=new Yo,this._userPresenceSubscriber=new Zo,this.conversations=new Xo,this.histories=z.init()}static init(){v.init(),ee.init(),w.instance=new w}static i(){if(w.instance)return w.instance;throw Error("Please connect first.")}validateModules(){if(_.status()===A.DISCONNECTED)throw Error("Please call connect() first.");Ne.check()}catch(e,t){return E(this,void 0,void 0,function*(){try{this.validateModules(),k.validateCallbackOptions(t),yield e()}catch(i){S.onFailed(t,i)}})}on(e,t){ee.on(e,t)}off(e,t){ee.off(e,t)}createTextMessage(e){return this.validateModules(),this.messageBuilder.buildMessage(J.TEXT,e)}createImageMessage(e){return this.validateModules(),this.messageBuilder.buildMessage(J.IMAGE,e)}createFileMessage(e){return this.validateModules(),this.messageBuilder.buildMessage(J.FILE,e)}createAudioMessage(e){return this.validateModules(),this.messageBuilder.buildMessage(J.AUDIO,e)}createVideoMessage(e){return this.validateModules(),this.messageBuilder.buildMessage(J.VIDEO,e)}createCustomMessage(e){return this.validateModules(),this.messageBuilder.buildMessage(e.type,e)}sendMessage(e){this.catch(()=>{this.messageSender.send(e)},e)}recallMessage(e){this.catch(()=>{this.recaller.recallMessage(e)},e)}deleteMessage(e){this.catch(()=>{this.histories.deleteMessage(e)},e)}markGroupMessageAsRead(e){this.catch(()=>E(this,void 0,void 0,function*(){yield this.histories.groupMarkAsRead(e)}),e)}markPrivateMessageAsRead(e){this.catch(()=>E(this,void 0,void 0,function*(){yield this.histories.privateMarkAsRead(e)}),e)}markMessageAsRead(e,t){this.catch(()=>E(this,void 0,void 0,function*(){yield this.histories.markMessageAsRead(e,t)}),e)}latestConversations(e){this.validateModules(),this.conversations.latestConversations(e)}removePrivateConversation(e){this.catch(()=>this.conversations.removePrivateConversation(e),e)}removeGroupConversation(e){this.catch(()=>this.conversations.removeGroupConversation(e),e)}topPrivateConversation(e){this.catch(()=>this.conversations.topPrivateConversation(e),e)}topGroupConversation(e){this.catch(()=>this.conversations.topGroupConversation(e),e)}history(e,t){this.catch(()=>{this.histories.loadHistory(e,t)},e)}subscribeUserPresence(e){this.catch(()=>this._userPresenceSubscriber.presence(e),e)}unsubscribeUserPresence(e){this.catch(()=>this._userPresenceSubscriber.unPresence(e),e)}hereNow(e){this.catch(()=>this._userHereNow.hereNow(e),e)}subscribeGroup(e){this.catch(()=>this.groupMessageSubscriber.subscribe(e),e)}unsubscribeGroup(e){this.catch(()=>this.groupMessageSubscriber.unsubscribe(e),e)}subscribeGroupPresence(e){this.catch(()=>this._groupPresenceSubscriber.presence(e),e)}unsubscribeGroupPresence(e){this.catch(()=>this._groupPresenceSubscriber.unPresence(e),e)}groupHereNow(e){this.catch(()=>this._groupHereNow.hereNow(e),e)}groupOnlineCount(e){this.catch(()=>this._groupOnlineCount.get(e),e)}latestPendingConversations(e){this.validateModules(),this.conversations.latestPendingConversations(e)}topConversation(e){this.validateModules(),this.conversations.topConversation(e)}removeConversation(e){this.validateModules(),this.conversations.removeConversation(e)}}class Or{constructor(e,t){this.customerId=e,this.teamId=t}}class Ar{constructor(e,t){this.teamId=e;let i=new Os(t.id.toString(),JSON.stringify(t.data));this.customer=i}}class Rr{constructor(e,t,i){this.customerId=e,this.teamId=t,this.agentId=i}}class kr{constructor(e,t){this.customerId=e,this.teamId=t}}class Pr{constructor(e){this.builder=new ft,this.teamId=e}accept(e,t){let i=t.customer;if(d.isUndef(i))throw{code:400,content:"customer is required."};k.validateId(i.id,"customer.id");let n=i.data;if(d.isUndef(n)||!d.isObject(n))throw{code:400,content:"customer data must be non-empty object."};let o=new Ar(e,i),r=new O({name:I.CS_ACCEPT,params:o,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:a=>{S.onFailed(t,a)},success:a=>{let c=this.builder.build(a.content.message);v.i.fire(b.CS_ACCEPTED,c),S.onSuccess(t)}});m.Socket.e(r)}end(e,t){k.validateId(t.id,"id");let i=t.id.toString(),n=new kr(i,e),o=new O({name:I.CS_END,params:n,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:r=>{S.onFailed(t,r)},success:r=>{let a=this.builder.build(r.content.message);v.i.fire(b.CS_ENDED,a),S.onSuccess(t)}});m.Socket.e(o)}queryCustomerStatus(e,t){return E(this,void 0,void 0,function*(){k.validateId(t.id,"id");let i=yield this.doCustomerStatus(e,t.id);this.activeCustomerStatus=i,this.activeCustomerStatusOptions=t,S.onSuccess(t,i)})}doCustomerStatus(e,t){let i=t.toString(),n=new Or(i,e);return new Promise((o,r)=>{let a=new O({name:I.CS_CUSTOMER_STATUS,params:n,permission:M.READ,singleTimeout:g.commonQuerySingle,totalTimeout:g.commonQueryTotal,fail:c=>{r(c)},success:c=>{let u=c.content;u.agent&&(u.agent.data=JSON.parse(u.agent.data)),o(u)}});m.Socket.e(a)})}transfer(e,t){k.validateId(t.customerId,"customerId"),k.validateId(t.agentId,"agentId");let i=t.customerId.toString(),n=t.agentId.toString(),o=new Rr(i,e,n),r=new O({name:I.CS_TRANSFER,params:o,permission:M.WRITE,singleTimeout:g.commonRequestSingle,totalTimeout:g.commonRequestTotal,fail:a=>{S.onFailed(t,a)},success:a=>{let c=this.builder.build(a.content.message);v.i.fire(b.CS_TRANSFER,c),S.onSuccess(t)}});m.Socket.e(r)}}class _r{createTextMessage(e,t){let i=w.i().createTextMessage(t);this.extendProps(e,i)}createImageMessage(e,t){let i=w.i().createImageMessage(t);this.extendProps(e,i)}createFileMessage(e,t){let i=w.i().createFileMessage(t);this.extendProps(e,i)}createAudioMessage(e,t){let i=w.i().createAudioMessage(t);this.extendProps(e,i)}createVideoMessage(e,t){let i=w.i().createVideoMessage(t);this.extendProps(e,i)}createCustomMessage(e,t){let i=w.i().createCustomMessage(t);this.extendProps(e,i)}extendProps(e,t){if(t.scene()===y.CS){let i=t;i.teamId=e,i.accepted=!0}}}class Dr{constructor(e){this.teamId=e,this.agentStatus=le.getInstance(),this.conversationHandler=new Pr(e),this.messageCreator=new _r}catch(e,t){return E(this,void 0,void 0,function*(){try{k.validateCallbackOptions(t),yield e()}catch(i){S.onFailed(t,i)}})}isOnline(e){this.catch(()=>{this.agentStatus.isOnline(this.teamId,e)},e)}online(e){this.catch(()=>{this.agentStatus.online(this.teamId,e)},e)}offline(e){this.catch(()=>{this.agentStatus.offline(this.teamId,e)},e)}customerStatus(e){this.catch(()=>{this.conversationHandler.queryCustomerStatus(this.teamId,e)},e)}accept(e){this.catch(()=>{this.conversationHandler.accept(this.teamId,e)},e)}end(e){this.catch(()=>{this.conversationHandler.end(this.teamId,e)},e)}history(e){w.i().history(e,this.teamId)}markMessageAsRead(e){w.i().markMessageAsRead(e,this.teamId)}createTextMessage(e){this.messageCreator.createTextMessage(this.teamId,e)}createImageMessage(e){this.messageCreator.createImageMessage(this.teamId,e)}createFileMessage(e){this.messageCreator.createFileMessage(this.teamId,e)}createAudioMessage(e){this.messageCreator.createAudioMessage(this.teamId,e)}createVideoMessage(e){this.messageCreator.createVideoMessage(this.teamId,e)}createCustomMessage(e){this.messageCreator.createCustomMessage(this.teamId,e)}transfer(e){this.catch(()=>{this.conversationHandler.transfer(this.teamId,e)},e)}agents(e){this.catch(()=>{this.agentStatus.agents(this.teamId,e)},e)}liveSession(e){this.catch(()=>{G.live(this.teamId,e)},e)}quitLiveSession(e){this.catch(()=>{G.quit(e)},e)}listenCustomer(e){let t={customerId:e.id,onNewMessage:e.onNewMessage,onStatusUpdated:e.onStatusUpdated,onFailed:e.onFailed,onSuccess:e.onSuccess};this.catch(()=>{G.live(this.teamId,t)},e)}cancelListenCustomer(e){this.catch(()=>{G.quit(e)},e)}}class U{static team(e){k.validateId(e,"teamId");let t=this.teams.get(e);return t||(t=new Dr(e.toString()),this.teams.set(e.toString(),t)),t}}U.teams=new Map;class xr{constructor(e){this.id=e}isOnline(e){U.team(this.id).isOnline(e)}online(e){U.team(this.id).online(e)}offline(e){U.team(this.id).offline(e)}customerStatus(e){U.team(this.id).customerStatus(e)}accept(e){U.team(this.id).accept(e)}end(e){U.team(this.id).end(e)}history(e){U.team(this.id).history(e)}markMessageAsRead(e){U.team(this.id).markMessageAsRead(e)}createTextMessage(e){U.team(this.id).createTextMessage(e)}createImageMessage(e){U.team(this.id).createImageMessage(e)}createFileMessage(e){U.team(this.id).createFileMessage(e)}createAudioMessage(e){U.team(this.id).createAudioMessage(e)}createVideoMessage(e){U.team(this.id).createVideoMessage(e)}createCustomMessage(e){U.team(this.id).createCustomMessage(e)}transfer(e){U.team(this.id).transfer(e)}agents(e){U.team(this.id).agents(e)}liveSession(e){U.team(this.id).liveSession(e)}quitLiveSession(e){U.team(this.id).quitLiveSession(e)}listenCustomer(e){U.team(this.id).listenCustomer(e)}cancelListenCustomer(e){U.team(this.id).cancelListenCustomer(e)}}class fe{static getInstance(e){return this.init(e),fe}static init(e){if(this.getConnectionStatus()!==A.DISCONNECTED)throw new Error("Initialization failed. Please disconnect and try again.");this.validateOptions(e),Me.init(e.reactNativeOptions),this.options=e,_.init(e),e.allowNotification&&V.init(),e.modules&&(e.modules.includes("PUBSUB")&&Y.initModule($e.init()),e.modules.includes("IM")&&Y.initModule(Ne.init())),Fe.init(),m.init(_,V,Fe,qt,At,Y)}static setBadge(e){V.setBadge(e)}static connect(e){_.connect(e,"JS")}static disconnect(e){_.disconnect(e)}static getConnectionStatus(){return _.status()}static validateOptions(e){let t="";if(!d.isObject(e))throw t="options is require an object.",Error(t);if(!d.isPrimitive(e.appkey)||e.appkey.length==0)throw t="Invalid options:'appkey' is empty.",Error(t);if(!d.isPrimitive(e.host)||e.host.length==0)throw t="Invalid options:'host' is empty.",Error(t);if(!d.isArray(e.modules))throw t="Invalid options: 'modules' must be nonempty array",Error(t);e.modules=e.modules.map(i=>i.toUpperCase())}static onClickNotification(e){V.onClickNotification(e)}static c(e){e.init(m.Socket,m.N,m.Member,m.v,m.Platform,Y)}}fe.version=qt,fe.IM_EVENT=Q,fe.IM_SCENE=y,fe.im=class{static on(s,e){w.i().on(s,e)}static off(s,e){w.i().off(s,e)}static createTextMessage(s){return w.i().createTextMessage(s)}static createImageMessage(s){return w.i().createImageMessage(s)}static createFileMessage(s){return w.i().createFileMessage(s)}static createAudioMessage(s){return w.i().createAudioMessage(s)}static createVideoMessage(s){return w.i().createVideoMessage(s)}static createCustomMessage(s){return w.i().createCustomMessage(s)}static sendMessage(s){w.i().sendMessage(s)}static recallMessage(s){w.i().recallMessage(s)}static deleteMessage(s){w.i().deleteMessage(s)}static markGroupMessageAsRead(s){w.i().markGroupMessageAsRead(s)}static markPrivateMessageAsRead(s){w.i().markPrivateMessageAsRead(s)}static latestConversations(s){w.i().latestConversations(s)}static removePrivateConversation(s){w.i().removePrivateConversation(s)}static removeGroupConversation(s){w.i().removeGroupConversation(s)}static topPrivateConversation(s){w.i().topPrivateConversation(s)}static topGroupConversation(s){w.i().topGroupConversation(s)}static history(s){w.i().history(s)}static subscribeUserPresence(s){w.i().subscribeUserPresence(s)}static unsubscribeUserPresence(s){w.i().unsubscribeUserPresence(s)}static hereNow(s){w.i().hereNow(s)}static subscribeGroup(s){w.i().subscribeGroup(s)}static unsubscribeGroup(s){w.i().unsubscribeGroup(s)}static subscribeGroupPresence(s){w.i().subscribeGroupPresence(s)}static unsubscribeGroupPresence(s){w.i().unsubscribeGroupPresence(s)}static groupHereNow(s){w.i().groupHereNow(s)}static groupOnlineCount(s){w.i().groupOnlineCount(s)}static markMessageAsRead(s){w.i().markMessageAsRead(s)}static csteam(s){return new xr(s)}static pendingConversations(s){w.i().latestPendingConversations(s)}static topConversation(s){w.i().topConversation(s)}static removeConversation(s){w.i().removeConversation(s)}},fe.pubsub=class{static publish(s){this.catch(()=>{oe.instance.publish(s)},s)}static subscribe(s){this.catch(()=>{oe.instance.subscribe(s)},s)}static unsubscribe(s){this.catch(()=>{oe.instance.unsubscribe(s)},s)}static subscribePresence(s){this.catch(()=>{oe.instance.subscribePresence(s)},s)}static unsubscribePresence(s){this.catch(()=>{oe.instance.unsubscribePresence(s)},s)}static history(s){this.catch(()=>{oe.instance.history(s)},s)}static hereNow(s){this.catch(()=>{oe.instance.hereNow(s)},s)}static catch(s,e){try{if($e.check(),[A.DISCONNECTED,A.DISCONNECTING,A.CONNECT_FAILED].includes(m.Socket.status()))throw new Error("Please call connect() first.");s()}catch(t){S.onFailed(e,t)}}};class _e{constructor(){this.goEasy=fe.getInstance({host:"hangzhou.goeasy.io",appkey:"BC-fdd25e37ab8c4d109cbaa701334b33d3",modules:["pubsub"]})}static getInstanceEx(){return _e.instance||(_e.instance=new _e),_e.instance.goEasy}}function Ur(s){if((typeof s=="string"||typeof s=="number")&&(s=new Date(Number(s))),!(s instanceof Date)||isNaN(s.getTime()))throw new TypeError(" Date ");const e=new Date,t=s.getFullYear()===e.getFullYear(),i=s.getFullYear(),n=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0"),r=String(s.getHours()).padStart(2,"0"),a=String(s.getMinutes()).padStart(2,"0"),c=String(s.getSeconds()).padStart(2,"0");return t?`${n}-${o} ${r}:${a}:${c}`:`${i}-${n}-${o} ${r}:${a}:${c}`}const Fr=s=>(Ni("data-v-a98b277b"),s=s(),Ti(),s),Gr={class:"box"},Lr={class:"content"},Br={class:"chat-item_box"},qr={class:"chat-item_time"},jr={class:"chat-item_content"},Vr={class:"send"},Hr=Fr(()=>pe("div",{class:"send_options"},null,-1)),zr={class:"send_content"},Wr={__name:"ai",setup(s){const e=bi(),t=_e.getInstanceEx();let i=t.pubsub;new Date().toLocaleString();let n=Et("");const o=Et(null);let r=Et([]);const a=()=>{setTimeout(()=>{o.value&&(o.value.scrollTop=o.value.scrollHeight)},100)},c=async()=>{await t.connect({onSuccess:function(){console.log("GoEasy connect successfully.")},onFailed:function(l){console.log("Failed to connect GoEasy, code:"+l.code+",error:"+l.content)},onProgress:function(l){console.log("GoEasy is connecting",l)}})},u=async()=>{await i.subscribe({channel:"my_channel",onMessage:function(l){console.log("Channel:"+l.channel+" content:"+l.content),r.value.push({time:new Date,content:l.content}),a()},onSuccess:function(){console.log("Channel")},onFailed:function(l){console.log("Channel, "+l.code+" "+l.content)}})},h=async l=>{l="userId001#"+l,await i.publish({channel:"my_channel",message:l,onSuccess:async function(){n.value="",console.log("")},onFailed:function(f){console.log(""+f.code+" "+f.content)}})},p=async()=>{await t.pubsub.history({channel:"my_channel",limit:30,onSuccess:function(l){var f,C;console.log(": "+JSON.stringify(l)),l.code===200&&((f=l.content)==null?void 0:f.messages.length)>0&&(r.value=((C=l==null?void 0:l.content)==null?void 0:C.messages)||[],a())},onFailed:function(l){console.log("Failed to obtain history, code:"+l.code+",error:"+l.content)}})};return console.log(new Date().getTime()),c(),u(),p(),(l,f)=>{const C=vt("a-avatar"),D=vt("a-textarea"),L=vt("a-button");return bt(),Ct("div",Gr,[pe("div",Lr,[pe("div",{class:"chat",ref_key:"chatContainer",ref:o},[(bt(!0),Ct(Ci,null,wi(Ce(r),(K,Oe)=>(bt(),Ct("div",{class:"chat-item",key:Oe},[qe(C,{size:36,src:Ce(e).avatar,alt:"USER"},null,8,["src"]),pe("div",Br,[pe("span",qr,ts(Ce(Ur)(K.time)),1),pe("span",jr,ts(K.content),1)])]))),128))],512),pe("div",Vr,[Hr,pe("div",zr,[qe(D,{value:Ce(n),"onUpdate:value":f[0]||(f[0]=K=>Mi(n)?n.value=K:n=K),placeholder:"",autosize:{minRows:3,maxRows:3}},null,8,["value"]),qe(L,{class:"send_content_button",disabled:!Ce(n),type:"primary",onClick:f[1]||(f[1]=K=>h(Ce(n)))},{icon:Ii(()=>[qe(Ce(Pi))]),_:1},8,["disabled"])])])])])}}},$r=Oi(Wr,[["__scopeId","data-v-a98b277b"]]);export{$r as default};
